<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quantum Wire Optics and Field Conversion &mdash; PulseSuite 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../autoapi/index.html" />
    <link rel="prev" title="Phonon Interactions in Quantum Wires" href="phonons_example.myst.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PulseSuite
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">PulseSuite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../gallery.html">Examples Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coulomb_example.myst.html">Coulomb Interactions in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="dcfield_example.myst.html">DC Field Carrier Transport in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="emission_example.myst.html">Spontaneous Emission and Photoluminescence in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="phonons_example.myst.html">Phonon Interactions in Quantum Wires</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Quantum Wire Optics and Field Conversion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#theory">Theory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#field-projection">Field Projection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#polarization-calculation">Polarization Calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#charge-density-calculation">Charge Density Calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linear-susceptibility">Linear Susceptibility</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-and-initialization">Setup and Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quantum-wire-window">Quantum Wire Window</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialization-and-dipole-matrices">Initialization and Dipole Matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-projection-propagation-to-qw">Field Projection: Propagation to QW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Polarization Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Charge Density Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-projection-qw-to-propagation">Field Projection: QW to Propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Linear Susceptibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assumptions-and-parameter-choices">Assumptions and Parameter Choices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#material-parameters-gaas">Material Parameters (GaAs)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wire-dimensions">Wire Dimensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grid-parameters">Grid Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simplifications">Simplifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#when-to-use-more-realistic-approaches">When to Use More Realistic Approaches</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PulseSuite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../gallery.html">Examples Gallery</a></li>
      <li class="breadcrumb-item active">Quantum Wire Optics and Field Conversion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/qwoptics_example.myst.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="quantum-wire-optics-and-field-conversion">
<h1>Quantum Wire Optics and Field Conversion<a class="headerlink" href="#quantum-wire-optics-and-field-conversion" title="Link to this heading"></a></h1>
<section id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Link to this heading"></a></h2>
<p>The quantum wire optics module bridges two spatial domains in the simulation:</p>
<ol class="arabic simple">
<li><p><strong>Propagation Space (<span class="math notranslate nohighlight">\(\mathbf{R}\)</span>)</strong>: The macroscopic domain where optical pulses propagate over distances much larger than the wire dimensions.</p></li>
<li><p><strong>Quantum Wire Space (<span class="math notranslate nohighlight">\(\mathbf{r}\)</span>)</strong>: The microscopic domain confined by the wire potential, where quantum mechanical carrier dynamics occur.</p></li>
</ol>
<section id="field-projection">
<h3>Field Projection<a class="headerlink" href="#field-projection" title="Link to this heading"></a></h3>
<p>The transformation between these domains involves:</p>
<p><strong>Propagation to QW (<code class="docutils literal notranslate"><span class="pre">Prop2QW</span></code>):</strong></p>
<ul class="simple">
<li><p>Interpolates Maxwell fields from propagation grid to QW grid</p></li>
<li><p>Applies quantum wire window function to confine fields to wire region</p></li>
<li><p>Performs FFT to convert from real space to momentum space</p></li>
</ul>
<p><strong>QW to Propagation (<code class="docutils literal notranslate"><span class="pre">QW2Prop</span></code>):</strong></p>
<ul class="simple">
<li><p>Inverse FFT to convert from momentum space to real space</p></li>
<li><p>Interpolates QW fields (polarization, charge density) back to propagation grid</p></li>
<li><p>Normalizes charge densities for consistency</p></li>
</ul>
</section>
<section id="polarization-calculation">
<h3>Polarization Calculation<a class="headerlink" href="#polarization-calculation" title="Link to this heading"></a></h3>
<p>The quantum wire polarization is calculated from the density matrix:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{P}(\mathbf{r}) = \frac{2 \cdot \text{ehint}}{\text{area} \cdot L} \sum_{k_e, k_h} p_{cv}(k_h, k_e) \, \mathbf{d}_{vc}(k_h, k_e) \, e^{i(k_e - k_h)r} \, \phi_{QW}(\mathbf{r})
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_{cv}\)</span> is the electron-hole coherence matrix</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{d}_{vc}\)</span> are the dipole matrix elements</p></li>
<li><p><span class="math notranslate nohighlight">\(\phi_{QW}\)</span> is the quantum wire window function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ehint</span></code> is the electron-hole overlap integral</p></li>
</ul>
</section>
<section id="charge-density-calculation">
<h3>Charge Density Calculation<a class="headerlink" href="#charge-density-calculation" title="Link to this heading"></a></h3>
<p>Electron and hole charge densities are computed from coherence matrices:</p>
<div class="math notranslate nohighlight">
\[
\rho_e(\mathbf{r}) = \sum_{k_1, k_2} C(k_1, k_2) \, e^{-ik_1 r} e^{ik_2 r} \, \phi_{QW}(\mathbf{r})
\]</div>
<div class="math notranslate nohighlight">
\[
\rho_h(\mathbf{r}) = \sum_{k_1, k_2} D^*(k_1, k_2) \, e^{-ik_1 r} e^{ik_2 r} \, \phi_{QW}(\mathbf{r})
\]</div>
<p>where <span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(D\)</span> are electron-electron and hole-hole coherence matrices.</p>
</section>
<section id="linear-susceptibility">
<h3>Linear Susceptibility<a class="headerlink" href="#linear-susceptibility" title="Link to this heading"></a></h3>
<p>The linear optical susceptibility is calculated as:</p>
<div class="math notranslate nohighlight">
\[
\chi^{(1)}(\omega) = \frac{4 |d_{cv}|^2}{\epsilon_0 \cdot \text{area}} \frac{\Delta k}{2\pi} \sum_k \frac{E_e(k) + E_h(k)}{(E_e(k) + E_h(k) - \hbar\omega - i\hbar\gamma_{eh}) (E_e(k) + E_h(k) + \hbar\omega + i\hbar\gamma_{eh})}
\]</div>
</section>
</section>
<section id="setup-and-initialization">
<h2>Setup and Initialization<a class="headerlink" href="#setup-and-initialization" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">e</span> <span class="k">as</span> <span class="n">e0</span><span class="p">,</span> <span class="n">hbar</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">epsilon_0</span> <span class="k">as</span> <span class="n">eps0</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D</span><span class="w"> </span><span class="kn">import</span> <span class="n">qwoptics</span>

<span class="c1"># Physical parameters (GaAs quantum wire)</span>
<span class="n">L_wire</span> <span class="o">=</span> <span class="mf">100e-9</span>        <span class="c1"># Wire length: 100 nm</span>
<span class="n">area</span> <span class="o">=</span> <span class="mf">1e-14</span>           <span class="c1"># Wire cross-sectional area: 10 nm²</span>
<span class="n">gap</span> <span class="o">=</span> <span class="mf">1.42</span> <span class="o">*</span> <span class="n">e0</span>        <span class="c1"># Band gap: 1.42 eV</span>
<span class="n">dcv</span> <span class="o">=</span> <span class="mf">1e-29</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>       <span class="c1"># Dipole moment: 1e-29 C·m</span>
<span class="n">ehint</span> <span class="o">=</span> <span class="mf">0.8</span>            <span class="c1"># Electron-hole overlap integral</span>

<span class="c1"># Grid parameters</span>
<span class="n">N_prop</span> <span class="o">=</span> <span class="mi">256</span>           <span class="c1"># Propagation space grid points</span>
<span class="n">N_qw</span> <span class="o">=</span> <span class="mi">128</span>             <span class="c1"># Quantum wire space grid points</span>
<span class="n">N_k</span> <span class="o">=</span> <span class="mi">64</span>               <span class="c1"># Momentum space grid points</span>

<span class="c1"># Propagation space grid (macroscopic)</span>
<span class="n">R_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">500e-9</span><span class="p">,</span> <span class="mf">500e-9</span><span class="p">,</span> <span class="n">N_prop</span><span class="p">)</span>  <span class="c1"># 1 μm total window</span>

<span class="c1"># Quantum wire space grid (microscopic)</span>
<span class="n">r_wire</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">N_qw</span><span class="p">)</span>

<span class="c1"># Momentum grids</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1e8</span>             <span class="c1"># Maximum momentum (1/m)</span>
<span class="n">kr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">kmax</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">N_k</span><span class="p">)</span>
<span class="n">Qr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">kmax</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">N_qw</span><span class="p">)</span>  <span class="c1"># Momentum grid for FFT</span>

<span class="c1"># Electron and hole energies (parabolic bands)</span>
<span class="n">m_e</span> <span class="o">=</span> <span class="mf">0.067</span> <span class="o">*</span> <span class="mf">9.109e-31</span>  <span class="c1"># Electron effective mass (GaAs)</span>
<span class="n">m_h</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="mf">9.109e-31</span>   <span class="c1"># Hole effective mass (GaAs)</span>
<span class="n">Ee</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kr</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m_e</span><span class="p">)</span>
<span class="n">Eh</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kr</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m_h</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Propagation domain: </span><span class="si">{</span><span class="n">R_prop</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">R_prop</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wire domain: </span><span class="si">{</span><span class="n">r_wire</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">r_wire</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Momentum grid: </span><span class="si">{</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (10^8 m^-1)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="quantum-wire-window">
<h2>Quantum Wire Window<a class="headerlink" href="#quantum-wire-window" title="Link to this heading"></a></h2>
<p>The window function confines fields to the wire region. Let’s calculate and visualize it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate quantum wire window function</span>
<span class="n">qwoptics</span><span class="o">.</span><span class="n">CalcQWWindow</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">L_wire</span><span class="p">)</span>

<span class="c1"># Access the window (stored in module-level variable)</span>
<span class="c1"># Note: In actual usage, this is set by InitializeQWOptics</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">qwoptics</span><span class="o">.</span><span class="n">_QWWindow</span>

<span class="c1"># Visualize window function</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;QW Window Function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wire boundaries&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Window Function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Quantum Wire Window Function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window function: exp(-(r/(L/2))^150)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window is 1 inside wire, decays rapidly outside&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="initialization-and-dipole-matrices">
<h2>Initialization and Dipole Matrices<a class="headerlink" href="#initialization-and-dipole-matrices" title="Link to this heading"></a></h2>
<p>Before using polarization and charge density functions, we must initialize the module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize QW optics module</span>
<span class="c1"># This sets up window function, phase factors, and dipole matrices</span>
<span class="n">qwoptics</span><span class="o">.</span><span class="n">InitializeQWOptics</span><span class="p">(</span>
    <span class="n">RR</span><span class="o">=</span><span class="n">r_wire</span><span class="p">,</span>      <span class="c1"># Spatial coordinate array</span>
    <span class="n">L</span><span class="o">=</span><span class="n">L_wire</span><span class="p">,</span>       <span class="c1"># Wire length</span>
    <span class="n">dcv</span><span class="o">=</span><span class="n">dcv</span><span class="p">,</span>        <span class="c1"># Dipole moment</span>
    <span class="n">kr</span><span class="o">=</span><span class="n">kr</span><span class="p">,</span>          <span class="c1"># Momentum coordinate array</span>
    <span class="n">Qr</span><span class="o">=</span><span class="n">Qr</span><span class="p">,</span>          <span class="c1"># Momentum array (for compatibility)</span>
    <span class="n">Ee</span><span class="o">=</span><span class="n">Ee</span><span class="p">,</span>          <span class="c1"># Electron energies</span>
    <span class="n">Eh</span><span class="o">=</span><span class="n">Eh</span><span class="p">,</span>          <span class="c1"># Hole energies</span>
    <span class="n">ehint</span><span class="o">=</span><span class="n">ehint</span><span class="p">,</span>    <span class="c1"># Electron-hole overlap integral</span>
    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>      <span class="c1"># Wire area</span>
    <span class="n">gap</span><span class="o">=</span><span class="n">gap</span>         <span class="c1"># Band gap (for compatibility)</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;QW optics module initialized&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dipole matrices shape: </span><span class="si">{</span><span class="n">qwoptics</span><span class="o">.</span><span class="n">_Xcv0</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phase factor matrices shape: </span><span class="si">{</span><span class="n">qwoptics</span><span class="o">.</span><span class="n">_Expikr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Window function length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">qwoptics</span><span class="o">.</span><span class="n">_QWWindow</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize dipole matrix elements</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># X component</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">qwoptics</span><span class="o">.</span><span class="n">_Xcv0</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;X Dipole Matrix Element (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$d_x$ (C·m)&#39;</span><span class="p">)</span>

<span class="c1"># Y component</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">qwoptics</span><span class="o">.</span><span class="n">_Ycv0</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Y Dipole Matrix Element (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$d_y$ (C·m)&#39;</span><span class="p">)</span>

<span class="c1"># Z component</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">qwoptics</span><span class="o">.</span><span class="n">_Zcv0</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Z Dipole Matrix Element (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$d_z$ (C·m)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="field-projection-propagation-to-qw">
<h2>Field Projection: Propagation to QW<a class="headerlink" href="#field-projection-propagation-to-qw" title="Link to this heading"></a></h2>
<p>Now let’s demonstrate field projection from propagation space to QW space:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a Gaussian optical pulse in propagation space</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">100e-9</span>  <span class="c1"># Pulse width: 100 nm</span>
<span class="n">center</span> <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1"># Pulse center</span>

<span class="n">Ex_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">R_prop</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>
<span class="n">Ey_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Ex_prop</span><span class="p">)</span>
<span class="n">Ez_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Ex_prop</span><span class="p">)</span>
<span class="n">V_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Ex_prop</span><span class="p">)</span>

<span class="c1"># Arrays for QW fields (will be modified in-place)</span>
<span class="n">Ex_wire</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ey_wire</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ez_wire</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">V_wire</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Perform projection: Propagation to QW</span>
<span class="c1"># Note: Edc is a float parameter (currently unused, set to 0.0)</span>
<span class="n">qwoptics</span><span class="o">.</span><span class="n">Prop2QW</span><span class="p">(</span>
    <span class="n">RR</span><span class="o">=</span><span class="n">R_prop</span><span class="p">,</span>      <span class="c1"># Propagation spatial array</span>
    <span class="n">Exx</span><span class="o">=</span><span class="n">Ex_prop</span><span class="p">,</span>    <span class="c1"># Propagation X field</span>
    <span class="n">Eyy</span><span class="o">=</span><span class="n">Ey_prop</span><span class="p">,</span>    <span class="c1"># Propagation Y field</span>
    <span class="n">Ezz</span><span class="o">=</span><span class="n">Ez_prop</span><span class="p">,</span>    <span class="c1"># Propagation Z field</span>
    <span class="n">Vrr</span><span class="o">=</span><span class="n">V_prop</span><span class="p">,</span>     <span class="c1"># Propagation potential</span>
    <span class="n">Edc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>        <span class="c1"># DC field (float, currently unused)</span>
    <span class="n">R</span><span class="o">=</span><span class="n">r_wire</span><span class="p">,</span>       <span class="c1"># QW spatial array</span>
    <span class="n">Ex</span><span class="o">=</span><span class="n">Ex_wire</span><span class="p">,</span>     <span class="c1"># QW X field (output)</span>
    <span class="n">Ey</span><span class="o">=</span><span class="n">Ey_wire</span><span class="p">,</span>     <span class="c1"># QW Y field (output)</span>
    <span class="n">Ez</span><span class="o">=</span><span class="n">Ez_wire</span><span class="p">,</span>     <span class="c1"># QW Z field (output)</span>
    <span class="n">Vr</span><span class="o">=</span><span class="n">V_wire</span><span class="p">,</span>      <span class="c1"># QW potential (output)</span>
    <span class="n">t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Time</span>
    <span class="n">xxx</span><span class="o">=</span><span class="mi">1</span>            <span class="c1"># Time index</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field projection complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fields are now in momentum space (after FFT)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ex_wire shape: </span><span class="si">{</span><span class="n">Ex_wire</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, dtype: </span><span class="si">{</span><span class="n">Ex_wire</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize field projection</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Real space comparison (before FFT in Prop2QW, we see the windowed field)</span>
<span class="c1"># Note: Prop2QW performs FFT, so Ex_wire is in momentum space</span>
<span class="c1"># For visualization, we&#39;ll show the magnitude in momentum space</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ex_prop</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Propagation Field&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wire boundaries&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|E| Field (arb. u.)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Field in Propagation Space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Momentum space (after FFT)</span>
<span class="n">Qr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r_wire</span><span class="p">),</span> <span class="n">r_wire</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_wire</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">Ex_wire_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Ex_wire</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Qr_plot</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ex_wire_shifted</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;QW Field (momentum space)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Momentum ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|E| Field (arb. u.)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Field in QW Momentum Space (after FFT)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>Polarization Calculation<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>Calculate the quantum wire polarization from a coherence matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a simple coherence matrix (electron-hole coherence)</span>
<span class="c1"># In real simulations, this comes from solving the SBEs</span>
<span class="n">p_cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_k</span><span class="p">,</span> <span class="n">N_k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Create a simple Gaussian coherence centered at k=0</span>
<span class="n">k_center</span> <span class="o">=</span> <span class="n">N_k</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">sigma_k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_k</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">kh</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_k</span><span class="p">):</span>
        <span class="n">k_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kh</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">k_center</span> <span class="o">-</span> <span class="n">k_center</span><span class="p">)</span>
        <span class="n">p_cv</span><span class="p">[</span><span class="n">kh</span><span class="p">,</span> <span class="n">ke</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k_diff</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_k</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e-3</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">)</span>

<span class="c1"># Arrays for polarization (will be modified in-place)</span>
<span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Calculate polarization</span>
<span class="n">qwoptics</span><span class="o">.</span><span class="n">QWPolarization3</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">r_wire</span><span class="p">,</span>       <span class="c1"># Spatial coordinate array</span>
    <span class="n">ky</span><span class="o">=</span><span class="n">kr</span><span class="p">,</span>          <span class="c1"># Momentum coordinate array</span>
    <span class="n">p</span><span class="o">=</span><span class="n">p_cv</span><span class="p">,</span>         <span class="c1"># Density matrix (coherence)</span>
    <span class="n">ehint</span><span class="o">=</span><span class="n">ehint</span><span class="p">,</span>    <span class="c1"># Electron-hole overlap integral</span>
    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>      <span class="c1"># Wire area</span>
    <span class="n">L</span><span class="o">=</span><span class="n">L_wire</span><span class="p">,</span>       <span class="c1"># Wire length</span>
    <span class="n">Px</span><span class="o">=</span><span class="n">Px</span><span class="p">,</span>          <span class="c1"># X polarization (output)</span>
    <span class="n">Py</span><span class="o">=</span><span class="n">Py</span><span class="p">,</span>          <span class="c1"># Y polarization (output)</span>
    <span class="n">Pz</span><span class="o">=</span><span class="n">Pz</span><span class="p">,</span>          <span class="c1"># Z polarization (output)</span>
    <span class="n">xxx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>          <span class="c1"># Time index</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">1</span>             <span class="c1"># Wire index</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Polarization calculation complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization arrays shape: </span><span class="si">{</span><span class="n">Px</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Px magnitude range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Px</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Px</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize polarization components</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Real space polarization (inverse FFT to get back to real space)</span>
<span class="c1"># Note: QWPolarization3 performs FFT, so Px is in momentum space</span>
<span class="c1"># For visualization, we inverse FFT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.usefulsubs</span><span class="w"> </span><span class="kn">import</span> <span class="n">iFFTG</span>

<span class="n">Px_r</span> <span class="o">=</span> <span class="n">Px</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Py_r</span> <span class="o">=</span> <span class="n">Py</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Pz_r</span> <span class="o">=</span> <span class="n">Pz</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">iFFTG</span><span class="p">(</span><span class="n">Px_r</span><span class="p">)</span>
<span class="n">iFFTG</span><span class="p">(</span><span class="n">Py_r</span><span class="p">)</span>
<span class="n">iFFTG</span><span class="p">(</span><span class="n">Pz_r</span><span class="p">)</span>

<span class="c1"># X component</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Px_r</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Px_r</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;X Polarization Component&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Y component</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Py_r</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Py_r</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Y Polarization Component&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Z component</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Pz_r</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Pz_r</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Z Polarization Component&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Total magnitude</span>
<span class="n">P_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Px_r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Py_r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Pz_r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">P_tot</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|P| (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total Polarization Magnitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>Charge Density Calculation<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>Calculate electron and hole charge densities from coherence matrices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create coherence matrices (electron-electron and hole-hole)</span>
<span class="c1"># In real simulations, these come from solving the SBEs</span>
<span class="n">CC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_k</span><span class="p">,</span> <span class="n">N_k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># Electron-electron coherence</span>
<span class="n">DD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_k</span><span class="p">,</span> <span class="n">N_k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># Hole-hole coherence</span>

<span class="c1"># Create simple diagonal coherence (carriers at k=0)</span>
<span class="n">k_center</span> <span class="o">=</span> <span class="n">N_k</span> <span class="o">//</span> <span class="mi">2</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_k</span><span class="p">):</span>
    <span class="n">CC</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="n">k_center</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Electron occupation</span>
    <span class="n">DD</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="n">k_center</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Hole occupation</span>

<span class="c1"># Occupation numbers (for normalization)</span>
<span class="n">ne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">nh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">DD</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Momentum difference matrix (simplified - identity mapping)</span>
<span class="n">kkp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_k</span><span class="p">,</span> <span class="n">N_k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_k</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_k</span><span class="p">):</span>
        <span class="n">kkp</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span>  <span class="c1"># Simple difference</span>

<span class="c1"># Arrays for charge densities (will be modified in-place)</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">rh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">r_wire</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Calculate charge densities</span>
<span class="n">qwoptics</span><span class="o">.</span><span class="n">QWRho5</span><span class="p">(</span>
    <span class="n">Qr</span><span class="o">=</span><span class="n">Qr</span><span class="p">,</span>          <span class="c1"># QW momentum array</span>
    <span class="n">kr</span><span class="o">=</span><span class="n">kr</span><span class="p">,</span>          <span class="c1"># QW momentum array</span>
    <span class="n">R</span><span class="o">=</span><span class="n">r_wire</span><span class="p">,</span>       <span class="c1"># QW spatial coordinate array</span>
    <span class="n">L</span><span class="o">=</span><span class="n">L_wire</span><span class="p">,</span>       <span class="c1"># Wire length</span>
    <span class="n">kkp</span><span class="o">=</span><span class="n">kkp</span><span class="p">,</span>        <span class="c1"># Momentum difference index matrix</span>
    <span class="n">p</span><span class="o">=</span><span class="n">p_cv</span><span class="p">,</span>         <span class="c1"># Density matrix (unused, for compatibility)</span>
    <span class="n">CC</span><span class="o">=</span><span class="n">CC</span><span class="p">,</span>          <span class="c1"># Electron-electron coherence matrix</span>
    <span class="n">DD</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span>          <span class="c1"># Hole-hole coherence matrix</span>
    <span class="n">ne</span><span class="o">=</span><span class="n">ne</span><span class="p">,</span>          <span class="c1"># Electron occupation numbers</span>
    <span class="n">nh</span><span class="o">=</span><span class="n">nh</span><span class="p">,</span>          <span class="c1"># Hole occupation numbers</span>
    <span class="n">re</span><span class="o">=</span><span class="n">re</span><span class="p">,</span>          <span class="c1"># Electron charge density (output)</span>
    <span class="n">rh</span><span class="o">=</span><span class="n">rh</span><span class="p">,</span>          <span class="c1"># Hole charge density (output)</span>
    <span class="n">xxx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>          <span class="c1"># Time index</span>
    <span class="n">jjj</span><span class="o">=</span><span class="mi">1</span>           <span class="c1"># Additional index (unused)</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Charge density calculation complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron density range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">re</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">re</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hole density range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rh</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rh</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>

<span class="c1"># Visualize charge densities</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Inverse FFT to get real space densities</span>
<span class="n">re_r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rh_r</span> <span class="o">=</span> <span class="n">rh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">iFFTG</span><span class="p">(</span><span class="n">re_r</span><span class="p">)</span>
<span class="n">iFFTG</span><span class="p">(</span><span class="n">rh_r</span><span class="p">)</span>

<span class="c1"># Electron density</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">re_r</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electron density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">re_r</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Charge Density (m⁻³)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron Charge Density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Hole density</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">rh_r</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hole density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">rh_r</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Charge Density (m⁻³)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hole Charge Density&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="field-projection-qw-to-propagation">
<h2>Field Projection: QW to Propagation<a class="headerlink" href="#field-projection-qw-to-propagation" title="Link to this heading"></a></h2>
<p>Convert QW fields back to propagation space:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare arrays for propagation space outputs</span>
<span class="n">Pxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">RhoE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">RhoH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Convert QW fields back to propagation space</span>
<span class="n">qwoptics</span><span class="o">.</span><span class="n">QW2Prop</span><span class="p">(</span>
    <span class="n">r</span><span class="o">=</span><span class="n">r_wire</span><span class="p">,</span>       <span class="c1"># QW spatial array</span>
    <span class="n">Qr</span><span class="o">=</span><span class="n">Qr</span><span class="p">,</span>          <span class="c1"># QW momentum array</span>
    <span class="n">Ex</span><span class="o">=</span><span class="n">Ex_wire</span><span class="p">,</span>     <span class="c1"># QW X field (modified in-place)</span>
    <span class="n">Ey</span><span class="o">=</span><span class="n">Ey_wire</span><span class="p">,</span>     <span class="c1"># QW Y field (modified in-place)</span>
    <span class="n">Ez</span><span class="o">=</span><span class="n">Ez_wire</span><span class="p">,</span>     <span class="c1"># QW Z field (modified in-place)</span>
    <span class="n">Vr</span><span class="o">=</span><span class="n">V_wire</span><span class="p">,</span>      <span class="c1"># QW potential (modified in-place)</span>
    <span class="n">Px</span><span class="o">=</span><span class="n">Px</span><span class="p">,</span>          <span class="c1"># QW X polarization (modified in-place)</span>
    <span class="n">Py</span><span class="o">=</span><span class="n">Py</span><span class="p">,</span>          <span class="c1"># QW Y polarization (modified in-place)</span>
    <span class="n">Pz</span><span class="o">=</span><span class="n">Pz</span><span class="p">,</span>          <span class="c1"># QW Z polarization (modified in-place)</span>
    <span class="n">re</span><span class="o">=</span><span class="n">re</span><span class="p">,</span>          <span class="c1"># QW electron density (modified in-place)</span>
    <span class="n">rh</span><span class="o">=</span><span class="n">rh</span><span class="p">,</span>          <span class="c1"># QW hole density (modified in-place)</span>
    <span class="n">RR</span><span class="o">=</span><span class="n">R_prop</span><span class="p">,</span>      <span class="c1"># Propagation spatial array</span>
    <span class="n">Pxx</span><span class="o">=</span><span class="n">Pxx</span><span class="p">,</span>        <span class="c1"># Propagation X polarization (output)</span>
    <span class="n">Pyy</span><span class="o">=</span><span class="n">Pyy</span><span class="p">,</span>        <span class="c1"># Propagation Y polarization (output)</span>
    <span class="n">Pzz</span><span class="o">=</span><span class="n">Pzz</span><span class="p">,</span>        <span class="c1"># Propagation Z polarization (output)</span>
    <span class="n">RhoE</span><span class="o">=</span><span class="n">RhoE</span><span class="p">,</span>      <span class="c1"># Propagation electron density (output)</span>
    <span class="n">RhoH</span><span class="o">=</span><span class="n">RhoH</span><span class="p">,</span>      <span class="c1"># Propagation hole density (output)</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>            <span class="c1"># Wire index</span>
    <span class="n">xxx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>          <span class="c1"># Time index</span>
    <span class="n">WriteFields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Don&#39;t write to files</span>
    <span class="n">Plasmonics</span><span class="o">=</span><span class="kc">True</span>     <span class="c1"># Normalize charge densities</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field projection to propagation space complete&quot;</span><span class="p">)</span>

<span class="c1"># Visualize round-trip projection</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Polarization components</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;X Polarization in Propagation Space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Charge densities</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">RhoE</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electrons&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">RhoH</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Holes&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Charge Density (m⁻³)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Charge Densities in Propagation Space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Net charge</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">RhoH</span> <span class="o">-</span> <span class="n">RhoE</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Net Charge Density (m⁻³)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Net Charge (Holes - Electrons)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Comparison: QW vs Propagation polarization</span>
<span class="c1"># Get QW polarization in real space for comparison</span>
<span class="n">Px_qw_rs</span> <span class="o">=</span> <span class="n">Px</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">iFFTG</span><span class="p">(</span><span class="n">Px_qw_rs</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_wire</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Px_qw_rs</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;QW space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Propagation space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Polarization: QW vs Propagation Space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L_wire</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>Linear Susceptibility<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>Calculate the linear optical susceptibility as a function of wavelength:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Wavelength range for susceptibility calculation</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">600e-9</span><span class="p">,</span> <span class="mf">1000e-9</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># 600-1000 nm</span>
<span class="n">dky</span> <span class="o">=</span> <span class="n">kr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">kr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Momentum step</span>
<span class="n">geh</span> <span class="o">=</span> <span class="mf">1e12</span>  <span class="c1"># Electron-hole dephasing rate (1/s)</span>

<span class="c1"># Calculate susceptibility for each wavelength</span>
<span class="n">chi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lam</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">):</span>
    <span class="n">chi1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">qwoptics</span><span class="o">.</span><span class="n">QWChi1</span><span class="p">(</span>
        <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span>        <span class="c1"># Wavelength</span>
        <span class="n">dky</span><span class="o">=</span><span class="n">dky</span><span class="p">,</span>        <span class="c1"># Momentum step</span>
        <span class="n">Ee</span><span class="o">=</span><span class="n">Ee</span><span class="p">,</span>          <span class="c1"># Electron energies</span>
        <span class="n">Eh</span><span class="o">=</span><span class="n">Eh</span><span class="p">,</span>          <span class="c1"># Hole energies</span>
        <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>      <span class="c1"># Wire area</span>
        <span class="n">geh</span><span class="o">=</span><span class="n">geh</span><span class="p">,</span>        <span class="c1"># Dephasing rate</span>
        <span class="n">dcv</span><span class="o">=</span><span class="n">dcv</span>         <span class="c1"># Dipole moment</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Susceptibility calculation complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Susceptibility range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Convert wavelengths to photon energies</span>
<span class="n">photon_energy</span> <span class="o">=</span> <span class="n">hbar</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">wavelengths</span> <span class="o">/</span> <span class="n">e0</span>  <span class="c1"># eV</span>

<span class="c1"># Visualize susceptibility</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Real and imaginary parts</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">photon_energy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">chi1</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real part&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">photon_energy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">chi1</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imaginary part&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Photon Energy (eV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Susceptibility&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Linear Susceptibility vs Photon Energy&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">gap</span><span class="o">/</span><span class="n">e0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band gap (</span><span class="si">{</span><span class="n">gap</span><span class="o">/</span><span class="n">e0</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> eV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Magnitude and phase</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">photon_energy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chi1</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">photon_energy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">chi1</span><span class="p">),</span> <span class="s1">&#39;m--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phase&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Photon Energy (eV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|χ|&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (rad)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Susceptibility Magnitude and Phase&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">gap</span><span class="o">/</span><span class="n">e0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calculate absorption coefficient from imaginary part</span>
<span class="c1"># alpha = (2*omega/c) * Im(chi)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">wavelengths</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">chi1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">photon_energy</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Photon Energy (eV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absorption Coefficient (m⁻¹)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Absorption Coefficient vs Photon Energy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">gap</span><span class="o">/</span><span class="n">e0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band gap (</span><span class="si">{</span><span class="n">gap</span><span class="o">/</span><span class="n">e0</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> eV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="assumptions-and-parameter-choices">
<h2>Assumptions and Parameter Choices<a class="headerlink" href="#assumptions-and-parameter-choices" title="Link to this heading"></a></h2>
<p>This section explains the assumptions and rationale behind the parameter values chosen for this example.</p>
<section id="material-parameters-gaas">
<h3>Material Parameters (GaAs)<a class="headerlink" href="#material-parameters-gaas" title="Link to this heading"></a></h3>
<p><strong>Effective masses:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">m_e</span> <span class="pre">=</span> <span class="pre">0.067</span> <span class="pre">*</span> <span class="pre">m_0</span></code>: Electron effective mass for GaAs (bulk value ~0.067m₀)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m_h</span> <span class="pre">=</span> <span class="pre">0.45</span> <span class="pre">*</span> <span class="pre">m_0</span></code>: Heavy hole effective mass for GaAs (bulk value ~0.45m₀)</p></li>
<li><p><strong>Rationale</strong>: Standard GaAs bulk values. Quantum confinement may modify these, but bulk values are reasonable for demonstration.</p></li>
</ul>
<p><strong>Band gap:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gap</span> <span class="pre">=</span> <span class="pre">1.42</span> <span class="pre">*</span> <span class="pre">e0</span></code>: GaAs band gap at room temperature (~1.42 eV)</p></li>
<li><p><strong>Rationale</strong>: Standard value for bulk GaAs. Quantum confinement increases the gap, but we use bulk value for simplicity.</p></li>
</ul>
<p><strong>Dipole moment:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dcv</span> <span class="pre">=</span> <span class="pre">1e-29</span> <span class="pre">C·m</span></code>: Interband dipole moment</p></li>
<li><p><strong>Rationale</strong>: Typical order of magnitude for semiconductor interband transitions. Actual value depends on material and confinement.</p></li>
</ul>
<p><strong>Dielectric constant:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">epsr</span> <span class="pre">=</span> <span class="pre">9.1</span></code>: Relative permittivity (set in module, not shown in example)</p></li>
<li><p><strong>Rationale</strong>: GaAs relative permittivity at optical frequencies.</p></li>
</ul>
</section>
<section id="wire-dimensions">
<h3>Wire Dimensions<a class="headerlink" href="#wire-dimensions" title="Link to this heading"></a></h3>
<p><strong>Wire length:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">L_wire</span> <span class="pre">=</span> <span class="pre">100e-9</span></code>: 100 nm wire length</p></li>
<li><p><strong>Rationale</strong>: Representative of quantum wire dimensions. Long enough to show confinement effects, short enough for computational efficiency.</p></li>
</ul>
<p><strong>Wire area:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">area</span> <span class="pre">=</span> <span class="pre">1e-14</span> <span class="pre">m²</span></code>: 10 nm² cross-sectional area</p></li>
<li><p><strong>Rationale</strong>: Typical quantum wire cross-section. Affects density of states and Coulomb interactions.</p></li>
</ul>
<p><strong>Overlap integral:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ehint</span> <span class="pre">=</span> <span class="pre">0.8</span></code>: Electron-hole overlap integral</p></li>
<li><p><strong>Rationale</strong>: Simplified value. In reality, this depends on confinement wavefunctions and should be calculated from the actual eigenstates.</p></li>
</ul>
</section>
<section id="grid-parameters">
<h3>Grid Parameters<a class="headerlink" href="#grid-parameters" title="Link to this heading"></a></h3>
<p><strong>Spatial grids:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">N_prop</span> <span class="pre">=</span> <span class="pre">256</span></code>: Propagation space grid points</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N_qw</span> <span class="pre">=</span> <span class="pre">128</span></code>: Quantum wire space grid points</p></li>
<li><p><strong>Rationale</strong>: Propagation space needs finer grid to resolve pulse propagation. QW space grid should be sufficient to resolve wire confinement.</p></li>
</ul>
<p><strong>Momentum grid:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">N_k</span> <span class="pre">=</span> <span class="pre">64</span></code>: Momentum space grid points</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kmax</span> <span class="pre">=</span> <span class="pre">1e8</span> <span class="pre">m⁻¹</span></code>: Maximum momentum</p></li>
<li><p><strong>Rationale</strong>: Should cover relevant k-space for carriers. In real simulations, this is determined by energy cutoff.</p></li>
</ul>
</section>
<section id="simplifications">
<h3>Simplifications<a class="headerlink" href="#simplifications" title="Link to this heading"></a></h3>
<p><strong>Coherence matrices:</strong></p>
<ul class="simple">
<li><p>Static, simplified coherence matrices (Gaussian distributions)</p></li>
<li><p><strong>Reality</strong>: In full simulations, these evolve according to the SBEs and depend on field strength, Coulomb interactions, phonons, etc.</p></li>
</ul>
<p><strong>Energy bands:</strong></p>
<ul class="simple">
<li><p>Parabolic bands: <span class="math notranslate nohighlight">\(E(k) = \hbar^2 k^2 / (2m)\)</span></p></li>
<li><p><strong>Reality</strong>: Quantum confinement modifies the band structure. Full calculations should use actual eigenenergies.</p></li>
</ul>
<p><strong>Dephasing:</strong></p>
<ul class="simple">
<li><p>Constant dephasing rate <code class="docutils literal notranslate"><span class="pre">geh</span> <span class="pre">=</span> <span class="pre">1e12</span> <span class="pre">s⁻¹</span></code></p></li>
<li><p><strong>Reality</strong>: Dephasing depends on temperature, carrier density, and momentum. Should be calculated from phonon and carrier-carrier scattering.</p></li>
</ul>
<p><strong>Window function:</strong></p>
<ul class="simple">
<li><p>Simple exponential: <span class="math notranslate nohighlight">\(\exp(-(r/(L/2))^{150})\)</span></p></li>
<li><p><strong>Reality</strong>: Actual confinement potential may have different shape. Window function is a computational convenience.</p></li>
</ul>
</section>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Link to this heading"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Important Limitations:</strong></p>
<ol class="arabic simple">
<li><p><strong>Static distributions</strong>: Carrier distributions are static. Full simulations require coupling with the SBE solver.</p></li>
<li><p><strong>Simplified coherence</strong>: Coherence matrices are simplified. Real calculations require solving the full SBEs.</p></li>
<li><p><strong>No Coulomb effects</strong>: This example doesn’t include Coulomb interactions. Use the <code class="docutils literal notranslate"><span class="pre">coulomb</span></code> module for realistic calculations.</p></li>
<li><p><strong>No phonon effects</strong>: Phonon scattering is not included. Use the <code class="docutils literal notranslate"><span class="pre">phonons</span></code> module for temperature-dependent effects.</p></li>
<li><p><strong>Single wire</strong>: Example shows single wire. Multi-wire systems require additional considerations.</p></li>
<li><p><strong>Linear response</strong>: Susceptibility calculation assumes linear response. Nonlinear effects require full SBE solution.</p></li>
</ol>
</div>
</section>
<section id="when-to-use-more-realistic-approaches">
<h3>When to Use More Realistic Approaches<a class="headerlink" href="#when-to-use-more-realistic-approaches" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Full SBE simulations</strong>: When studying dynamics, use the <code class="docutils literal notranslate"><span class="pre">SBEs</span></code> module which couples all effects.</p></li>
<li><p><strong>Coulomb interactions</strong>: For many-body effects, include the <code class="docutils literal notranslate"><span class="pre">coulomb</span></code> module.</p></li>
<li><p><strong>Phonon scattering</strong>: For temperature-dependent effects, include the <code class="docutils literal notranslate"><span class="pre">phonons</span></code> module.</p></li>
<li><p><strong>DC field transport</strong>: For carrier transport, include the <code class="docutils literal notranslate"><span class="pre">dcfield</span></code> module.</p></li>
<li><p><strong>Emission</strong>: For photoluminescence, include the <code class="docutils literal notranslate"><span class="pre">emission</span></code> module.</p></li>
</ul>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>This tutorial demonstrated the key functions of the <code class="docutils literal notranslate"><span class="pre">qwoptics</span></code> module:</p>
<ol class="arabic simple">
<li><p><strong>Field Projection</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Prop2QW</span></code>: Converts Maxwell fields from propagation space to QW space</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QW2Prop</span></code>: Converts QW fields back to propagation space</p></li>
</ul>
</li>
<li><p><strong>Initialization</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">InitializeQWOptics</span></code>: Sets up dipole matrices, phase factors, and window function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CalcQWWindow</span></code>: Calculates quantum wire window function</p></li>
</ul>
</li>
<li><p><strong>Polarization</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QWPolarization3</span></code>: Calculates quantum wire polarization from coherence matrix</p></li>
</ul>
</li>
<li><p><strong>Charge Density</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QWRho5</span></code>: Calculates electron and hole charge densities from coherence matrices</p></li>
</ul>
</li>
<li><p><strong>Linear Susceptibility</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QWChi1</span></code>: Calculates frequency-dependent linear optical susceptibility</p></li>
</ul>
</li>
</ol>
<p>The module provides the essential interface between macroscopic Maxwell propagation and microscopic quantum wire dynamics, enabling self-consistent simulations of light-matter interactions in quantum wire systems.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="phonons_example.myst.html" class="btn btn-neutral float-left" title="Phonon Interactions in Quantum Wires" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../autoapi/index.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, PulseSuite Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>