:py:mod:`PSTD3D.phost`
======================

.. py:module:: PSTD3D.phost

.. autoapi-nested-parse::

   Host material polarization calculations for quantum wire simulations.

   This module calculates the host material polarization response
   for propagation simulations.

   Author: Rahul R. Sah



Module Contents
---------------


Functions
~~~~~~~~~

.. autoapisummary::

   PSTD3D.phost.CalcPHost
   PSTD3D.phost.CalcPHostOld
   PSTD3D.phost.CalcNextP
   PSTD3D.phost.CalcMonoP
   PSTD3D.phost.SetHostMaterial
   PSTD3D.phost.InitializeHost
   PSTD3D.phost.CalcWq
   PSTD3D.phost.CalcEpsrWq
   PSTD3D.phost.CalcEpsrWq_ij
   PSTD3D.phost.DetermineCoeffs
   PSTD3D.phost.Epsr_q
   PSTD3D.phost.Epsr_qij
   PSTD3D.phost.FDTD_Dispersion
   PSTD3D.phost.wq
   PSTD3D.phost.SetInitialP
   PSTD3D.phost.MakeTransverse
   PSTD3D.phost.SetParamsSilica
   PSTD3D.phost.SetParamsGaAs
   PSTD3D.phost.SetParamsAlAs
   PSTD3D.phost.SetParamsNone
   PSTD3D.phost.nw2_no_gam
   PSTD3D.phost.nw2
   PSTD3D.phost.IFFT
   PSTD3D.phost.nwp_no_gam
   PSTD3D.phost.epsrwp_no_gam
   PSTD3D.phost.nwp
   PSTD3D.phost.nl2_no_gam
   PSTD3D.phost.nl2
   PSTD3D.phost.WriteHostDispersion



Attributes
~~~~~~~~~~

.. autoapisummary::

   PSTD3D.phost.eps0_val
   PSTD3D.phost.c0
   PSTD3D.phost.me0_val
   PSTD3D.phost.pi
   PSTD3D.phost.twopi
   PSTD3D.phost.ii


.. py:data:: eps0_val

   

.. py:data:: c0

   

.. py:data:: me0_val

   

.. py:data:: pi

   

.. py:data:: twopi

   

.. py:data:: ii
   :value: 1j

   

.. py:function:: CalcPHost(Ex, Ey, dt, m, epsb, Px, Py)

   Calculate host material polarization.

   Computes the host material polarization response using a time-stepping
   scheme with previous, current, and next polarization values.

   :param Ex: Electric field x-component, shape (N1, N2), complex
   :type Ex: ndarray
   :param Ey: Electric field y-component, shape (N1, N2), complex
   :type Ey: ndarray
   :param dt: Time step (s)
   :type dt: float
   :param m: Time step index (unused, kept for interface compatibility)
   :type m: int
   :param epsb: Dielectric constant (modified in-place)
   :type epsb: float
   :param Px: Polarization x-component (modified in-place), shape (N1, N2), complex
   :type Px: ndarray
   :param Py: Polarization y-component (modified in-place), shape (N1, N2), complex
   :type Py: ndarray

   :rtype: None

   .. rubric:: Notes

   Modifies epsb, Px, Py in-place.
   Uses module-level variables _Px_before, _Px_now, _Px_after, etc.
   The polarization is summed over the oscillator dimension (axis 2).


.. py:function:: CalcPHostOld(Ex, Ey, dt, m, epsb, Px, Py)

   Calculate host material polarization (old version).

   Computes the host material polarization response using a time-stepping
   scheme with different initialization depending on the time step index m.

   :param Ex: Electric field x-component, shape (N1, N2), complex
   :type Ex: ndarray
   :param Ey: Electric field y-component, shape (N1, N2), complex
   :type Ey: ndarray
   :param dt: Time step (s)
   :type dt: float
   :param m: Time step index
   :type m: int
   :param epsb: Dielectric constant (modified in-place)
   :type epsb: float
   :param Px: Polarization x-component (modified in-place), shape (N1, N2), complex
   :type Px: ndarray
   :param Py: Polarization y-component (modified in-place), shape (N1, N2), complex
   :type Py: ndarray

   :rtype: None

   .. rubric:: Notes

   Modifies epsb, Px, Py in-place.
   Uses module-level variables _Px_before, _Px_now, _Px_after, etc.
   The behavior depends on m:
   - m > 2: Use previous values and calculate next
   - m >= 2: Initialize with monochromatic polarization, then calculate next
   - m < 2: Initialize with monochromatic polarization, set next to zero


.. py:function:: CalcNextP(P1, P2, E, dt)

   Calculate next polarization value.

   Computes the next polarization value using a finite difference scheme
   for the oscillator model.

   :param P1: Previous polarization values, shape (N1, N2, osc), complex
   :type P1: ndarray
   :param P2: Current polarization values, shape (N1, N2, osc), complex
   :type P2: ndarray
   :param E: Electric field, shape (N1, N2), complex
   :type E: ndarray
   :param dt: Time step (s)
   :type dt: float

   :returns: Next polarization values, shape (N1, N2, osc), complex
   :rtype: ndarray

   .. rubric:: Notes

   Uses module-level variables _gam, _w, _B, _osc.
   The function computes:
   CalcNextP = f1 * P1 + f2 * P2 + f3 * E
   where f1, f2, f3 are frequency-dependent coefficients.


.. py:function:: CalcMonoP(E)

   Calculate monochromatic polarization.

   Computes the polarization for a monochromatic electric field
   using the linear susceptibility.

   :param E: Electric field, shape (N1, N2), complex
   :type E: ndarray

   :returns: Polarization values, shape (N1, N2, osc), complex
   :rtype: ndarray

   .. rubric:: Notes

   Uses module-level variables _chi1, _osc.
   The function computes:
   CalcMonoP = eps0 * E * real(chi1)


.. py:function:: SetHostMaterial(host, mat, lam, epsr, n0)

   Set host material parameters.

   Initializes the host material parameters based on the material type
   and wavelength.

   :param host: Whether to use host material dispersion
   :type host: bool
   :param mat: Material name ('AlAs', 'fsil', 'GaAs', 'none')
   :type mat: str
   :param lam: Wavelength (m)
   :type lam: float
   :param epsr: Dielectric constant (modified in-place)
   :type epsr: float
   :param n0: Refractive index (modified in-place)
   :type n0: float

   :rtype: None

   .. rubric:: Notes

   Modifies epsr and n0 in-place.
   Sets module-level variables based on material type.
   Calls SetParamsAlAs, SetParamsSilica, SetParamsGaAs, or SetParamsNone
   based on material type, and WriteHostDispersion if host=True.


.. py:function:: InitializeHost(Nx, Ny, n0, qsq, host)

   Initialize host material arrays.

   Allocates and initializes arrays for host material calculations.

   :param Nx: Number of points in x-direction
   :type Nx: int
   :param Ny: Number of points in y-direction
   :type Ny: int
   :param n0: Refractive index
   :type n0: float
   :param qsq: Squared momentum array, shape (Nx, Ny), complex
   :type qsq: ndarray
   :param host: Whether to use host material dispersion
   :type host: bool

   :rtype: None

   .. rubric:: Notes

   Sets module-level arrays _omega_q, _EpsrWq, and polarization arrays.
   When host=False, _EpsrWq is set to an array with all elements equal to n0**2.


.. py:function:: CalcWq(q)

   Calculate frequency from momentum.

   Computes the frequency omega_q from momentum q using the
   dispersion relation.

   :param q: Momentum array, shape (N1, N2), complex
   :type q: ndarray

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variable _omega_q.
   Writes output to 'fields/host/w.q.dat'.


.. py:function:: CalcEpsrWq(q)

   Calculate dielectric constant as function of frequency.

   Computes the dielectric constant for each frequency in omega_q.

   :param q: Momentum array, shape (N1, N2), complex (unused, kept for interface compatibility)
   :type q: ndarray

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variable _EpsrWq.
   Uses DetermineCoeffs and CalcEpsrWq_ij.


.. py:function:: CalcEpsrWq_ij(w_ij, aw, bw)

   Calculate dielectric constant for a single frequency.

   Computes the dielectric constant using piecewise interpolation
   or the full model depending on frequency range.

   :param w_ij: Frequency (Hz)
   :type w_ij: float
   :param aw: Low-frequency expansion coefficients, shape (2)
   :type aw: ndarray
   :param bw: High-frequency expansion coefficients, shape (2)
   :type bw: ndarray

   :returns: Dielectric constant value
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _epsr_0, _epsr_infty, _w1, _w2.
   Note: In Fortran, this is a subroutine with inout parameter;
   in Python, it's a function that returns the value (functionally equivalent).


.. py:function:: DetermineCoeffs(aw, bw)

   Determine expansion coefficients.

   Computes the expansion coefficients for low and high frequency
   approximations of the dielectric constant.

   :param aw: Low-frequency expansion coefficients (modified in-place), shape (2)
   :type aw: ndarray
   :param bw: High-frequency expansion coefficients (modified in-place), shape (2)
   :type bw: ndarray

   :rtype: None

   .. rubric:: Notes

   Modifies aw and bw in-place.
   Uses module-level variables _w1, _w2, _epsr_0, _epsr_infty.


.. py:function:: Epsr_q(q)

   Get dielectric constant array.

   Returns the dielectric constant array as a function of momentum.

   :param q: Momentum array, shape (N1, N2), complex (unused, kept for interface compatibility)
   :type q: ndarray

   :returns: Dielectric constant array, shape (N1, N2), complex
   :rtype: ndarray

   .. rubric:: Notes

   Returns module-level variable _EpsrWq.


.. py:function:: Epsr_qij(i, j)

   Get dielectric constant at specific indices.

   Returns the dielectric constant at indices (i, j).

   :param i: First index
   :type i: int
   :param j: Second index
   :type j: int

   :returns: Dielectric constant value at (i, j)
   :rtype: complex

   .. rubric:: Notes

   Returns value from module-level variable _EpsrWq.


.. py:function:: FDTD_Dispersion(qx, qy, dx, dy, dt, n0)

   Calculate FDTD dispersion relation.

   Computes the frequency from momentum using the FDTD dispersion relation.

   :param qx: x-component of momentum (1/m), 1D array
   :type qx: ndarray
   :param qy: y-component of momentum (1/m), 1D array
   :type qy: ndarray
   :param dx: Spatial step in x-direction (m)
   :type dx: float
   :param dy: Spatial step in y-direction (m)
   :type dy: float
   :param dt: Time step (s)
   :type dt: float
   :param n0: Refractive index
   :type n0: float

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variable _omega_q.
   Uses Sin and ASin functions (np.sin and np.arcsin).


.. py:function:: wq(i, j)

   Get frequency at specific indices.

   Returns the frequency at indices (i, j).

   :param i: First index
   :type i: int
   :param j: Second index
   :type j: int

   :returns: Frequency value at (i, j)
   :rtype: complex

   .. rubric:: Notes

   Returns value from module-level variable _omega_q.


.. py:function:: SetInitialP(Ex, Ey, qx, qy, qsq, dt, Px, Py, epsb)

   Set initial polarization values.

   Initializes the polarization arrays for the first time step.

   :param Ex: Electric field x-component (modified in-place), shape (N1, N2), complex
   :type Ex: ndarray
   :param Ey: Electric field y-component (modified in-place), shape (N1, N2), complex
   :type Ey: ndarray
   :param qx: x-component of momentum (1/m), 1D array
   :type qx: ndarray
   :param qy: y-component of momentum (1/m), 1D array
   :type qy: ndarray
   :param qsq: Squared momentum array, shape (N1, N2), complex
   :type qsq: ndarray
   :param dt: Time step (s)
   :type dt: float
   :param Px: Polarization x-component (modified in-place), shape (N1, N2), complex
   :type Px: ndarray
   :param Py: Polarization y-component (modified in-place), shape (N1, N2), complex
   :type Py: ndarray
   :param epsb: Dielectric constant (modified in-place)
   :type epsb: float

   :rtype: None

   .. rubric:: Notes

   Modifies Ex, Ey, Px, Py, epsb in-place.
   Uses module-level variables _Px_after, _Px_now, _Py_after, _Py_now, _omega_q, _A0, _B, _w, _osc.


.. py:function:: MakeTransverse(Ex, Ey, qx, qy, qsq)

   Make electric field transverse.

   Projects the electric field onto the transverse direction
   perpendicular to the momentum vector.

   :param Ex: Electric field x-component (modified in-place), shape (N1, N2), complex
   :type Ex: ndarray
   :param Ey: Electric field y-component (modified in-place), shape (N1, N2), complex
   :type Ey: ndarray
   :param qx: x-component of momentum (1/m), 1D array
   :type qx: ndarray
   :param qy: y-component of momentum (1/m), 1D array
   :type qy: ndarray
   :param qsq: Squared momentum array, shape (N1, N2), complex
   :type qsq: ndarray

   :rtype: None

   .. rubric:: Notes

   Modifies Ex and Ey in-place.
   Projects out the longitudinal component: E = E - q * (q Â· E) / |q|^2


.. py:function:: SetParamsSilica()

   Set material parameters for silica.

   Initializes oscillator parameters for silica material model.

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variables _osc, _B, _C, _w, _gam, _Nf, _A0, _epsr_0, _epsr_infty.
   Uses Sellmeier coefficients for silica.


.. py:function:: SetParamsGaAs()

   Set material parameters for GaAs.

   Initializes oscillator parameters for GaAs material model.

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variables _osc, _B, _C, _w, _gam, _Nf, _A0, _epsr_0, _epsr_infty.
   Uses Sellmeier coefficients for GaAs.


.. py:function:: SetParamsAlAs()

   Set material parameters for AlAs.

   Initializes oscillator parameters for AlAs material model.

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variables _osc, _B, _C, _w, _gam, _Nf, _A0, _epsr_0, _epsr_infty, _w1, _w2.
   Uses Sellmeier coefficients for AlAs.


.. py:function:: SetParamsNone()

   Set material parameters for vacuum (no material).

   Initializes oscillator parameters for vacuum (no dispersion).

   :rtype: None

   .. rubric:: Notes

   Modifies module-level variables _osc, _B, _C, _w, _gam, _Nf, _A0, _epsr_0, _epsr_infty.
   Sets all parameters to vacuum values (no dispersion).


.. py:function:: nw2_no_gam(wL)

   Calculate dielectric constant without damping.
   (Somewhere below in phost.f90)

   Computes the dielectric constant using the oscillator model
   without damping: n^2 = A0 + sum(B * w^2 / (w^2 - wL^2))

   :param wL: Frequency (Hz)
   :type wL: float or complex

   :returns: Dielectric constant value (n^2)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _A0, _B, _w, _osc.


.. py:function:: nw2(wL)

   Calculate dielectric constant with damping.

   Computes the dielectric constant using the oscillator model
   with damping: n^2 = A0 + sum(B * w^2 / (w^2 - i*2*gam*wL - wL^2))

   :param wL: Frequency (Hz)
   :type wL: float or complex

   :returns: Dielectric constant value (n^2)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _A0, _B, _w, _gam, _osc.


.. py:function:: IFFT(f)

   Inverse Fast Fourier Transform wrapper. (Not the right place should be imported)

   Performs 2D IFFT on the input array.

   :param f: Input array, shape (N1, N2), complex
   :type f: ndarray

   :returns: f is modified in-place
   :rtype: None

   .. rubric:: Notes

   Uses pyfftw for FFT operations.


.. py:function:: nwp_no_gam(wL)

   Calculate derivative of refractive index without damping.

   Computes dn/dw using the oscillator model without damping.

   :param wL: Frequency (Hz)
   :type wL: float or complex

   :returns: Derivative of refractive index (dn/dw)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _B, _w, _osc.


.. py:function:: epsrwp_no_gam(wL)

   Calculate derivative of dielectric constant without damping.

   Computes depsr/dw using the oscillator model without damping.

   :param wL: Frequency (Hz)
   :type wL: float or complex

   :returns: Derivative of dielectric constant (depsr/dw)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _B, _w, _osc.


.. py:function:: nwp(wL)

   Calculate derivative of refractive index with damping.

   Computes dn/dw using the oscillator model with damping.

   :param wL: Frequency (Hz)
   :type wL: float or complex

   :returns: Derivative of refractive index (dn/dw)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _B, _w, _gam, _osc.


.. py:function:: nl2_no_gam(lam)

   Calculate dielectric constant from wavelength without damping.

   Computes the dielectric constant using the oscillator model
   without damping: n^2 = A0 + sum(B * lam^2 / (lam^2 - C))

   :param lam: Wavelength (m)
   :type lam: float

   :returns: Dielectric constant value (n^2)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _A0, _B, _C, _osc.


.. py:function:: nl2(lam)

   Calculate dielectric constant from wavelength with damping.

   Computes the dielectric constant using the oscillator model
   with damping, converting wavelength to frequency first.

   :param lam: Wavelength (m)
   :type lam: float

   :returns: Dielectric constant value (n^2)
   :rtype: complex

   .. rubric:: Notes

   Uses module-level variables _A0, _B, _w, _gam, _osc.
   Converts wavelength to frequency: wL = 2*pi*c0 / lam


.. py:function:: WriteHostDispersion()

   Write host material dispersion data to files.

   Writes refractive index and dielectric constant data
   as functions of frequency and wavelength to output files.

   :rtype: None

   .. rubric:: Notes

   Creates output files in 'fields/host/' and 'fields/host/nogam/' directories.
   Writes both real and imaginary parts of n and epsr.
   Uses module-level variables _w, _B, _osc.


