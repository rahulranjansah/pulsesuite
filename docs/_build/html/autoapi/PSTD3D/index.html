<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PSTD3D &mdash; PulseSuite 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=01f34227"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="PSTD3D.SBEs" href="SBEs/index.html" />
    <link rel="prev" title="core.typetpamedium" href="../core/typetpamedium/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PulseSuite
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">PulseSuite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery.html">Examples Gallery</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">core</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="SBEs/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.SBEs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="coulomb/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.coulomb</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="dcfield/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.dcfield</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="dephasing/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.dephasing</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="emission/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.emission</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="epsrtl/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.epsrtl</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="helpers/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.helpers</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="phonons/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.phonons</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="phost/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.phost</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="qwoptics/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.qwoptics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="rhoPJ/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.rhoPJ</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="sbetestprop/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.sbetestprop</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="sbetestpropnov30/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.sbetestpropnov30</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="typespace/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.typespace</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="usefulsubs/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.usefulsubs</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#package-contents">Package Contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#attributes">Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../spliner/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spliner</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PulseSuite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">API Reference</a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/autoapi/PSTD3D/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-PSTD3D">
<span id="pstd3d"></span><h1><a class="reference internal" href="#module-PSTD3D" title="PSTD3D"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D</span></code></a><a class="headerlink" href="#module-PSTD3D" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="SBEs/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.SBEs</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="coulomb/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.coulomb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="dcfield/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.dcfield</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="dephasing/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.dephasing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="emission/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.emission</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="epsrtl/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.epsrtl</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="helpers/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.helpers</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="phonons/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.phonons</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="phost/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.phost</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="qwoptics/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.qwoptics</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="rhoPJ/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.rhoPJ</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="sbetestprop/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.sbetestprop</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="sbetestpropnov30/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.sbetestpropnov30</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="typespace/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.typespace</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="usefulsubs/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSTD3D.usefulsubs</span></code></a></li>
</ul>
</div>
</section>
<section id="package-contents">
<h2>Package Contents<a class="headerlink" href="#package-contents" title="Link to this heading"></a></h2>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#id12" title="PSTD3D.Prop2QW"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Prop2QW</span></code></a>(RR, Exx, Eyy, Ezz, Vrr, Edc, R, Ex, Ey, Ez, ...)</p></td>
<td><p>Convert Maxwell electric fields from propagation space to QW space.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id19" title="PSTD3D.QWChi1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWChi1</span></code></a>(lam, dky, Ee, Eh, area, geh, dcv)</p></td>
<td><p>Calculate quantum wire linear susceptibility.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id13" title="PSTD3D.QW2Prop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QW2Prop</span></code></a>(r, Qr, Ex, Ey, Ez, Vr, Px, Py, Pz, re, rh, RR, ...)</p></td>
<td><p>Convert QW fields and polarizations back to propagation space.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id17" title="PSTD3D.WritePropFields"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WritePropFields</span></code></a>(y, Ex, Ey, Ez, Vr, Px, Py, Pz, Re, Rh, ...)</p></td>
<td><p>Write propagation field arrays to files.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id14" title="PSTD3D.QWPolarization3"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWPolarization3</span></code></a>(y, ky, p, ehint, area, L, Px, Py, Pz, ...)</p></td>
<td><p>Calculate QW polarization in 3D.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id18" title="PSTD3D.QWRho5"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWRho5</span></code></a>(Qr, kr, R, L, kkp, p, CC, DD, ne, nh, re, rh, ...)</p></td>
<td><p>Calculate quantum wire charge densities.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id16" title="PSTD3D.WriteSBESolns"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteSBESolns</span></code></a>(ky, ne, nh, C, D, P, Ee, Eh, w, xxx)</p></td>
<td><p>Write SBE (Semiconductor Bloch Equations) solutions to files.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id20" title="PSTD3D.InitializeQWOptics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeQWOptics</span></code></a>(RR, L, dcv, kr, Qr, Ee, Eh, ehint, ...)</p></td>
<td><p>Initialize quantum wire optics module.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id21" title="PSTD3D.Xcv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Xcv</span></code></a>(k, kp)</p></td>
<td><p>Get X dipole matrix element.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id22" title="PSTD3D.Ycv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ycv</span></code></a>(k, kp)</p></td>
<td><p>Get Y dipole matrix element.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id23" title="PSTD3D.Zcv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Zcv</span></code></a>(k, kp)</p></td>
<td><p>Get Z dipole matrix element.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id15" title="PSTD3D.yw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">yw</span></code></a>(w)</p></td>
<td><p>Calculate wire-dependent sign factor.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id0" title="PSTD3D.FFTG"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FFTG</span></code></a>(F)</p></td>
<td><p>FFT with Gaussian normalization.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id6" title="PSTD3D.iFFTG"><code class="xref py py-obj docutils literal notranslate"><span class="pre">iFFTG</span></code></a>(F)</p></td>
<td><p>IFFT with Gaussian normalization.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.printITR" title="PSTD3D.printITR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">printITR</span></code></a>(Dx, z, n, file)</p></td>
<td><p>Print real field to file with index number.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.TotalEnergy" title="PSTD3D.TotalEnergy"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TotalEnergy</span></code></a>(n, E)</p></td>
<td><p>Calculate total energy.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.Temperature" title="PSTD3D.Temperature"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Temperature</span></code></a>(n, E)</p></td>
<td><p>Calculate temperature from energy distribution.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.WriteIt" title="PSTD3D.WriteIt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteIt</span></code></a>(V, file)</p></td>
<td><p>Write array to file (interface-style wrapper).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.locator" title="PSTD3D.locator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">locator</span></code></a>(x, x0)</p></td>
<td><p>Find index in sorted array where value should be inserted.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id7" title="PSTD3D.GetArray0Index"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArray0Index</span></code></a>(x)</p></td>
<td><p>Get index of array element closest to zero.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id30" title="PSTD3D.CalcI0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcI0</span></code></a>(ne, nh, Ee, Eh, VC, dk, ky, I0)</p></td>
<td><p>Calculate total current from electron and hole distributions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id32" title="PSTD3D.CalcPD"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcPD</span></code></a>(ky, m, n)</p></td>
<td><p>Calculate momentum from distribution.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id31" title="PSTD3D.CalcVD"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcVD</span></code></a>(ky, m, n)</p></td>
<td><p>Calculate drift velocity from distribution.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id28" title="PSTD3D.InitializeDC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeDC</span></code></a>(ky, me, mh)</p></td>
<td><p>Initialize the DC field module.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id33" title="PSTD3D.GetEDrift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetEDrift</span></code></a>()</p></td>
<td><p>Get electron drift rate.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id34" title="PSTD3D.Transport"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Transport</span></code></a>(C, Edc, Eac, dt, DCTrans, k1nek2)</p></td>
<td><p>Transport step for distribution matrix (legacy code).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id29" title="PSTD3D.CalcI0n"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcI0n</span></code></a>(ne, me, ky)</p></td>
<td><p>Calculate electron current.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.WriteDephasing" title="PSTD3D.WriteDephasing"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteDephasing</span></code></a>(ky, gamE, gamH, w, xxx)</p></td>
<td><p>Write dephasing rates to files.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcGammaE" title="PSTD3D.CalcGammaE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcGammaE</span></code></a>(ky, ne0, nh0, VC, GammaE)</p></td>
<td><p>Calculate electron dephasing rate.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcGammaH" title="PSTD3D.CalcGammaH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcGammaH</span></code></a>(ky, ne0, nh0, VC, GammaH)</p></td>
<td><p>Calculate hole dephasing rate.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.OffDiagDephasing2" title="PSTD3D.OffDiagDephasing2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OffDiagDephasing2</span></code></a>(ne, nh, p, ky, Ee, Eh, g, VC, t, x)</p></td>
<td><p>Calculate off-diagonal dephasing contribution (version 2).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.InitializeDephasing" title="PSTD3D.InitializeDephasing"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeDephasing</span></code></a>(ky, me, mh)</p></td>
<td><p>Initialize the dephasing module.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id44" title="PSTD3D.CalcScreenedArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcScreenedArrays</span></code></a>(screened, L, ne, nh, VC, E1D)</p></td>
<td><p>Calculate screened Coulomb interaction arrays.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id41" title="PSTD3D.SetLorentzDelta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SetLorentzDelta</span></code></a>(boolean)</p></td>
<td><p>Set the LorentzDelta flag for many-body array calculations.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id43" title="PSTD3D.GetEps1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetEps1Dqw</span></code></a>(alphae, alphah, Delta0, epsr, me, mh, n1D, q, w)</p></td>
<td><p>Calculate the 1D quantum wire dielectric function epsilon(q, w).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id42" title="PSTD3D.GetChi1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetChi1Dqw</span></code></a>(alphae, alphah, Delta0, epsr, game, gamh, ...)</p></td>
<td><p>Calculate the 1D quantum wire susceptibility (chi) for a given momentum and frequency.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id40" title="PSTD3D.InitializeCoulomb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeCoulomb</span></code></a>(y, ky, L, Delta0, me, mh, Ee, Eh, ...)</p></td>
<td><p>Initialize the coulomb module and all of its needed quantities.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id45" title="PSTD3D.MBCE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBCE</span></code></a>(ne0, nh0, ky, Ee, Eh, VC, geh, ge, Win, Wout[, ...])</p></td>
<td><p>Calculate the Many-body Coulomb In/Out rates for electrons.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id46" title="PSTD3D.MBCH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBCH</span></code></a>(ne0, nh0, ky, Ee, Eh, VC, geh, gh, Win, Wout[, ...])</p></td>
<td><p>Calculate the Many-body Coulomb In/Out rates for holes.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id51" title="PSTD3D.MBPH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBPH</span></code></a>(nh, VC, E1D, Win, Wout)</p></td>
<td><p>Many-body phonon-hole interaction.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id50" title="PSTD3D.MBPE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBPE</span></code></a>(ne, VC, E1D, Win, Wout)</p></td>
<td><p>Many-body phonon-electron interaction.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id49" title="PSTD3D.InitializePhonons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializePhonons</span></code></a>(ky, Ee, Eh, L, epsr, Gph, Oph)</p></td>
<td><p>Initialize phonon interaction matrices (Unecessary the jit version?).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id52" title="PSTD3D.FermiDistr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FermiDistr</span></code></a>(En)</p></td>
<td><p>Calculate Fermi-Dirac distribution.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.SpontEmission" title="PSTD3D.SpontEmission"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpontEmission</span></code></a>(ne, nh, Ee, Eh, gap, geh, VC, Rsp)</p></td>
<td><p>Calculate spontaneous emission rates.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.InitializeEmission" title="PSTD3D.InitializeEmission"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeEmission</span></code></a>(ky, Ee, Eh, dcv, epsr, geh, ehint)</p></td>
<td><p>Initialize the emission module.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Calchw" title="PSTD3D.Calchw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Calchw</span></code></a>(hw, PLS, Estart, Emax)</p></td>
<td><p>Calculate photon energy array for PL spectrum.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.GetSpaceArray" title="PSTD3D.GetSpaceArray"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetSpaceArray</span></code></a>(N, L)</p></td>
<td><p>Generate a real-space position array.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id27" title="PSTD3D.GetKArray"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetKArray</span></code></a>(Nk, L)</p></td>
<td><p>Generate k-space array for Fourier transforms.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.QWCalculator" title="PSTD3D.QWCalculator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWCalculator</span></code></a>(Exx, Eyy, Ezz, Vrr, rr, q, dt, w, Pxx, ...)</p></td>
<td><p>Time-evolve the source terms of the quantum wire for Maxwell's equations.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Checkout" title="PSTD3D.Checkout"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkout</span></code></a>(p1, p2, C1, C2, D1, D2, w)</p></td>
<td><p>Check out coherence matrices from module storage for wire w.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.Checkin" title="PSTD3D.Checkin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkin</span></code></a>(p1, p2, p3, C1, C2, C3, D1, D2, D3, w)</p></td>
<td><p>Check in updated coherence matrices to module storage for wire w.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Preparation" title="PSTD3D.Preparation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Preparation</span></code></a>(p2, C2, D2, Ex, Ey, Ez, Vr, w, Heh, Hee, ...)</p></td>
<td><p>Prepare Hamiltonians, screening, and dephasing arrays for SBE time step.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcH" title="PSTD3D.CalcH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcH</span></code></a>(Meh, Wee, Whh, C, D, p, VC, Heh, Hee, Hhh)</p></td>
<td><p>Calculate the Hamiltonian matrices for the semiconductor Bloch equations.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.chiqw" title="PSTD3D.chiqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">chiqw</span></code></a>()</p></td>
<td><p>Get the current linear optical susceptibility χ(ω).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.getqc" title="PSTD3D.getqc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">getqc</span></code></a>()</p></td>
<td><p>Get the critical momentum q_c.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.QWArea" title="PSTD3D.QWArea"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWArea</span></code></a>()</p></td>
<td><p>Get the quantum wire cross-sectional area.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.ShutOffOptics" title="PSTD3D.ShutOffOptics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ShutOffOptics</span></code></a>()</p></td>
<td><p>Disable optical coupling in the SBE calculations.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.ReadQWParams" title="PSTD3D.ReadQWParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadQWParams</span></code></a>()</p></td>
<td><p>Read quantum wire parameters from 'params/qw.params' file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.ReadMBParams" title="PSTD3D.ReadMBParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadMBParams</span></code></a>()</p></td>
<td><p>Read many-body physics control flags from 'params/mb.params' file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.WriteSBEsData" title="PSTD3D.WriteSBEsData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteSBEsData</span></code></a>(n)</p></td>
<td><p>Write SBE coherence matrices to backup files.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.ReadSBEsData" title="PSTD3D.ReadSBEsData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadSBEsData</span></code></a>(Nt)</p></td>
<td><p>Read SBE coherence matrices from backup files.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Relaxation" title="PSTD3D.Relaxation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Relaxation</span></code></a>(ne, nh, VC, E1D, Rsp, dt, w, WriteFields)</p></td>
<td><p>Apply phonon scattering and carrier-carrier relaxation to electron and hole populations.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.RelaxationE" title="PSTD3D.RelaxationE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RelaxationE</span></code></a>(ne, nh, VC, E1D)</p></td>
<td><p>Calculate electron relaxation rates using many-body perturbation theory.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.RelaxationH" title="PSTD3D.RelaxationH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RelaxationH</span></code></a>(ne, nh, VC, E1D)</p></td>
<td><p>Calculate hole relaxation rates using many-body perturbation theory.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.dpdt" title="PSTD3D.dpdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dpdt</span></code></a>(C, D, p, Heh, Hee, Hhh, GamE, GamH, OffP)</p></td>
<td><p>Calculate the time derivative of the electron-hole coherence (interband polarization).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.dCdt" title="PSTD3D.dCdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dCdt</span></code></a>(Cee, Dhh, Phe, Heh, Hee, Hhh, GamE, GamH, OffE)</p></td>
<td><p>Calculate the time derivative of the electron-electron coherence.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.dDdt" title="PSTD3D.dDdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dDdt</span></code></a>(Cee, Dhh, Phe, Heh, Hee, Hhh, GamE, GamH, OffH)</p></td>
<td><p>Calculate the time derivative of the hole-hole coherence.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.write_statistics" title="PSTD3D.write_statistics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">write_statistics</span></code></a>(w, dt, ne2, nh2, Re, Rh)</p></td>
<td><p>Write statistical data to file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcMeh" title="PSTD3D.CalcMeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMeh</span></code></a>(Ex, Ey, Ez, w, Meh)</p></td>
<td><p>Calculate the dipole-field coupling matrix for electron-hole transitions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcWnn" title="PSTD3D.CalcWnn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcWnn</span></code></a>(q0, Vr, Wnn)</p></td>
<td><p>Calculate the monopole-potential coupling matrix for carrier-carrier interactions.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcXqw" title="PSTD3D.CalcXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcXqw</span></code></a>(iq, w, kr, fe, fh, Ee, Eh, gap, area, game, ...)</p></td>
<td><p>Calculate the linear optical susceptibility χ(q,ω) for a quantum wire.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.RecordEpsLqw" title="PSTD3D.RecordEpsLqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RecordEpsLqw</span></code></a>(Qr, fe, fh, Ee, Eh, gap, area, gamE, ...)</p></td>
<td><p>Record the longitudinal dielectric function ε_L(q,ω) and susceptibility χ_L(q,ω).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.RecordXqw" title="PSTD3D.RecordXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RecordXqw</span></code></a>(kr, fe, fh, Ee, Eh, gap, area, game, gamh, ...)</p></td>
<td><p>Record the linear optical susceptibility χ(q,ω) using CalcXqw.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.GetArrays" title="PSTD3D.GetArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArrays</span></code></a>(x, qx, kx)</p></td>
<td><p>Initialize spatial and momentum arrays for the SBE solver.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.MakeKKP" title="PSTD3D.MakeKKP"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeKKP</span></code></a>()</p></td>
<td><p>Create the momentum difference mapping array kkp.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.kindex" title="PSTD3D.kindex"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kindex</span></code></a>(k)</p></td>
<td><p>Convert a continuous momentum value to the nearest grid index.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.InitializeSBE" title="PSTD3D.InitializeSBE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeSBE</span></code></a>(q, rr, r0, Emaxxx, lam, Nw, QW)</p></td>
<td><p>Initialize the SBE module for calculations.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.SBECalculator" title="PSTD3D.SBECalculator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SBECalculator</span></code></a>(Ex, Ey, Ez, Vr, dt, Px, Py, Pz, Re, Rh, ...)</p></td>
<td><p>Solve the 1D Semiconductor Bloch Equations and calculate source terms.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id0" title="PSTD3D.FFTG"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FFTG</span></code></a>(F)</p></td>
<td><p>FFT with Gaussian normalization.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id6" title="PSTD3D.iFFTG"><code class="xref py py-obj docutils literal notranslate"><span class="pre">iFFTG</span></code></a>(F)</p></td>
<td><p>IFFT with Gaussian normalization.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.printIT" title="PSTD3D.printIT"><code class="xref py py-obj docutils literal notranslate"><span class="pre">printIT</span></code></a>(Dx, z, n, file)</p></td>
<td><p>Print field to file with index number.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.printIT2D" title="PSTD3D.printIT2D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">printIT2D</span></code></a>(Dx, z, n, file)</p></td>
<td><p>Print 2D complex field to file with index number.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id7" title="PSTD3D.GetArray0Index"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArray0Index</span></code></a>(x)</p></td>
<td><p>Get index of array element closest to zero.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id12" title="PSTD3D.Prop2QW"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Prop2QW</span></code></a>(RR, Exx, Eyy, Ezz, Vrr, Edc, R, Ex, Ey, Ez, ...)</p></td>
<td><p>Convert Maxwell electric fields from propagation space to QW space.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id13" title="PSTD3D.QW2Prop"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QW2Prop</span></code></a>(r, Qr, Ex, Ey, Ez, Vr, Px, Py, Pz, re, rh, RR, ...)</p></td>
<td><p>Convert QW fields and polarizations back to propagation space.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id14" title="PSTD3D.QWPolarization3"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWPolarization3</span></code></a>(y, ky, p, ehint, area, L, Px, Py, Pz, ...)</p></td>
<td><p>Calculate QW polarization in 3D.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id15" title="PSTD3D.yw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">yw</span></code></a>(w)</p></td>
<td><p>Calculate wire-dependent sign factor.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.printITReal2" title="PSTD3D.printITReal2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">printITReal2</span></code></a>(Dx, z, n, file)</p></td>
<td><p>Print real part of complex field to file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id16" title="PSTD3D.WriteSBESolns"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteSBESolns</span></code></a>(ky, ne, nh, C, D, P, Ee, Eh, w, xxx)</p></td>
<td><p>Write SBE (Semiconductor Bloch Equations) solutions to files.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.WritePLSpectrum" title="PSTD3D.WritePLSpectrum"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WritePLSpectrum</span></code></a>(hw, PLS, w, xxx)</p></td>
<td><p>Write photoluminescence spectrum to file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.WriteQWFields" title="PSTD3D.WriteQWFields"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteQWFields</span></code></a>(QY, Ex, Ey, Ez, Vr, Px, Py, Pz, Re, Rh, ...)</p></td>
<td><p>Write QW field arrays to files.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id17" title="PSTD3D.WritePropFields"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WritePropFields</span></code></a>(y, Ex, Ey, Ez, Vr, Px, Py, Pz, Re, Rh, ...)</p></td>
<td><p>Write propagation field arrays to files.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id18" title="PSTD3D.QWRho5"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWRho5</span></code></a>(Qr, kr, R, L, kkp, p, CC, DD, ne, nh, re, rh, ...)</p></td>
<td><p>Calculate quantum wire charge densities.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.printIT3D" title="PSTD3D.printIT3D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">printIT3D</span></code></a>(Dx, z, n, file)</p></td>
<td><p>Print 3D complex array to file.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.printITReal" title="PSTD3D.printITReal"><code class="xref py py-obj docutils literal notranslate"><span class="pre">printITReal</span></code></a>(Dx, z, n, file)</p></td>
<td><p>Print real part of complex field to file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id19" title="PSTD3D.QWChi1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWChi1</span></code></a>(lam, dky, Ee, Eh, area, geh, dcv)</p></td>
<td><p>Calculate quantum wire linear susceptibility.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcQWWindow" title="PSTD3D.CalcQWWindow"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcQWWindow</span></code></a>(YY, L)</p></td>
<td><p>Calculate quantum wire window function.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id20" title="PSTD3D.InitializeQWOptics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeQWOptics</span></code></a>(RR, L, dcv, kr, Qr, Ee, Eh, ehint, ...)</p></td>
<td><p>Initialize quantum wire optics module.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcExpikr" title="PSTD3D.CalcExpikr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcExpikr</span></code></a>(y, ky)</p></td>
<td><p>Vectorized version (potentially faster than JIT for large arrays).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id21" title="PSTD3D.Xcv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Xcv</span></code></a>(k, kp)</p></td>
<td><p>Get X dipole matrix element.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id22" title="PSTD3D.Ycv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ycv</span></code></a>(k, kp)</p></td>
<td><p>Get Y dipole matrix element.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id23" title="PSTD3D.Zcv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Zcv</span></code></a>(k, kp)</p></td>
<td><p>Get Z dipole matrix element.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.GetVn1n2" title="PSTD3D.GetVn1n2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetVn1n2</span></code></a>(kr, rcv, Hcc, Hhh, Hcv, Vcc, Vvv, Vcv, Vvc)</p></td>
<td><p>Calculate interaction matrices Vcc, Vvv, Vcv, Vvc.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id27" title="PSTD3D.GetKArray"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetKArray</span></code></a>(Nk, L)</p></td>
<td><p>Generate k-space array for Fourier transforms.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id28" title="PSTD3D.InitializeDC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeDC</span></code></a>(ky, me, mh)</p></td>
<td><p>Initialize the DC field module.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcDCE2" title="PSTD3D.CalcDCE2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcDCE2</span></code></a>(DCTrans, ky, Cq2, Edc, me, ge, Ephn, N0, ne, ...)</p></td>
<td><p>Calculate DC field contribution for electrons (version 2).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcDCH2" title="PSTD3D.CalcDCH2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcDCH2</span></code></a>(DCTrans, ky, Cq2, Edc, mh, gh, Ephn, N0, nh, ...)</p></td>
<td><p>Calculate DC field contribution for holes (version 2).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcDCE" title="PSTD3D.CalcDCE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcDCE</span></code></a>(DCTrans, ky, Cq2, Edc, me, ge, Ephn, N0, ne, ...)</p></td>
<td><p>Calculate DC field contribution for electrons (original version).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcDCH" title="PSTD3D.CalcDCH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcDCH</span></code></a>(DCTrans, ky, Cq2, Edc, mh, gh, Ephn, N0, nh, ...)</p></td>
<td><p>Calculate DC field contribution for holes (original version).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id29" title="PSTD3D.CalcI0n"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcI0n</span></code></a>(ne, me, ky)</p></td>
<td><p>Calculate electron current.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id30" title="PSTD3D.CalcI0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcI0</span></code></a>(ne, nh, Ee, Eh, VC, dk, ky, I0)</p></td>
<td><p>Calculate total current from electron and hole distributions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.EkReNorm" title="PSTD3D.EkReNorm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EkReNorm</span></code></a>(n, En, V)</p></td>
<td><p>Renormalize energy with many-body corrections.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.DriftVt" title="PSTD3D.DriftVt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DriftVt</span></code></a>(n, Ec)</p></td>
<td><p>Calculate drift velocity.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Lrtz" title="PSTD3D.Lrtz"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Lrtz</span></code></a>(a, b)</p></td>
<td><p>Lorentzian function.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.theta" title="PSTD3D.theta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">theta</span></code></a>(x)</p></td>
<td><p>Heaviside step function (theta function).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.FDrift2" title="PSTD3D.FDrift2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FDrift2</span></code></a>(Ephn, m, g, ky, n, Cq2, v, N0, x)</p></td>
<td><p>Calculate drift force from phonon interactions.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.FDrift" title="PSTD3D.FDrift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FDrift</span></code></a>(Ephn, m, q, dndk, Cq2, v, N0, x)</p></td>
<td><p>Calculate drift force (alternative implementation).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.ThetaEM" title="PSTD3D.ThetaEM"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ThetaEM</span></code></a>(Ephn, m, g, ky, n, Cq2, v, N0, q, k)</p></td>
<td><p>Calculate emission matrix element.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.ThetaABS" title="PSTD3D.ThetaABS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ThetaABS</span></code></a>(Ephn, m, g, ky, n, Cq2, v, N0, q, k)</p></td>
<td><p>Calculate absorption matrix element.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcAvgCoeff" title="PSTD3D.CalcAvgCoeff"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcAvgCoeff</span></code></a>(ky, dk, k1, k2, i1, i2, x1, x2, x3, x4)</p></td>
<td><p>Calculate average coefficients for interpolation.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id31" title="PSTD3D.CalcVD"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcVD</span></code></a>(ky, m, n)</p></td>
<td><p>Calculate drift velocity from distribution.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id32" title="PSTD3D.CalcPD"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcPD</span></code></a>(ky, m, n)</p></td>
<td><p>Calculate momentum from distribution.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id33" title="PSTD3D.GetEDrift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetEDrift</span></code></a>()</p></td>
<td><p>Get electron drift rate.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.GetHDrift" title="PSTD3D.GetHDrift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetHDrift</span></code></a>()</p></td>
<td><p>Get hole drift rate.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.GetVEDrift" title="PSTD3D.GetVEDrift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetVEDrift</span></code></a>()</p></td>
<td><p>Get electron drift velocity.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.GetVHDrift" title="PSTD3D.GetVHDrift"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetVHDrift</span></code></a>()</p></td>
<td><p>Get hole drift velocity.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.dndEk" title="PSTD3D.dndEk"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dndEk</span></code></a>(Ephn, m, q, dndq)</p></td>
<td><p>Calculate derivative of occupation with respect to energy.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.ThetaEMABS" title="PSTD3D.ThetaEMABS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ThetaEMABS</span></code></a>(Ephn, m, q, dndk, Cq2, v)</p></td>
<td><p>Calculate emission-absorption matrix element.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.DC_Step_Scale" title="PSTD3D.DC_Step_Scale"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DC_Step_Scale</span></code></a>(ne, nh, ky, Edc, dt)</p></td>
<td><p>DC step using scaling method (legacy code).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.DC_Step_FD" title="PSTD3D.DC_Step_FD"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DC_Step_FD</span></code></a>(ne, nh, nemid, nhmid, ky, Edc, dt, me, mh)</p></td>
<td><p>DC step using finite difference method (legacy code).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.ShiftN1D" title="PSTD3D.ShiftN1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ShiftN1D</span></code></a>(ne, dk)</p></td>
<td><p>Shift 1D distribution in momentum space (legacy code).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.ShiftN2D" title="PSTD3D.ShiftN2D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ShiftN2D</span></code></a>(C, dk)</p></td>
<td><p>Shift 2D distribution in momentum space (legacy code).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id34" title="PSTD3D.Transport"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Transport</span></code></a>(C, Edc, Eac, dt, DCTrans, k1nek2)</p></td>
<td><p>Transport step for distribution matrix (legacy code).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.K03" title="PSTD3D.K03"><code class="xref py py-obj docutils literal notranslate"><span class="pre">K03</span></code></a>(x)</p></td>
<td><p>Modified Bessel function K0 for real argument.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id40" title="PSTD3D.InitializeCoulomb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeCoulomb</span></code></a>(y, ky, L, Delta0, me, mh, Ee, Eh, ...)</p></td>
<td><p>Initialize the coulomb module and all of its needed quantities.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Vint" title="PSTD3D.Vint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Vint</span></code></a>(Qyk, y, alphae, alphah, Delta0)</p></td>
<td><p>Calculate the interaction integral for Coulomb potential.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.Vehint" title="PSTD3D.Vehint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Vehint</span></code></a>(k, q, y, ky, alphae, alphah, Delta0)</p></td>
<td><p>Calculate electron-hole interaction integral.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcCoulombArrays" title="PSTD3D.CalcCoulombArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcCoulombArrays</span></code></a>(y, ky, er, alphae, alphah, L, ...[, ...])</p></td>
<td><p>Construct the unscreened Coulomb collision arrays.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.GaussDelta" title="PSTD3D.GaussDelta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GaussDelta</span></code></a>(a, b)</p></td>
<td><p>(Was commented out in the Fortran code and had implications on the CalcMBArrays function)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.MakeK3" title="PSTD3D.MakeK3"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeK3</span></code></a>(ky)</p></td>
<td><p>Construct the k3 indexing array for momentum conservation.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.MakeQs" title="PSTD3D.MakeQs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeQs</span></code></a>(ky, ae, ah)</p></td>
<td><p>Construct the qe and qh momentum difference arrays.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.MakeUnDel" title="PSTD3D.MakeUnDel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeUnDel</span></code></a>(ky)</p></td>
<td><p>Construct the UnDel (1 - delta) array.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id41" title="PSTD3D.SetLorentzDelta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SetLorentzDelta</span></code></a>(boolean)</p></td>
<td><p>Set the LorentzDelta flag for many-body array calculations.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcMBArrays" title="PSTD3D.CalcMBArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMBArrays</span></code></a>(ky, Ee, Eh, ge, gh, k3, UnDel[, LorentzDelta])</p></td>
<td><p>Calculate the many-body interaction arrays.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id42" title="PSTD3D.GetChi1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetChi1Dqw</span></code></a>(alphae, alphah, Delta0, epsr, game, gamh, ...)</p></td>
<td><p>Calculate the 1D quantum wire susceptibility (chi) for a given momentum and frequency.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id43" title="PSTD3D.GetEps1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetEps1Dqw</span></code></a>(alphae, alphah, Delta0, epsr, me, mh, n1D, q, w)</p></td>
<td><p>Calculate the 1D quantum wire dielectric function epsilon(q, w).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.CalcChi1D" title="PSTD3D.CalcChi1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcChi1D</span></code></a>(ky, alphae, alphah, Delta0, epsr, me, mh, qe, qh)</p></td>
<td><p>Calculate the 1D susceptibility arrays Chi1De and Chi1Dh.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.Eps1D" title="PSTD3D.Eps1D"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Eps1D</span></code></a>(n1D, Nk)</p></td>
<td><p>Calculate the 1D dielectric function matrix.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id44" title="PSTD3D.CalcScreenedArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcScreenedArrays</span></code></a>(screened, L, ne, nh, VC, E1D)</p></td>
<td><p>Calculate screened Coulomb interaction arrays.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.CalcMVeh" title="PSTD3D.CalcMVeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMVeh</span></code></a>(p, VC, MVeh[, k3, UnDel])</p></td>
<td><p>Calculate the MVeh array for Semiconductor Bloch Equations.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.undell" title="PSTD3D.undell"><code class="xref py py-obj docutils literal notranslate"><span class="pre">undell</span></code></a>(k, q)</p></td>
<td><p>Wrapper function for UnDel array access.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.BGRenorm" title="PSTD3D.BGRenorm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BGRenorm</span></code></a>(C, D, VC, BGR[, UnDel])</p></td>
<td><p>Calculate band gap renormalization.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.EeRenorm" title="PSTD3D.EeRenorm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EeRenorm</span></code></a>(ne, VC, BGR[, UnDel])</p></td>
<td><p>Calculate electron energy renormalization.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.EhRenorm" title="PSTD3D.EhRenorm"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EhRenorm</span></code></a>(nh, VC, BGR[, UnDel])</p></td>
<td><p>Calculate hole energy renormalization.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.MBCE2" title="PSTD3D.MBCE2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBCE2</span></code></a>(ne0, nh0, ky, Ee, Eh, VC, geh, ge, Win, Wout[, ...])</p></td>
<td><p>Calculate the Many-body Coulomb In/Out rates for electrons (version 2).</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id45" title="PSTD3D.MBCE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBCE</span></code></a>(ne0, nh0, ky, Ee, Eh, VC, geh, ge, Win, Wout[, ...])</p></td>
<td><p>Calculate the Many-body Coulomb In/Out rates for electrons.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id46" title="PSTD3D.MBCH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBCH</span></code></a>(ne0, nh0, ky, Ee, Eh, VC, geh, gh, Win, Wout[, ...])</p></td>
<td><p>Calculate the Many-body Coulomb In/Out rates for holes.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id49" title="PSTD3D.InitializePhonons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializePhonons</span></code></a>(ky, Ee, Eh, L, epsr, Gph, Oph)</p></td>
<td><p>Initialize phonon interaction matrices (Unecessary the jit version?).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id50" title="PSTD3D.MBPE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBPE</span></code></a>(ne, VC, E1D, Win, Wout)</p></td>
<td><p>Many-body phonon-electron interaction.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id51" title="PSTD3D.MBPH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBPH</span></code></a>(nh, VC, E1D, Win, Wout)</p></td>
<td><p>Many-body phonon-hole interaction.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.Cq2" title="PSTD3D.Cq2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cq2</span></code></a>(q, V, E1D)</p></td>
<td><p>Calculate Cq for use in the DC Field module.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id52" title="PSTD3D.FermiDistr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FermiDistr</span></code></a>(En)</p></td>
<td><p>Calculate Fermi-Dirac distribution.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.BoseDistr" title="PSTD3D.BoseDistr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BoseDistr</span></code></a>(En)</p></td>
<td><p>Calculate Bose-Einstein distribution.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.N00" title="PSTD3D.N00"><code class="xref py py-obj docutils literal notranslate"><span class="pre">N00</span></code></a>()</p></td>
<td><p>Get the Bose distribution value for phonons.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Link to this heading"></a></h3>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#id38" title="PSTD3D.eV"><code class="xref py py-obj docutils literal notranslate"><span class="pre">eV</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.me0" title="PSTD3D.me0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">me0</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id47" title="PSTD3D.hbar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hbar</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.e0" title="PSTD3D.e0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">e0</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id10" title="PSTD3D.eps0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">eps0</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id35" title="PSTD3D.pi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pi</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id36" title="PSTD3D.twopi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">twopi</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id48" title="PSTD3D.ii"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ii</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id36" title="PSTD3D.twopi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">twopi</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#PSTD3D.c0" title="PSTD3D.c0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">c0</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id47" title="PSTD3D.hbar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hbar</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id10" title="PSTD3D.eps0"><code class="xref py py-obj docutils literal notranslate"><span class="pre">eps0</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id48" title="PSTD3D.ii"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ii</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id35" title="PSTD3D.pi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pi</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id47" title="PSTD3D.hbar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hbar</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id48" title="PSTD3D.ii"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ii</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id35" title="PSTD3D.pi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pi</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id36" title="PSTD3D.twopi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">twopi</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id47" title="PSTD3D.hbar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hbar</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id38" title="PSTD3D.eV"><code class="xref py py-obj docutils literal notranslate"><span class="pre">eV</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#id48" title="PSTD3D.ii"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ii</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id47" title="PSTD3D.hbar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hbar</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#PSTD3D.kB" title="PSTD3D.kB"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kB</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#id48" title="PSTD3D.ii"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ii</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Prop2QW">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Prop2QW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">RR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Exx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eyy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ezz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vrr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Prop2QW" title="Link to this definition"></a></dt>
<dd><p>Convert Maxwell electric fields from propagation space to QW space.</p>
<p>Converts the Maxwell electric fields (Exx, Eyy, Ezz, Vrr) in
the propagation space (RR) into the QW electric fields (Ex, Ey, Ez, Vr)
in the QW electric field space (R). After interpolating from the RR-space
to the R-space, the FFT from the R- to Qr-space is taken.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>RR</strong> (<em>ndarray</em>) – Maxwell RR spatial array, 1D array</p></li>
<li><p><strong>Exx</strong> (<em>ndarray</em>) – Maxwell X electric field, 1D array, complex</p></li>
<li><p><strong>Eyy</strong> (<em>ndarray</em>) – Maxwell Y electric field, 1D array, complex</p></li>
<li><p><strong>Ezz</strong> (<em>ndarray</em>) – Maxwell Z electric field, 1D array, complex</p></li>
<li><p><strong>Vrr</strong> (<em>ndarray</em>) – Maxwell free charge potential, 1D array, complex</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – QW spatial array (modified in-place, currently unused)</p></li>
<li><p><strong>R</strong> (<em>ndarray</em>) – QW spatial array, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – QW X electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – QW Y electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – QW Z electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – QW free charge potential (modified in-place), 1D array, complex</p></li>
<li><p><strong>t</strong> (<em>float</em>) – Current time (s)</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Ex, Ey, Ez, Vr, Edc are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _QWWindow for windowing.
Fields are made real before FFT.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.QWChi1">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWChi1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.QWChi1" title="Link to this definition"></a></dt>
<dd><p>Calculate quantum wire linear susceptibility.</p>
<p>Computes the frequency-dependent linear susceptibility of the quantum wire.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lam</strong> (<em>float</em>) – Wavelength (m)</p></li>
<li><p><strong>dky</strong> (<em>float</em>) – Momentum step (1/m)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies, 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies, 1D array</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Area of wire (m^2)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole dephasing rate (1/s)</p></li>
<li><p><strong>dcv</strong> (<em>complex</em>) – Carrier dipole moment (C m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Linear susceptibility chi^(1)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level constants twopi, c0, eps0, hbar, ii.
Formula: chi^(1) = 4 * dcv^2 / (eps0 * area) * dky / (2*pi) *</p>
<blockquote>
<div><p>sum((Ee+Eh) / ((Ee+Eh - i*hbar*geh - hbar*w) * (Ee+Eh + i*hbar*geh + hbar*w)))</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.QW2Prop">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QW2Prop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pyy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pzz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RhoE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RhoH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WriteFields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Plasmonics</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.QW2Prop" title="Link to this definition"></a></dt>
<dd><p>Convert QW fields and polarizations back to propagation space.</p>
<p>Converts QW electric fields, polarizations, and charge densities
from QW space (r, Qr) back to propagation space (RR).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> (<em>ndarray</em>) – QW Y-spaces, 1D array</p></li>
<li><p><strong>Qr</strong> (<em>ndarray</em>) – QW momentum space, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – QW X electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – QW Y electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – QW Z electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – QW free charge potential (modified in-place), 1D array, complex</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – QW X polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – QW Y polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – QW Z polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>re</strong> (<em>ndarray</em>) – QW electron charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>rh</strong> (<em>ndarray</em>) – QW hole charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>RR</strong> (<em>ndarray</em>) – Propagation Y-spaces, 1D array</p></li>
<li><p><strong>Pxx</strong> (<em>ndarray</em>) – Propagation X polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pyy</strong> (<em>ndarray</em>) – Propagation Y polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pzz</strong> (<em>ndarray</em>) – Propagation Z polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>RhoE</strong> (<em>ndarray</em>) – Propagation electron charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>RhoH</strong> (<em>ndarray</em>) – Propagation hole charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>WriteFields</strong> (<em>bool</em>) – Record fields?</p></li>
<li><p><strong>Plasmonics</strong> (<em>bool</em>) – Calculate charge densities?</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All input arrays are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _small for numerical stability.
Charge densities are normalized if Plasmonics is True.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WritePropFields">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WritePropFields</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WritePropFields" title="Link to this definition"></a></dt>
<dd><p>Write propagation field arrays to files.</p>
<p>Writes propagation electric fields, polarizations, and charge densities
to output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – Propagation X electric field, 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – Propagation Y electric field, 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – Propagation Z electric field, 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – Propagation free charge potential, 1D array, complex</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – Propagation X polarization, 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – Propagation Y polarization, 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – Propagation Z polarization, 1D array, complex</p></li>
<li><p><strong>Re</strong> (<em>ndarray</em>) – Propagation electron charge density, 1D array, complex</p></li>
<li><p><strong>Rh</strong> (<em>ndarray</em>) – Propagation hole charge density, 1D array, complex</p></li>
<li><p><strong>sp</strong> (<em>str</em>) – Space label for file name</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses printITReal2 to write real parts of complex fields.
Uses printIT for charge density difference.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.QWPolarization3">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWPolarization3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ehint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.QWPolarization3" title="Link to this definition"></a></dt>
<dd><p>Calculate QW polarization in 3D.</p>
<p>Computes the QW polarization components (Px, Py, Pz) from the
density matrix p using the dipole matrix elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinate array, 1D array</p></li>
<li><p><strong>p</strong> (<em>ndarray</em>) – Density matrix, shape (Nk, Nk), complex</p></li>
<li><p><strong>ehint</strong> (<em>float</em>) – Electron-hole space integral</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Area of wire (m^2)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – QW X polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – QW Y polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – QW Z polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Px, Py, Pz are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variables _Xvc0, _Yvc0, _Zvc0, _Expikr, _Expikrc, _QWWindow.
Uses JIT compilation for performance-critical loops.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.QWRho5">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWRho5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kkp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">CC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jjj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.QWRho5" title="Link to this definition"></a></dt>
<dd><p>Calculate quantum wire charge densities.</p>
<p>Computes electron and hole charge densities in real space from
coherence matrices CC and DD using Fourier transforms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Qr</strong> (<em>ndarray</em>) – QW momentum array, 1D array</p></li>
<li><p><strong>kr</strong> (<em>ndarray</em>) – QW momentum array, 1D array</p></li>
<li><p><strong>R</strong> (<em>ndarray</em>) – QW spatial coordinate array, 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
<li><p><strong>kkp</strong> (<em>ndarray</em>) – Momentum difference index matrix, 2D array, integer</p></li>
<li><p><strong>p</strong> (<em>ndarray</em>) – Density matrix (unused, kept for interface compatibility), 2D array, complex</p></li>
<li><p><strong>CC</strong> (<em>ndarray</em>) – Electron/electron coherence matrix, 2D array, complex</p></li>
<li><p><strong>DD</strong> (<em>ndarray</em>) – Hole/hole coherence matrix, 2D array, complex</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers, 1D array, complex</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers, 1D array, complex</p></li>
<li><p><strong>re</strong> (<em>ndarray</em>) – Electron charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>rh</strong> (<em>ndarray</em>) – Hole charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>jjj</strong> (<em>int</em>) – Additional index (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>re and rh are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variables _Expikr, _Expikrc, _QWWindow, _small.
Normalizes charge densities to match total electron/hole numbers.
Removes boundary effects by subtracting average of first/last 10 points.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WriteSBESolns">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WriteSBESolns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WriteSBESolns" title="Link to this definition"></a></dt>
<dd><p>Write SBE (Semiconductor Bloch Equations) solutions to files.</p>
<p>Writes quantum wire electron/hole occupation numbers, coherence matrices,
and energies to output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – QW momentum array, 1D array</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – QW electron occupation numbers, 1D array, complex</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – QW hole occupation numbers, 1D array, complex</p></li>
<li><p><strong>C</strong> (<em>ndarray</em>) – QW electron/electron coherence matrix, 2D array, complex</p></li>
<li><p><strong>D</strong> (<em>ndarray</em>) – QW hole/hole coherence matrix, 2D array, complex</p></li>
<li><p><strong>P</strong> (<em>ndarray</em>) – QW electron/hole coherence matrix, 2D array, complex</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – QW electron energies, 1D array, complex</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – QW hole energies, 1D array, complex</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses printIT and printIT2D from usefulsubs to write data files.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializeQWOptics">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeQWOptics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">RR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ehint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializeQWOptics" title="Link to this definition"></a></dt>
<dd><p>Initialize quantum wire optics module.</p>
<p>Sets up all necessary arrays and parameters for quantum wire optics
calculations, including window functions, phase factors, and dipole
matrix elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>RR</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
<li><p><strong>dcv</strong> (<em>complex</em>) – Carrier dipole moment (C m)</p></li>
<li><p><strong>kr</strong> (<em>ndarray</em>) – Momentum coordinate array, 1D array</p></li>
<li><p><strong>Qr</strong> (<em>ndarray</em>) – Momentum coordinate array (unused, kept for interface compatibility), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies, 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies, 1D array</p></li>
<li><p><strong>ehint</strong> (<em>float</em>) – Electron-hole space integral</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Area of wire (m^2)</p></li>
<li><p><strong>gap</strong> (<em>float</em>) – Band gap (J) (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies module-level variables _QWWindow, _Expikr, _Expikrc, _dcv0, _Vol,
_Xcv0, _Ycv0, _Zcv0, _Xvc0, _Yvc0, _Zvc0.
Calculates dipole matrix elements Xcv0, Ycv0, Zcv0 and their conjugates.
Uses module-level constants twopi.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Xcv">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Xcv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Xcv" title="Link to this definition"></a></dt>
<dd><p>Get X dipole matrix element.</p>
<p>Returns the X component of the dipole matrix element at indices (k, kp).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (0-based in Python)</p></li>
<li><p><strong>kp</strong> (<em>int</em>) – Second index (0-based in Python)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>X dipole matrix element value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Xcv0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Ycv">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Ycv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Ycv" title="Link to this definition"></a></dt>
<dd><p>Get Y dipole matrix element.</p>
<p>Returns the Y component of the dipole matrix element at indices (k, kp).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (0-based in Python)</p></li>
<li><p><strong>kp</strong> (<em>int</em>) – Second index (0-based in Python)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Y dipole matrix element value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Ycv0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Zcv">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Zcv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Zcv" title="Link to this definition"></a></dt>
<dd><p>Get Z dipole matrix element.</p>
<p>Returns the Z component of the dipole matrix element at indices (k, kp).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (0-based in Python)</p></li>
<li><p><strong>kp</strong> (<em>int</em>) – Second index (0-based in Python)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Z dipole matrix element value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Zcv0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.yw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">yw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.yw" title="Link to this definition"></a></dt>
<dd><p>Calculate wire-dependent sign factor.</p>
<p>Computes a sign factor based on the wire index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>w</strong> (<em>int</em>) – Wire index</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sign factor: (-1)**floor((w-1)/2)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Used for alternating sign patterns in multi-wire systems.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.FFTG">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">FFTG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">F</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.FFTG" title="Link to this definition"></a></dt>
<dd><p>FFT with Gaussian normalization.</p>
<p>Performs FFT and applies Gaussian normalization: F = -FFT(F) / Nf</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>F</strong> (<em>ndarray</em>) – Input function (complex), modified in-place, 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>F array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses pyfftw for FFT computation.
The function performs: FFTC(F) then F = -F / Nf</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.iFFTG">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">iFFTG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">F</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.iFFTG" title="Link to this definition"></a></dt>
<dd><p>IFFT with Gaussian normalization.</p>
<p>Performs IFFT and applies Gaussian normalization: F = -IFFT(F) * Nf</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>F</strong> (<em>ndarray</em>) – Input function (complex), modified in-place, 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>F array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses pyfftw for IFFT computation.
The function performs: iFFTC(F) then F = -F * Nf</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.printITR">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">printITR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.printITR" title="Link to this definition"></a></dt>
<dd><p>Print real field to file with index number.</p>
<p>Writes a real 1D field array to a file with index number in filename.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Dx</strong> (<em>ndarray</em>) – Field array (real), 1D array</p></li>
<li><p><strong>z</strong> (<em>ndarray</em>) – Spatial coordinates (real), 1D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Index number for filename</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension and index)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The file is written to ‘dataQW/{file}{n:06d}.dat’.
Each line contains: z(i), Dx(i)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.TotalEnergy">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">TotalEnergy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.TotalEnergy" title="Link to this definition"></a></dt>
<dd><p>Calculate total energy.</p>
<p>Computes total energy as real part of sum(n * E).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n</strong> (<em>ndarray</em>) – Occupation numbers (complex), 1D array</p></li>
<li><p><strong>E</strong> (<em>ndarray</em>) – Energy values (real), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Total energy</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Temperature">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Temperature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Temperature" title="Link to this definition"></a></dt>
<dd><p>Calculate temperature from energy distribution.</p>
<p>Computes temperature as 2 * AvgEnergy(n, E) / kB.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n</strong> (<em>ndarray</em>) – Occupation numbers (complex), 1D array</p></li>
<li><p><strong>E</strong> (<em>ndarray</em>) – Energy values (real), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Temperature (K)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses Boltzmann constant kB for temperature calculation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WriteIt">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WriteIt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">V</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WriteIt" title="Link to this definition"></a></dt>
<dd><p>Write array to file (interface-style wrapper).</p>
<p>Automatically dispatches to WriteIT1D or WriteIT2D based on array dimensions.
This provides a unified interface similar to Fortran’s interface construct.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>V</strong> (<em>ndarray</em>) – Array to write (real), 1D or 2D array</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>1D arrays: calls WriteIT1D</p></li>
<li><p>2D arrays: calls WriteIT2D</p></li>
<li><p>Raises ValueError for unsupported array dimensions</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.locator">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">locator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.locator" title="Link to this definition"></a></dt>
<dd><p>Find index in sorted array where value should be inserted.</p>
<p>Finds the index i such that x[i] &lt;= x0 &lt; x[i+1] (0-based indexing).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – Sorted array (real), 1D array</p></li>
<li><p><strong>x0</strong> (<em>float</em>) – Value to locate</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Index i such that x[i] &lt;= x0 &lt; x[i+1] (0-based)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses binary search to find the insertion point.
Returns 0 if x0 &lt; x[0], and len(x)-2 if x0 &gt;= x[-1].</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetArray0Index">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetArray0Index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetArray0Index" title="Link to this definition"></a></dt>
<dd><p>Get index of array element closest to zero.</p>
<p>Finds the index where the array value is closest to zero
by rounding and checking for zero.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>ndarray</em>) – Input array (real), 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Index (1-based in Fortran, 0-based in Python) where value is closest to zero</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function rounds array values and finds the first index
where the rounded value is zero. Returns error message if not found.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcI0">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcI0</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">I0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcI0" title="Link to this definition"></a></dt>
<dd><p>Calculate total current from electron and hole distributions.</p>
<p>Computes the total current by calculating drift velocities for both
electrons and holes, then combining them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Interaction matrix (J), 3D array VC[:,:,2] for electrons, VC[:,:,3] for holes</p></li>
<li><p><strong>dk</strong> (<em>float</em>) – Momentum step size (1/m)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array (unused, kept for interface compatibility)</p></li>
<li><p><strong>I0</strong> (<em>float</em>) – Input value (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Total current (A)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcPD">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcPD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcPD" title="Link to this definition"></a></dt>
<dd><p>Calculate momentum from distribution.</p>
<p>Computes the average momentum from the carrier distribution:
p = sum(abs(n) * hbar * ky) / sum(abs(n) + small)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg) (unused, kept for interface compatibility)</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers (complex), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Average momentum (kg·m/s)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcVD">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcVD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcVD" title="Link to this definition"></a></dt>
<dd><p>Calculate drift velocity from distribution.</p>
<p>Computes the average drift velocity from the carrier distribution
and momentum: v = sum(real(n) * hbar * ky / m) / sum(real(n) + small)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers (complex), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Drift velocity (m/s)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializeDC">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeDC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializeDC" title="Link to this definition"></a></dt>
<dd><p>Initialize the DC field module.</p>
<p>Sets up all module-level arrays required for DC field calculations.
Allocates and initializes Y, xe, xh, qinv arrays and opens output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All arrays are stored as module-level variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetEDrift">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetEDrift</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetEDrift" title="Link to this definition"></a></dt>
<dd><p>Get electron drift rate.</p>
<p>Returns the electron temperature damping rate.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Electron temperature damping rate (Hz)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Transport">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Transport</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eac</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DCTrans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k1nek2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Transport" title="Link to this definition"></a></dt>
<dd><p>Transport step for distribution matrix (legacy code).</p>
<p>Performs a transport step on the distribution matrix C by shifting
in momentum space. Can operate on the full 2D matrix or just the diagonal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C</strong> (<em>ndarray</em>) – Distribution matrix (complex), modified in-place, 2D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>Eac</strong> (<em>float</em>) – AC electric field (V/m)</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step (s)</p></li>
<li><p><strong>DCTrans</strong> (<em>bool</em>) – Whether to include DC transport terms</p></li>
<li><p><strong>k1nek2</strong> (<em>bool</em>) – If True, shift the full 2D matrix; if False, shift only the diagonal</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>C array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcI0n">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcI0n</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcI0n" title="Link to this definition"></a></dt>
<dd><p>Calculate electron current.</p>
<p>Computes the electron current from the electron distribution and momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Electron current (A)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WriteDephasing">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WriteDephasing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WriteDephasing" title="Link to this definition"></a></dt>
<dd><p>Write dephasing rates to files.</p>
<p>Writes electron and hole dephasing rates to files with wire index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Quantum wire momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>gamE</strong> (<em>ndarray</em>) – Electron diagonal dephasing rate (Hz), 1D array</p></li>
<li><p><strong>gamH</strong> (<em>ndarray</em>) – Hole diagonal dephasing rate (Hz), 1D array</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Writes files to:
- ‘dataQW/Wire/Ge/Ge.{w:02d}.k.{xxx:05d}.dat’ for electrons
- ‘dataQW/Wire/Gh/Gh.{w:02d}.k.{xxx:05d}.dat’ for holes</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcGammaE">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcGammaE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GammaE</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcGammaE" title="Link to this definition"></a></dt>
<dd><p>Calculate electron dephasing rate.</p>
<p>Computes the dephasing rate for electrons due to electron-electron
and electron-hole interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Interaction matrix (J), 3D array VC[:,:,0] for e-h, VC[:,:,1] for e-e</p></li>
<li><p><strong>GammaE</strong> (<em>ndarray</em>) – Output electron dephasing rate (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>GammaE array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes dephasing from:
1. Electron-electron interactions
2. Electron-hole interactions
Uses extended arrays (with boundary points) for indexing safety.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcGammaH">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcGammaH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GammaH</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcGammaH" title="Link to this definition"></a></dt>
<dd><p>Calculate hole dephasing rate.</p>
<p>Computes the dephasing rate for holes due to hole-hole
and electron-hole interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Interaction matrix (J), 3D array VC[:,:,0] for e-h, VC[:,:,2] for h-h</p></li>
<li><p><strong>GammaH</strong> (<em>ndarray</em>) – Output hole dephasing rate (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>GammaH array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes dephasing from:
1. Hole-hole interactions
2. Electron-hole interactions
Uses extended arrays (with boundary points) for indexing safety.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.OffDiagDephasing2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">OffDiagDephasing2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.OffDiagDephasing2" title="Link to this definition"></a></dt>
<dd><p>Calculate off-diagonal dephasing contribution (version 2).</p>
<p>Computes the off-diagonal dephasing contribution to the polarization equation
using version 2 algorithm with negative indexing support.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>p</strong> (<em>ndarray</em>) – Polarization matrix (complex), 2D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>g</strong> (<em>ndarray</em>) – Dephasing rates (Hz), 1D array [gee, ghh, geh]</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Interaction matrix (J), 3D array</p></li>
<li><p><strong>t</strong> (<em>float</em>) – Time (s)</p></li>
<li><p><strong>x</strong> (<em>ndarray</em>) – Output dephasing contribution (modified in-place), 2D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>x array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes dephasing from electron-electron, hole-hole,
and electron-hole interactions. Writes max/min values to output files.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializeDephasing">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeDephasing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializeDephasing" title="Link to this definition"></a></dt>
<dd><p>Initialize the dephasing module.</p>
<p>Sets up all module-level arrays required for dephasing calculations.
Allocates and initializes momentum index arrays and opens output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All arrays are stored as module-level variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcScreenedArrays">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcScreenedArrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">screened</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcScreenedArrays" title="Link to this definition"></a></dt>
<dd><p>Calculate screened Coulomb interaction arrays.</p>
<p>Computes the screened version of the Coulomb interaction matrices by dividing
by the dielectric function. If screening is disabled, returns the unscreened arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>screened</strong> (<em>bool</em>) – If True, apply screening. If False, return unscreened arrays.</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron population array, 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole population array, 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Input/output array for interaction matrices, shape (N, N, 3).
On input: should contain unscreened arrays (or will be filled from module-level).
On output: contains screened arrays if screened=True, unscreened otherwise.</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – Input/output array for dielectric function, shape (N, N).
On input: can be any array (will be overwritten).
On output: contains dielectric function matrix if screened=True, ones otherwise.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Arrays are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function uses module-level variables _Veh0, _Vee0, _Vhh0, _qe, _qh
(matching Fortran module behavior). If screening is enabled, computes the
dielectric function and divides the interaction matrices by it.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.SetLorentzDelta">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">SetLorentzDelta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boolean</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.SetLorentzDelta" title="Link to this definition"></a></dt>
<dd><p>Set the LorentzDelta flag for many-body array calculations.</p>
<p>This function sets a module-level flag that determines whether to use
Lorentzian broadening (True) or Gaussian delta function (False) in
the CalcMBArrays function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>boolean</strong> (<em>bool</em>) – If True, use Lorentzian broadening. If False, use Gaussian delta function.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This matches the Fortran interface where SetLorentzDelta sets a module-level
variable. The flag affects the behavior of CalcMBArrays when called without
explicitly specifying the LorentzDelta parameter.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetEps1Dqw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetEps1Dqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetEps1Dqw" title="Link to this definition"></a></dt>
<dd><p>Calculate the 1D quantum wire dielectric function epsilon(q, w).</p>
<p>Computes the real and imaginary parts of the dielectric function for a quantum wire,
which describes how the system responds to electromagnetic fields. This is used in
screening calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation parameter for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation parameter for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Electron effective mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Hole effective mass (kg)</p></li>
<li><p><strong>n1D</strong> (<em>float</em>) – 1D carrier density (1/m)</p></li>
<li><p><strong>q</strong> (<em>float</em>) – Momentum (1/m)</p></li>
<li><p><strong>w</strong> (<em>float</em>) – Frequency (rad/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(epr, epi) where:
- epr: Real part of dielectric function (dimensionless)
- epi: Imaginary part of dielectric function (dimensionless)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the dielectric function using the Lindhard formula
for a 1D system, with contributions from both electrons and holes.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetChi1Dqw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetChi1Dqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">game</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetChi1Dqw" title="Link to this definition"></a></dt>
<dd><p>Calculate the 1D quantum wire susceptibility (chi) for a given momentum and frequency.</p>
<p>Computes the real and imaginary parts of the susceptibility chi(q, w) for a quantum wire,
which describes the response of the system to external perturbations. This is used in
screening calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation parameter for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation parameter for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>game</strong> (<em>ndarray</em>) – Electron inverse lifetime array (Hz), 1D array</p></li>
<li><p><strong>gamh</strong> (<em>ndarray</em>) – Hole inverse lifetime array (Hz), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron population array, 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole population array, 1D array</p></li>
<li><p><strong>qq</strong> (<em>float</em>) – Momentum value (1/m)</p></li>
<li><p><strong>w</strong> (<em>float</em>) – Frequency (rad/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(chir, chii) where:
- chir: Real part of susceptibility (dimensionless)
- chii: Imaginary part of susceptibility (dimensionless)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the susceptibility by summing over momentum states,
taking into account the energy differences and broadening due to lifetimes.
The calculation uses the K03 Bessel function for the interaction kernel.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializeCoulomb">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeCoulomb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">er</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kkp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">screened</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializeCoulomb" title="Link to this definition"></a></dt>
<dd><p>Initialize the coulomb module and all of its needed quantities.</p>
<p>This is the main initialization function that sets up all module-level arrays
required for Coulomb interaction calculations. It calls the various setup functions
in the correct order, checking if arrays are already initialized to avoid
redundant calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Length coordinates of quantum wire (m), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Inverse electron lifetime (Hz)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Inverse hole lifetime (Hz)</p></li>
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation between ground and 1st excited state for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation between ground and 1st excited state for holes (1/m)</p></li>
<li><p><strong>er</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>Qy</strong> (<em>ndarray</em>) – Momentum difference array (1/m), 1D array</p></li>
<li><p><strong>kkp</strong> (<em>ndarray</em>) – Index mapping array, 2D integer array. Maps (k,q) indices to Qy indices.</p></li>
<li><p><strong>screened</strong> (<em>bool</em>) – Whether to use screened interactions (not used in initialization, but passed through)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All arrays are stored as module-level variables (matching Fortran behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function initializes arrays in the following order:
1. UnDel - inverse delta function array
2. k3 - momentum conservation indexing array
3. qe, qh - momentum difference arrays
4. Ceh, Cee, Chh - many-body interaction arrays (requires k3 and UnDel)
5. Veh0, Vee0, Vhh0 - unscreened Coulomb arrays
6. Chi1De, Chi1Dh - susceptibility arrays (requires qe and qh)</p>
<p>Each array is only computed if it hasn’t been initialized yet, allowing
for incremental initialization or re-initialization with different parameters.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MBCE">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBCE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ceh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cee</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MBCE" title="Link to this definition"></a></dt>
<dd><p>Calculate the Many-body Coulomb In/Out rates for electrons.</p>
<p>Computes the many-body relaxation rates Win and Wout for electrons due to
electron-hole and electron-electron Coulomb interactions. This is identical
to MBCE2 but kept as a separate function to match Fortran structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron population array, shape (Nk,), real</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole population array, shape (Nk,), real</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (Nk, Nk, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 1] = Vee (electron-electron)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Electron inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – Input/output array for in-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Input/output array for out-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 3D indexing array from MakeK3, shape (Nk, Nk, Nk).
If None, uses module-level _k3.</p></li>
<li><p><strong>Ceh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Ceh.</p></li>
<li><p><strong>Cee</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-electron many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Cee.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Win and Wout are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).
This function is identical to MBCE2 but kept separate to match Fortran code structure.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MBCH">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBCH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ceh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Chh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MBCH" title="Link to this definition"></a></dt>
<dd><p>Calculate the Many-body Coulomb In/Out rates for holes.</p>
<p>Computes the many-body relaxation rates Win and Wout for holes due to
electron-hole and hole-hole Coulomb interactions. These represent
non-Hartree-Fock terms in the many-body dynamics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron population array, shape (Nk,), real</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole population array, shape (Nk,), real</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (Nk, Nk, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 2] = Vhh (hole-hole)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – Input/output array for in-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Input/output array for out-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 3D indexing array from MakeK3, shape (Nk, Nk, Nk).
If None, uses module-level _k3.</p></li>
<li><p><strong>Ceh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Ceh.</p></li>
<li><p><strong>Chh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Hole-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Chh.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Win and Wout are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).
The function computes scattering rates due to electron-hole and hole-hole
interactions, accounting for Pauli blocking factors (1 - n) and occupation factors n.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MBPH">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBPH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MBPH" title="Link to this definition"></a></dt>
<dd><p>Many-body phonon-hole interaction.</p>
<p>Calculates the in-scattering and out-scattering rates for holes
due to phonon interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole carrier populations, 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Coulomb interaction array, shape (Nk, Nk, 3)
Uses VC[:, :, 2] for hole-hole interaction (Fortran uses VC(:,:,3) which is 1-based)</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – 1D energy array, shape (Nk, Nk)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – In-scattering rates (modified in-place), 1D array</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Out-scattering rates (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies Win and Wout in-place.
Uses module-level variables _HPT, _HP, _Vscale.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MBPE">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBPE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MBPE" title="Link to this definition"></a></dt>
<dd><p>Many-body phonon-electron interaction.</p>
<p>Calculates the in-scattering and out-scattering rates for electrons
due to phonon interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron carrier populations, 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Coulomb interaction array, shape (Nk, Nk, 3)
Uses VC[:, :, 1] for electron-electron interaction (Fortran uses VC(:,:,2) which is 1-based)</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – 1D energy array, shape (Nk, Nk)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – In-scattering rates (modified in-place), 1D array</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Out-scattering rates (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies Win and Wout in-place.
Uses module-level variables _EPT, _EP, _Vscale.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializePhonons">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializePhonons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gph</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Oph</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializePhonons" title="Link to this definition"></a></dt>
<dd><p>Initialize phonon interaction matrices (Unecessary the jit version?).</p>
<p>Sets up the electron and hole phonon interaction matrices EP, HP
and their transposes EPT, HPT. Also calculates the scaling factor Vscale.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length parameter (unused, kept for interface compatibility)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Dielectric constant</p></li>
<li><p><strong>Gph</strong> (<em>float</em>) – Phonon damping rate (Hz)</p></li>
<li><p><strong>Oph</strong> (<em>float</em>) – Phonon frequency (Hz)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Sets module-level variables:
- _NO: Bose distribution for phonons
- _idel: Identity exclusion matrix (1 where k != k1, 0 where k == k1)
- _EP, _EPT: Electron phonon interaction matrix and its transpose
- _HP, _HPT: Hole phonon interaction matrix and its transpose
- _Vscale: Scaling constant for Coulomb interactions</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.FermiDistr">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">FermiDistr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">En</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.FermiDistr" title="Link to this definition"></a></dt>
<dd><p>Calculate Fermi-Dirac distribution.</p>
<p>Computes the Fermi-Dirac distribution assuming host temperature
and Fermi Energy = 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>En</strong> (<em>float</em><em> or </em><em>ndarray</em>) – Energy (J)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fermi-Dirac distribution value: 1 / (exp(En / (kB * T)) + 1)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float or ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Temp for temperature.
Note: Fortran returns complex type, but the value is always real, so Python returns float.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.SpontEmission">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">SpontEmission</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rsp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.SpontEmission" title="Link to this definition"></a></dt>
<dd><p>Calculate spontaneous emission rates.</p>
<p>Computes the spontaneous emission rate Rsp for each momentum state
based on electron and hole occupation numbers and energies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>gap</strong> (<em>float</em>) – Band gap energy (J)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole dephasing rate (Hz) (not used, kept for signature consistency)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Coulomb interaction array, shape (Nk, Nk, 3)</p></li>
<li><p><strong>Rsp</strong> (<em>ndarray</em>) – Spontaneous emission rates (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Rsp is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializeEmission">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeEmission</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ehint</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializeEmission" title="Link to this definition"></a></dt>
<dd><p>Initialize the emission module.</p>
<p>Sets up all module-level arrays required for emission calculations.
Allocates and initializes the idel matrix, calculates RScale,
and pre-calculates HOmega and square arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array (not used, kept for signature consistency)</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array (not used, kept for signature consistency)</p></li>
<li><p><strong>dcv</strong> (<em>float</em>) – Dipole matrix element (C·m)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Relative dielectric constant</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole dephasing rate (Hz)</p></li>
<li><p><strong>ehint</strong> (<em>float</em>) – Electron-hole interaction strength</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All arrays are stored as module-level variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Calchw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Calchw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PLS</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Estart</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Emax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Calchw" title="Link to this definition"></a></dt>
<dd><p>Calculate photon energy array for PL spectrum.</p>
<p>Sets up the photon energy array hw for photoluminescence spectrum
calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hw</strong> (<em>ndarray</em>) – Photon energy array (modified in-place), 1D array</p></li>
<li><p><strong>PLS</strong> (<em>ndarray</em>) – PL spectrum array (initialized to zero), 1D array</p></li>
<li><p><strong>Estart</strong> (<em>float</em>) – Starting energy (J)</p></li>
<li><p><strong>Emax</strong> (<em>float</em>) – Maximum energy (J)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>hw and PLS are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetSpaceArray">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetSpaceArray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetSpaceArray" title="Link to this definition"></a></dt>
<dd><p>Generate a real-space position array.</p>
<p>Creates an array of N positions evenly spaced across a window of width L,
centered at zero. The positions range from -L/2 to L/2.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>N</strong> (<em>int</em>) – Number of points</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Total width of the window (m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array of position values (m), 1D array of length N</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The array is centered at zero, so positions range from -L/2 to L/2.
For N=1, returns array with single value 0.0.</p>
<p>This function is not defined in typespace.f90 but is used by GetXArray,
GetYArray, and GetZArray. It is likely defined in the helpers module
in Fortran. The implementation matches usage patterns in other Fortran files
(e.g., GetSpaceArray(Ny, (Ny-1) * dyy) in pstd.f90).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetKArray">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetKArray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Nk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetKArray" title="Link to this definition"></a></dt>
<dd><p>Generate k-space array for Fourier transforms.</p>
<p>Creates an array of Nk k-values (momentum values) for use with FFT.
The array is centered at zero and spaced by dk = twopi/L.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Nk</strong> (<em>int</em>) – Number of k-space points</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the spatial domain (m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array of k values (1/m), 1D array of length Nk</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The k-values are centered at zero, suitable for FFT operations.
For Nk=1, returns array with single value 0.0.</p>
<p>This function is not defined in typespace.f90 but is used by GetKxArray,
GetKyArray, and GetKzArray. It is likely defined in the helpers module
in Fortran. The implementation matches usage patterns in other Fortran files.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.eV">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">eV</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1.602176634e-19</span></em><a class="headerlink" href="#PSTD3D.eV" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.me0">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">me0</span></span><a class="headerlink" href="#PSTD3D.me0" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.hbar">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">hbar</span></span><a class="headerlink" href="#PSTD3D.hbar" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.e0">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">e0</span></span><a class="headerlink" href="#PSTD3D.e0" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.eps0">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">eps0</span></span><a class="headerlink" href="#PSTD3D.eps0" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.pi">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">pi</span></span><a class="headerlink" href="#PSTD3D.pi" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.twopi">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">twopi</span></span><a class="headerlink" href="#PSTD3D.twopi" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.ii">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ii</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1j</span></em><a class="headerlink" href="#PSTD3D.ii" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.QWCalculator">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWCalculator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Exx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eyy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ezz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vrr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pyy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pzz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rho</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DoQWP</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DoQWDl</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.QWCalculator" title="Link to this definition"></a></dt>
<dd><p>Time-evolve the source terms of the quantum wire for Maxwell’s equations.</p>
<p>Solves the 1D Semiconductor Bloch equations and calculates polarization
and charge density source terms for propagation simulations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Exx</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – X-component total electric field in propagation space</p></li>
<li><p><strong>Eyy</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – Y-component total electric field in propagation space</p></li>
<li><p><strong>Ezz</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – Z-component electric field in propagation space</p></li>
<li><p><strong>Vrr</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – Potential electric field in propagation space</p></li>
<li><p><strong>rr</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em>) – QW spatial array (m)</p></li>
<li><p><strong>q</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em>) – QW momentum array (1/m)</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step (s)</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index (which wire to calculate for)</p></li>
<li><p><strong>Pxx</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – X polarization output (modified in-place)</p></li>
<li><p><strong>Pyy</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – Y polarization output (modified in-place)</p></li>
<li><p><strong>Pzz</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – Z polarization output (modified in-place)</p></li>
<li><p><strong>Rho</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em>) – Free charge density output (modified in-place)</p></li>
<li><p><strong>DoQWP</strong> (<em>list</em>) – Boolean flag [should propagator use QW polarization] (modified in-place)</p></li>
<li><p><strong>DoQWDl</strong> (<em>list</em>) – Boolean flag [should propagator use longitudinal field] (modified in-place)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All outputs are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function:
- Updates module-level time counters (xxx, jjj, t)
- Allocates arrays on first call
- Calls Prop2QW to convert propagation fields to QW fields
- Calls SBECalculator to solve the SBEs
- Calls QW2Prop to convert back to propagation space
- Calculates energy transfer and writes to files
- Only activates when field is strong enough (controlled by _wireoff)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Checkout">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Checkout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Checkout" title="Link to this definition"></a></dt>
<dd><p>Check out coherence matrices from module storage for wire w.</p>
<p>Retrieves previous time steps from module-level arrays for processing.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Checkin">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Checkin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Checkin" title="Link to this definition"></a></dt>
<dd><p>Check in updated coherence matrices to module storage for wire w.</p>
<p>Stores current and future time steps to module-level arrays.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Preparation">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Preparation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Heh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OffG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rsp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Preparation" title="Link to this definition"></a></dt>
<dd><p>Prepare Hamiltonians, screening, and dephasing arrays for SBE time step.</p>
<p>This function calculates all the arrays needed for one time step of the
semiconductor Bloch equations:
- Dipole coupling matrix M^{eh} (light-matter interaction)
- Monopole coupling matrices W^{ee}, W^{hh} (free-carrier potentials)
- Hamiltonian matrices H^{eh}, H^{ee}, H^{hh} (including many-body effects)
- Screened Coulomb interaction arrays VC, E1D
- Diagonal dephasing rates γ_e, γ_h
- Off-diagonal dephasing rates Γ^{off}
- Spontaneous emission rates R_sp</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p2</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole coherence matrix at previous time step</p></li>
<li><p><strong>C2</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron coherence matrix at previous time step</p></li>
<li><p><strong>D2</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole coherence matrix at previous time step</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Electric field components in momentum space</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Electric field components in momentum space</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Electric field components in momentum space</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Electric potential from free charge in momentum space</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>Heh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole Hamiltonian (output, modified in-place)</p></li>
<li><p><strong>Hee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron Hamiltonian (output, modified in-place)</p></li>
<li><p><strong>Hhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole Hamiltonian (output, modified in-place)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>, </em><em>Nr</em><em>, </em><em>3</em><em>)</em>) – Screened Coulomb arrays (output, modified in-place)</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – 1D dielectric screening array (output, modified in-place)</p></li>
<li><p><strong>GamE</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron diagonal dephasing rates (output, modified in-place)</p></li>
<li><p><strong>GamH</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole diagonal dephasing rates (output, modified in-place)</p></li>
<li><p><strong>OffG</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>, </em><em>3</em><em>)</em>) – Off-diagonal dephasing arrays (output, modified in-place)</p></li>
<li><p><strong>Rsp</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Spontaneous emission rates (output, modified in-place)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All output arrays are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The preparation sequence:
1. Initialize all arrays to zero/defaults
2. Extract carrier populations ne, nh from diagonal of C, D
3. Calculate dipole coupling M^{eh} if optics enabled
4. Calculate monopole coupling W^{ee}, W^{hh} if longitudinal field enabled
5. Calculate screened Coulomb arrays VC, E1D
6. Calculate Hamiltonian matrices H^{eh}, H^{ee}, H^{hh}
7. Calculate diagonal dephasing γ_e, γ_h if enabled
8. Calculate off-diagonal dephasing Γ^{off} if enabled
9. Calculate spontaneous emission rates R_sp if enabled</p>
<p>The Hamiltonian includes:
- Single-particle energies (diagonal)
- Light-matter coupling (via M^{eh})
- Coulomb many-body effects (via VC)
- Excitonic correlations (if _Excitons=True)</p>
<p>Module flags control which effects are included:
- _Optics: optical field coupling
- _LF: longitudinal field effects
- _FreePot: free potential effects
- _Excitons: excitonic correlations
- _DiagDph: diagonal dephasing
- _OffDiagDph: off-diagonal dephasing
- _Recomb: spontaneous recombination</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.CalcMeh" title="PSTD3D.CalcMeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMeh</span></code></a></dt><dd><p>Dipole coupling matrix</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcWnn" title="PSTD3D.CalcWnn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcWnn</span></code></a></dt><dd><p>Monopole coupling matrix</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcH" title="PSTD3D.CalcH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcH</span></code></a></dt><dd><p>Hamiltonian calculation</p>
</dd>
<dt><a class="reference internal" href="#id44" title="PSTD3D.CalcScreenedArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcScreenedArrays</span></code></a></dt><dd><p>Screened Coulomb arrays</p>
</dd>
</dl>
<p><a class="reference internal" href="#PSTD3D.CalcGammaE" title="PSTD3D.CalcGammaE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcGammaE</span></code></a>, <a class="reference internal" href="#PSTD3D.CalcGammaH" title="PSTD3D.CalcGammaH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcGammaH</span></code></a></p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.OffDiagDephasing2" title="PSTD3D.OffDiagDephasing2"><code class="xref py py-obj docutils literal notranslate"><span class="pre">OffDiagDephasing2</span></code></a></dt><dd><p>Off-diagonal dephasing</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.SpontEmission" title="PSTD3D.SpontEmission"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SpontEmission</span></code></a></dt><dd><p>Spontaneous emission rates</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcH">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Meh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Whh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Heh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hhh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcH" title="Link to this definition"></a></dt>
<dd><p>Calculate the Hamiltonian matrices for the semiconductor Bloch equations.</p>
<p>Constructs the effective Hamiltonian matrices that appear in the SBEs,
including single-particle energies, light-matter coupling, Coulomb many-body
effects, and excitonic correlations.</p>
<p>The Hamiltonians govern the coherent dynamics:
- H^{eh}: electron-hole Hamiltonian (drives optical polarization)
- H^{ee}: electron-electron Hamiltonian (drives electron coherence)
- H^{hh}: hole-hole Hamiltonian (drives hole coherence)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Meh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Dipole-field coupling matrix M^{eh}_{k_e,k_h}</p></li>
<li><p><strong>Wee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron monopole-potential coupling W^{ee}_{k1,k2}</p></li>
<li><p><strong>Whh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole monopole-potential coupling W^{hh}_{k1,k2}</p></li>
<li><p><strong>C</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron coherence matrix</p></li>
<li><p><strong>D</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole coherence matrix</p></li>
<li><p><strong>p</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole coherence matrix (interband polarization)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>, </em><em>Nr</em><em>, </em><em>3</em><em>)</em>) – Screened Coulomb interaction arrays</p></li>
<li><p><strong>Heh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Output: electron-hole Hamiltonian (modified in-place)</p></li>
<li><p><strong>Hee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Output: electron-electron Hamiltonian (modified in-place)</p></li>
<li><p><strong>Hhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Output: hole-hole Hamiltonian (modified in-place)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Hamiltonians Heh, Hee, Hhh are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The Hamiltonians are constructed as:</p>
<p>H^{eh}_{k_e,k_h} = M^{eh}_{k_e,k_h} + Σ_q V(q) p^†_{k_e+q,k_h+q}</p>
<dl>
<dt>H^{ee}_{k1,k2} = E_e(k1)δ_{k1,k2} + W^{ee}_{k1,k2}</dt><dd><ul class="simple">
<li><p>Σ_q V_ee(q) C^†_{k1+q,k2+q}</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k [V_ee(q)C_{k,k+q} - V_eh(q)D_{k+q,k}] (q = k1-k2)</p></li>
</ul>
</dd>
<dt>H^{hh}_{k1,k2} = E_h(k1)δ_{k1,k2} + W^{hh}_{k1,k2}</dt><dd><ul class="simple">
<li><p>Σ_q V_hh(q) D^†_{k1+q,k2+q}</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k [V_hh(q)D_{k,k+q} - V_eh(q)C_{k+q,k}] (q = k1-k2)</p></li>
</ul>
</dd>
</dl>
<p>where:
- V(q) is the screened Coulomb interaction
- q is momentum transfer
- † denotes transpose (not conjugate transpose here)</p>
<p>The excitonic terms (involving V and coherence matrices) are included
only if _Excitons=True.</p>
<p>If _LF=True (longitudinal field), off-diagonal Coulomb exchange terms
are included. If _LF=False, only diagonal terms (k1=k2) are included,
which is the Hartree-Fock approximation.</p>
<p>The noq0 array excludes q=0 terms to avoid divergences in the Coulomb
interaction.</p>
<p>Loop ranges max(1-k1, 1-k2) to min(Nk-k1, Nk-k2) ensure that k+q
stays within array bounds [1, Nk] in Fortran (or [0, Nk-1] in Python).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.Preparation" title="PSTD3D.Preparation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Preparation</span></code></a></dt><dd><p>Calls this function to set up Hamiltonians</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcMeh" title="PSTD3D.CalcMeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMeh</span></code></a></dt><dd><p>Calculates dipole coupling M^{eh}</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcWnn" title="PSTD3D.CalcWnn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcWnn</span></code></a></dt><dd><p>Calculates monopole coupling W^{nn}</p>
</dd>
</dl>
<p><a class="reference internal" href="#PSTD3D.dpdt" title="PSTD3D.dpdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dpdt</span></code></a>, <a class="reference internal" href="#PSTD3D.dCdt" title="PSTD3D.dCdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dCdt</span></code></a>, <a class="reference internal" href="#PSTD3D.dDdt" title="PSTD3D.dDdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dDdt</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.chiqw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">chiqw</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.chiqw" title="Link to this definition"></a></dt>
<dd><p>Get the current linear optical susceptibility χ(ω).</p>
<p>Returns the module-level variable _chiw which stores the linear
susceptibility at the current frequency.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>chi</strong> – Linear optical susceptibility χ(ω) (dimensionless).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This is a simple accessor function that returns the stored value.
The susceptibility is calculated elsewhere (e.g., in QWChi1 or CalcXqw)
and stored in _chiw.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.getqc" title="PSTD3D.getqc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">getqc</span></code></a></dt><dd><p>Get critical momentum</p>
</dd>
<dt><a class="reference internal" href="#id19" title="PSTD3D.QWChi1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWChi1</span></code></a></dt><dd><p>Calculate linear susceptibility (qwoptics module)</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcXqw" title="PSTD3D.CalcXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcXqw</span></code></a></dt><dd><p>Calculate susceptibility at given (q,ω)</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.getqc">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">getqc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.getqc" title="Link to this definition"></a></dt>
<dd><p>Get the critical momentum q_c.</p>
<p>Returns the module-level variable _qc which stores the critical
momentum for some physical process (e.g., plasmon cutoff, screening length).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>qc</strong> – Critical momentum q_c (rad/m).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This is a simple accessor function that returns the stored value.
The critical momentum is calculated elsewhere and stored in _qc.</p>
<p>Physical interpretation depends on context:
- Plasmon physics: momentum where plasmon dispersion changes character
- Screening: inverse screening length (q_c ≈ 1/λ_screen)
- Phase transitions: critical wave vector</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.chiqw" title="PSTD3D.chiqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">chiqw</span></code></a></dt><dd><p>Get linear susceptibility</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.QWArea">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWArea</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.QWArea" title="Link to this definition"></a></dt>
<dd><p>Get the quantum wire cross-sectional area.</p>
<p>Returns the module-level variable _area which stores the quantum wire
cross-sectional area.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>area</strong> – Quantum wire cross-sectional area (m²).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This is a simple accessor function. The area is set during initialization
and represents the effective cross-sectional area of the quantum wire.</p>
<p>The area affects:
- Carrier density normalization
- Optical transition strengths
- Coulomb interaction strengths</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.ReadQWParams" title="PSTD3D.ReadQWParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadQWParams</span></code></a></dt><dd><p>Reads quantum wire parameters including area</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ShutOffOptics">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ShutOffOptics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ShutOffOptics" title="Link to this definition"></a></dt>
<dd><p>Disable optical coupling in the SBE calculations.</p>
<p>Sets the module-level flag _Optics to False, which disables the
light-matter interaction terms in the Hamiltonian. This is useful
for studying purely electronic dynamics without optical fields.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>When _Optics is False:
- Dipole coupling matrix M^{eh} is not calculated
- Only electronic Coulomb interactions remain
- Useful for equilibration or dark dynamics</p>
<p>To re-enable optics, set _Optics = True directly.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.Preparation" title="PSTD3D.Preparation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Preparation</span></code></a></dt><dd><p>Uses _Optics flag to conditionally calculate coupling</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcMeh" title="PSTD3D.CalcMeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMeh</span></code></a></dt><dd><p>Dipole coupling (only called if _Optics=True)</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ReadQWParams">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ReadQWParams</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ReadQWParams" title="Link to this definition"></a></dt>
<dd><p>Read quantum wire parameters from ‘params/qw.params’ file.</p>
<p>Loads fundamental physical parameters of the quantum wire system from
a parameter file and converts units where necessary. Sets module-level
variables used throughout the SBE calculations.</p>
<section id="file-format">
<h4>File Format<a class="headerlink" href="#file-format" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>params/qw.params should contain one parameter per line:</dt><dd><p>L       - Wire length (m)
Delta0  - Wire thickness (m)
gap     - Band gap (eV, converted to J)
me      - Electron effective mass (units of me0)
mh      - Hole effective mass (units of me0)
HO      - Energy level separation (eV, converted to J)
gam_e   - Electron dephasing rate (Hz)
gam_h   - Hole dephasing rate (Hz)
gam_eh  - Interband dephasing rate (Hz)
epsr    - Relative permittivity (dimensionless)
Oph     - Phonon energy (eV, converted to Hz)
Gph     - Phonon damping rate (eV, converted to Hz)
Edc     - DC electric field (V/m)
jmax    - Output interval (time steps)
ntmax   - Maximum time steps</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Module-level variables are set.</p>
</dd>
<dt class="field-even">rtype<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Unit conversions performed:
- gap: eV → J (multiply by e0)
- me, mh: units of me0 → kg (multiply by me0)
- HO: eV → J (multiply by e0)
- Oph: eV → Hz (multiply by e0/hbar)
- Gph: eV → Hz (multiply by e0/hbar)</p>
<p>Module variables set:
_L, _Delta0, _gap, _me, _mh, _HO, _gam_e, _gam_h, _gam_eh,
_epsr, _Oph, _Gph, _Edc, _jmax, _ntmax</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.ReadMBParams" title="PSTD3D.ReadMBParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadMBParams</span></code></a></dt><dd><p>Read many-body physics flags</p>
</dd>
</dl>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ReadMBParams">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ReadMBParams</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ReadMBParams" title="Link to this definition"></a></dt>
<dd><p>Read many-body physics control flags from ‘params/mb.params’ file.</p>
<p>Loads boolean flags that control which physical effects are included
in the many-body semiconductor Bloch equation calculations. Also sets
the Lorentzian delta function flag for numerical integration.</p>
<section id="id1">
<h4>File Format<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>params/mb.params should contain one flag per line (T/F or 1/0):</dt><dd><p>Optics       - Include optical field coupling
Excitons     - Include excitonic correlations
EHs          - Include carrier-carrier scattering
Screened     - Use screened Coulomb interaction
Phonon       - Include phonon scattering
DCTrans      - Include DC transport
LF           - Include longitudinal field
FreePot      - Include free potential
DiagDph      - Include diagonal dephasing
OffDiagDph   - Include off-diagonal dephasing
Recomb       - Include spontaneous recombination
PLSpec       - Calculate photoluminescence spectrum
ignorewire   - Ignore wire effects
Xqwparams    - Write susceptibility parameters
LorentzDelta - Use Lorentzian delta function</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Module-level flags are set.</p>
</dd>
<dt class="field-even">rtype<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>These flags provide fine-grained control over the physics:</p>
<ul class="simple">
<li><p>_Optics: Enable/disable light-matter interaction</p></li>
<li><p>_Excitons: Include excitonic Coulomb correlations in Hamiltonian</p></li>
<li><p>_EHs: Include carrier-carrier scattering (MBCE, MBCH)</p></li>
<li><p>_screened: Use screened vs bare Coulomb interaction</p></li>
<li><p>_Phonon: Include carrier-phonon scattering (MBPE, MBPH)</p></li>
<li><p>_DCTrans: Include DC transport and drift</p></li>
<li><p>_LF: Include longitudinal field (plasmons, screening)</p></li>
<li><p>_FreePot: Include free-carrier potential</p></li>
<li><p>_DiagDph: Momentum-dependent dephasing rates</p></li>
<li><p>_OffDiagDph: Off-diagonal dephasing (correlations)</p></li>
<li><p>_Recomb: Spontaneous electron-hole recombination</p></li>
<li><p>_PLSpec: Track photoluminescence</p></li>
<li><p>_ignorewire: Single-wire approximation</p></li>
<li><p>_Xqwparams: Write χ(q,ω) parameter file</p></li>
</ul>
<p>The LorentzDelta flag is passed to SetLorentzDelta in the coulomb module
to control numerical delta function representation.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.ReadQWParams" title="PSTD3D.ReadQWParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadQWParams</span></code></a></dt><dd><p>Read physical parameters</p>
</dd>
<dt><a class="reference internal" href="#id41" title="PSTD3D.SetLorentzDelta"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SetLorentzDelta</span></code></a></dt><dd><p>Set delta function representation (coulomb module)</p>
</dd>
</dl>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WriteSBEsData">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WriteSBEsData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WriteSBEsData" title="Link to this definition"></a></dt>
<dd><p>Write SBE coherence matrices to backup files.</p>
<p>Saves the current state of all coherence matrices (electron-hole,
electron-electron, hole-hole) at three time steps to disk for backup
or restart purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>n</strong> (<em>int</em>) – File index for output filenames (e.g., n=100 creates CC1.100.dat)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em> – Data is written to files in ‘dataQW/backup/’ directory.</p></li>
<li><p><em>Files Created</em></p></li>
<li><p><em>————-</em></p></li>
<li><p><em>For each time step (1, 2, 3) and each matrix type (CC, DD, YY)</em> – dataQW/backup/CC1.{n}.dat - Electron coherence, step 1
dataQW/backup/CC2.{n}.dat - Electron coherence, step 2
dataQW/backup/CC3.{n}.dat - Electron coherence, step 3
dataQW/backup/DD1.{n}.dat - Hole coherence, step 1
dataQW/backup/DD2.{n}.dat - Hole coherence, step 2
dataQW/backup/DD3.{n}.dat - Hole coherence, step 3
dataQW/backup/YY1.{n}.dat - e-h coherence, step 1
dataQW/backup/YY2.{n}.dat - e-h coherence, step 2
dataQW/backup/YY3.{n}.dat - e-h coherence, step 3</p></li>
<li><p><em>Data Format</em></p></li>
<li><p><em>———–</em></p></li>
<li><p><em>Each file contains complex values written as</em> – real_part imaginary_part</p></li>
<li><p><em>One matrix element per line, nested loops over wire, k2, k1.</em></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The three time steps correspond to the leapfrog integration scheme:
- Step 1: Previous time (t - dt)
- Step 2: Current time (t)
- Step 3: Next time (t + dt)</p>
<p>Data is written for all wires and all momentum indices.</p>
<p>File size scales as: Nwires × Nk × Nk × 2 (complex) × 3 (time steps) × 9 (matrices)</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.ReadSBEsData" title="PSTD3D.ReadSBEsData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadSBEsData</span></code></a></dt><dd><p>Read coherence matrices from backup files</p>
</dd>
</dl>
<p><a class="reference internal" href="#PSTD3D.Checkin" title="PSTD3D.Checkin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkin</span></code></a>, <a class="reference internal" href="#PSTD3D.Checkout" title="PSTD3D.Checkout"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkout</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ReadSBEsData">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ReadSBEsData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Nt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ReadSBEsData" title="Link to this definition"></a></dt>
<dd><p>Read SBE coherence matrices from backup files.</p>
<p>Loads the saved state of all coherence matrices (electron-hole,
electron-electron, hole-hole) at three time steps from disk for
restart or analysis purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>Nt</strong> (<em>int</em>) – File index for input filenames (e.g., Nt=100 reads CC1.100.dat)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em> – Module-level arrays _CC1, _CC2, _CC3, _DD1, _DD2, _DD3,
_YY1, _YY2, _YY3 are updated.</p></li>
<li><p><em>Files Read</em></p></li>
<li><p><em>———-</em></p></li>
<li><p><em>For each time step (1, 2, 3) and each matrix type (CC, DD, YY)</em> – dataQW/backup/CC1.{Nt}.dat - Electron coherence, step 1
dataQW/backup/CC2.{Nt}.dat - Electron coherence, step 2
dataQW/backup/CC3.{Nt}.dat - Electron coherence, step 3
dataQW/backup/DD1.{Nt}.dat - Hole coherence, step 1
dataQW/backup/DD2.{Nt}.dat - Hole coherence, step 2
dataQW/backup/DD3.{Nt}.dat - Hole coherence, step 3
dataQW/backup/YY1.{Nt}.dat - e-h coherence, step 1
dataQW/backup/YY2.{Nt}.dat - e-h coherence, step 2
dataQW/backup/YY3.{Nt}.dat - e-h coherence, step 3</p></li>
<li><p><em>Data Format</em></p></li>
<li><p><em>———–</em></p></li>
<li><p><em>Each file contains complex values as</em> – real_part imaginary_part</p></li>
<li><p><em>One matrix element per line, nested loops over wire, k2, k1.</em></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function is used to restart simulations from a saved state.
The data must match the current grid dimensions (Nk, Nwires).</p>
<p>The three time steps enable continuation of the leapfrog integration
without loss of temporal accuracy.</p>
<p>After reading, the simulation can continue from time Nt·dt using
the loaded coherence matrices.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.WriteSBEsData" title="PSTD3D.WriteSBEsData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">WriteSBEsData</span></code></a></dt><dd><p>Write coherence matrices to backup files</p>
</dd>
</dl>
<p><a class="reference internal" href="#PSTD3D.Checkin" title="PSTD3D.Checkin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkin</span></code></a>, <a class="reference internal" href="#PSTD3D.Checkout" title="PSTD3D.Checkout"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkout</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Relaxation">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Relaxation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rsp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WriteFields</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Relaxation" title="Link to this definition"></a></dt>
<dd><p>Apply phonon scattering and carrier-carrier relaxation to electron and hole populations.</p>
<p>This function calculates the time evolution of carrier populations due to
many-body scattering processes including:
- Electron-electron scattering
- Hole-hole scattering
- Electron-hole scattering
- Electron-phonon scattering
- Hole-phonon scattering
- Spontaneous electron-hole recombination</p>
<p>The scattering rates are calculated using many-body perturbation theory
and applied using an exact exponential solution to the rate equations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron occupation numbers for each momentum state k.
Modified in-place to apply relaxation effects.</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole occupation numbers for each momentum state k.
Modified in-place to apply relaxation effects.</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>, </em><em>3</em><em>)</em>) – Real-time screened Coulomb interaction arrays.
VC[:,:,0] - electron-hole interaction
VC[:,:,1] - electron-electron interaction
VC[:,:,2] - hole-hole interaction</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Real-time 1D dielectric screening array used for carrier-photon
coupling calculations.</p></li>
<li><p><strong>Rsp</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Spontaneous emission rate for each momentum state (Hz).
Used if _Recomb is True.</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step for integration (seconds).</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index identifying which quantum wire is being calculated.</p></li>
<li><p><strong>WriteFields</strong> (<em>bool</em>) – If True, write scattering rates to output files via printITR.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ne and nh are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The carrier population evolution is governed by:</p>
<p>dn_e/dt = W_in^e * (1 - n_e) - W_out^e * n_e
dn_h/dt = W_in^h * (1 - n_h) - W_out^h * n_h</p>
<p>where W_in and W_out are the in-scattering and out-scattering rates.</p>
<p>This is solved exactly as:
n(t+dt) = exp(-W*dt) * [(-1 + exp(W*dt) + n)*W_in + n*W_out] / W
where W = W_in + W_out</p>
<p>This exponential solution is more accurate than a simple Euler step and
remains stable even for large time steps or scattering rates.</p>
<p>If spontaneous recombination is enabled (_Recomb=True), an additional
decay is applied:
n_e(t+dt) = n_e * exp(-R_sp * n_h * dt)
n_h(t+dt) = n_h * exp(-R_sp * n_e * dt)</p>
<p>The scattering rates are calculated by RelaxationE and RelaxationH which
call the many-body perturbation theory functions MBPE and MBPH from the
phonons module.</p>
<section id="possible-modifications">
<h4>Possible Modifications<a class="headerlink" href="#possible-modifications" title="Link to this heading"></a></h4>
<p>WinE, WoutE, WinH, WoutH could be inplace arguments.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">E1D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Rsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Relaxation</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">VC</span><span class="p">,</span> <span class="n">E1D</span><span class="p">,</span> <span class="n">Rsp</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.RelaxationE">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">RelaxationE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.RelaxationE" title="Link to this definition"></a></dt>
<dd><p>Calculate electron relaxation rates using many-body perturbation theory.</p>
<p>Computes in-scattering (W_in) and out-scattering (W_out) rates for electrons
due to:
- Carrier-carrier scattering (electron-electron, electron-hole)
- Carrier-phonon scattering (electron-LO phonon, electron-acoustic phonon)</p>
<p>The rates are calculated using second-order Born approximation within the
screened Hartree-Fock approximation, accounting for Pauli blocking factors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron occupation numbers for each momentum state</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole occupation numbers for each momentum state</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>, </em><em>3</em><em>)</em>) – Screened Coulomb interaction matrices</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – One-dimensional dielectric screening array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>WinE</strong> (<em>ndarray (float), shape (Nk,)</em>) – In-scattering rate into each electron state (Hz).
W_in^e(k) represents the rate of scattering INTO state k.</p></li>
<li><p><strong>WoutE</strong> (<em>ndarray (float), shape (Nk,)</em>) – Out-scattering rate from each electron state (Hz).
W_out^e(k) represents the rate of scattering OUT OF state k.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The scattering rates satisfy detailed balance and ensure proper
thermalization. Pauli exclusion is enforced through (1-n_e) factors.</p>
<p>Calls MBPE (Many-Body Perturbation theory for Electrons) from the phonons
module, which implements the full quantum kinetic theory calculation.</p>
<section id="id2">
<h4>Possible Modifications<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>WinE and WoutE could be inplace arguments.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.RelaxationH" title="PSTD3D.RelaxationH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RelaxationH</span></code></a></dt><dd><p>Equivalent calculation for holes</p>
</dd>
<dt><a class="reference internal" href="#id50" title="PSTD3D.MBPE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBPE</span></code></a></dt><dd><p>The underlying many-body calculation (in phonons module)</p>
</dd>
</dl>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.RelaxationH">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">RelaxationH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.RelaxationH" title="Link to this definition"></a></dt>
<dd><p>Calculate hole relaxation rates using many-body perturbation theory.</p>
<p>Computes in-scattering (W_in) and out-scattering (W_out) rates for holes
due to:
- Carrier-carrier scattering (hole-hole, hole-electron)
- Carrier-phonon scattering (hole-LO phonon, hole-acoustic phonon)</p>
<p>The rates are calculated using second-order Born approximation within the
screened Hartree-Fock approximation, accounting for Pauli blocking factors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron occupation numbers for each momentum state</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole occupation numbers for each momentum state</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>, </em><em>3</em><em>)</em>) – Screened Coulomb interaction matrices</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – One-dimensional dielectric screening array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>WinH</strong> (<em>ndarray (float), shape (Nk,)</em>) – In-scattering rate into each hole state (Hz).
W_in^h(k) represents the rate of scattering INTO state k.</p></li>
<li><p><strong>WoutH</strong> (<em>ndarray (float), shape (Nk,)</em>) – Out-scattering rate from each hole state (Hz).
W_out^h(k) represents the rate of scattering OUT OF state k.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The scattering rates satisfy detailed balance and ensure proper
thermalization. Pauli exclusion is enforced through (1-n_h) factors.</p>
<p>Calls MBPH (Many-Body Perturbation theory for Holes) from the phonons
module, which implements the full quantum kinetic theory calculation.</p>
<section id="id3">
<h4>Possible Modifications<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<p>WinH, WoutH could be inplace arguments.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.RelaxationE" title="PSTD3D.RelaxationE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RelaxationE</span></code></a></dt><dd><p>Equivalent calculation for electrons</p>
</dd>
<dt><a class="reference internal" href="#id51" title="PSTD3D.MBPH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MBPH</span></code></a></dt><dd><p>The underlying many-body calculation (in phonons module)</p>
</dd>
</dl>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.dpdt">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">dpdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Heh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OffP</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.dpdt" title="Link to this definition"></a></dt>
<dd><p>Calculate the time derivative of the electron-hole coherence (interband polarization).</p>
<p>Implements the Semiconductor Bloch Equation for the electron-hole coherence p,
which represents the microscopic interband polarization that gives rise to the
macroscopic optical polarization.</p>
<p>The equation solved is:
iℏ dp_{k_e,k_h}/dt =</p>
<blockquote>
<div><ul class="simple">
<li><p>Σ_k’ H_{k_h,k’}^{hh} p_{k’,k_e}           [hole Hamiltonian term]</p></li>
<li><p>Σ_k’ H_{k_e,k’}^{ee} p_{k_h,k’}           [electron Hamiltonian term]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k’,k_h}^{eh†} C_{k’,k_e}          [electron-electron correlation]</p></li>
<li><p>Σ_k’ H_{k_e,k’}^{eh} D_{k’,k_h}           [hole-hole correlation]</p></li>
</ul>
<ul class="simple">
<li><p>H_{k_e,k_h}^{eh}                          [light-matter coupling]</p></li>
</ul>
<ul class="simple">
<li><p>iℏ(γ_e(k_e) + γ_h(k_h)) p_{k_e,k_h}      [diagonal dephasing]</p></li>
</ul>
<ul class="simple">
<li><p>Γ_p^{off}(k_e,k_h)                        [off-diagonal dephasing]</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron coherence matrix C_{k1,k2}.
Diagonal elements C_{k,k} = n_e(k) are electron occupation numbers.
Off-diagonal elements represent electron-electron quantum correlations.</p></li>
<li><p><strong>D</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole coherence matrix D_{k1,k2}.
Diagonal elements D_{k,k} = n_h(k) are hole occupation numbers.
Off-diagonal elements represent hole-hole quantum correlations.</p></li>
<li><p><strong>p</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole coherence matrix p_{k_e,k_h}.
This is the microscopic polarization between electron state k_e
and hole state k_h.</p></li>
<li><p><strong>Heh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole Hamiltonian matrix elements H_{k_e,k_h}^{eh}.
Contains the light-matter coupling and screened Coulomb attraction.</p></li>
<li><p><strong>Hee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron Hamiltonian matrix elements H_{k1,k2}^{ee}.
Contains kinetic energy (diagonal) and Coulomb repulsion (off-diagonal).</p></li>
<li><p><strong>Hhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole Hamiltonian matrix elements H_{k1,k2}^{hh}.
Contains kinetic energy (diagonal) and Coulomb repulsion (off-diagonal).</p></li>
<li><p><strong>GamE</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Diagonal electron dephasing rate γ_e(k) for each momentum state (Hz).
Due to carrier-carrier and carrier-phonon scattering.</p></li>
<li><p><strong>GamH</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Diagonal hole dephasing rate γ_h(k) for each momentum state (Hz).
Due to carrier-carrier and carrier-phonon scattering.</p></li>
<li><p><strong>OffP</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Off-diagonal dephasing term Γ_p^{off}(k_e, k_h).
Accounts for correlations in scattering processes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dpdt_result</strong> – Time derivative dp/dt of the electron-hole coherence (1/s).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray (complex), shape (Nk, Nk)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This is one of the three coupled Semiconductor Bloch Equations (SBEs).
The equations for C (electrons) and D (holes) are given by dCdt and dDdt.</p>
<p>The electron-hole coherence p is related to the macroscopic polarization P by:
P(r,t) = Σ_{k_e,k_h} d_{cv} p_{k_e,k_h}(t) exp(i(k_e-k_h)·r)
where d_{cv} is the interband dipole matrix element.</p>
<p>Physical interpretation:
- The Hamiltonian terms (Hee, Hhh) cause phase evolution
- The correlation terms (via C, D) include Coulomb many-body effects
- The Heh term couples to the external field (light)
- Dephasing terms model irreversible decay processes</p>
<p>Uses JIT compilation for performance with automatic fallback to pure Python.</p>
<p class="rubric">References</p>
<p>V. M. Axt and T. Kuhn, “Femtosecond spectroscopy in semiconductors:
a key to coherences, correlations and quantum kinetics”,
Rep. Prog. Phys. 67, 433 (2004), Eqs. 2.15-2.19.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.dCdt" title="PSTD3D.dCdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dCdt</span></code></a></dt><dd><p>Time derivative of electron-electron coherence</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.dDdt" title="PSTD3D.dDdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dDdt</span></code></a></dt><dd><p>Time derivative of hole-hole coherence</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.dCdt">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">dCdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Cee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Dhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Phe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Heh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OffE</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.dCdt" title="Link to this definition"></a></dt>
<dd><p>Calculate the time derivative of the electron-electron coherence.</p>
<p>Implements the Semiconductor Bloch Equation for the electron-electron coherence C,
which describes the quantum correlations between different electron momentum states.
The diagonal elements C_{k,k} = n_e(k) are the electron occupation numbers, while
off-diagonal elements represent quantum coherence between different momentum states.</p>
<p>The equation solved is:
iℏ dC_{k1,k2}/dt =</p>
<blockquote>
<div><ul class="simple">
<li><p>Σ_k’ H_{k2,k’}^{ee} C_{k1,k’}          [k2 electron Hamiltonian]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k’,k1}^{ee} C_{k’,k2}          [k1 electron Hamiltonian, commutator]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k2,k’}^{eh} p_{k1,k’}^†        [e-h correlation via p†]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k’,k1}^{eh†} p_{k’,k2}         [e-h correlation via Heh†]</p></li>
</ul>
</div></blockquote>
<p>Note: Off-diagonal dephasing terms (commented out in original Fortran) are not included.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Cee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron coherence matrix C_{k1,k2}.
Diagonal: C_{k,k} = n_e(k) is electron occupation.
Off-diagonal: represents electron quantum correlations.</p></li>
<li><p><strong>Dhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole coherence matrix D_{k1,k2} (not used in this equation,
kept for interface compatibility).</p></li>
<li><p><strong>Phe</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole coherence matrix p_{k_e,k_h}.
Note: Fortran uses Phe for p, but it’s the same as p from dpdt.</p></li>
<li><p><strong>Heh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole Hamiltonian matrix H_{k_e,k_h}^{eh}.</p></li>
<li><p><strong>Hee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron Hamiltonian matrix H_{k1,k2}^{ee}.
Diagonal: kinetic energy E_e(k).
Off-diagonal: screened Coulomb repulsion between electrons.</p></li>
<li><p><strong>Hhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole Hamiltonian (not used, kept for interface compatibility).</p></li>
<li><p><strong>GamE</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron dephasing rates (not used in this equation).</p></li>
<li><p><strong>GamH</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole dephasing rates (not used, kept for interface compatibility).</p></li>
<li><p><strong>OffE</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Off-diagonal dephasing for electrons (not used in current implementation).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dCdt_result</strong> – Time derivative dC/dt of electron-electron coherence (1/s).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray (complex), shape (Nk, Nk)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This equation governs the evolution of electron correlations, including:
- Single-particle evolution via Hee (phase evolution, energy renormalization)
- Coupling to the interband polarization p via Heh
- Generation of correlations due to Coulomb interaction</p>
<p>Physical significance:
- Diagonal elements: rate of change of electron occupation n_e(k)
- Off-diagonal: buildup/decay of electron quantum coherence
- Couples to the p equation via Heh, forming a closed system</p>
<p>The off-diagonal dephasing terms involving GamE are commented out in the
original Fortran code and not implemented here. If needed, they would add:
- iℏ·I_{k1≠k2}·(γ_e(k1) + γ_e(k2))·C_{k1,k2}
where I_{k1≠k2} is the anti-identity matrix.</p>
<p>Uses JIT compilation for performance with automatic fallback.</p>
<p class="rubric">References</p>
<ol class="upperalpha simple" start="22">
<li><ol class="upperalpha simple" start="13">
<li><p>Axt and T. Kuhn, Rep. Prog. Phys. 67, 433 (2004), Eqs. 2.15-2.19.</p></li>
</ol>
</li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.dpdt" title="PSTD3D.dpdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dpdt</span></code></a></dt><dd><p>Time derivative of electron-hole coherence (interband polarization)</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.dDdt" title="PSTD3D.dDdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dDdt</span></code></a></dt><dd><p>Time derivative of hole-hole coherence</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.dDdt">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">dDdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Cee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Dhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Phe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Heh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GamH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">OffH</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.dDdt" title="Link to this definition"></a></dt>
<dd><p>Calculate the time derivative of the hole-hole coherence.</p>
<p>Implements the Semiconductor Bloch Equation for the hole-hole coherence D,
which describes the quantum correlations between different hole momentum states.
The diagonal elements D_{k,k} = n_h(k) are the hole occupation numbers, while
off-diagonal elements represent quantum coherence between different momentum states.</p>
<p>The equation solved is:
iℏ dD_{k1,k2}/dt =</p>
<blockquote>
<div><ul class="simple">
<li><p>Σ_k’ H_{k2,k’}^{hh} D_{k1,k’}          [k2 hole Hamiltonian]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k’,k1}^{hh} D_{k’,k2}          [k1 hole Hamiltonian, commutator]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k’,k2}^{eh†} p_{k’,k1}^†       [e-h correlation via p†]</p></li>
</ul>
<ul class="simple">
<li><p>Σ_k’ H_{k1,k’}^{eh†} p_{k2,k’}         [e-h correlation via Heh†]</p></li>
</ul>
</div></blockquote>
<p>Note: Off-diagonal dephasing terms (commented out in original Fortran) are not included.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Cee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron coherence (not used, kept for interface compatibility).</p></li>
<li><p><strong>Dhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole coherence matrix D_{k1,k2}.
Diagonal: D_{k,k} = n_h(k) is hole occupation.
Off-diagonal: represents hole quantum correlations.</p></li>
<li><p><strong>Phe</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole coherence matrix p_{k_e,k_h}.</p></li>
<li><p><strong>Heh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-hole Hamiltonian matrix H_{k_e,k_h}^{eh}.</p></li>
<li><p><strong>Hee</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Electron-electron Hamiltonian (not used, kept for interface compatibility).</p></li>
<li><p><strong>Hhh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Hole-hole Hamiltonian matrix H_{k1,k2}^{hh}.
Diagonal: kinetic energy E_h(k).
Off-diagonal: screened Coulomb repulsion between holes.</p></li>
<li><p><strong>GamE</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron dephasing rates (not used, kept for interface compatibility).</p></li>
<li><p><strong>GamH</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole dephasing rates (not used in this equation).</p></li>
<li><p><strong>OffH</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Off-diagonal dephasing for holes (not used in current implementation).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dDdt_result</strong> – Time derivative dD/dt of hole-hole coherence (1/s).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray (complex), shape (Nk, Nk)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This equation is analogous to the electron equation (dCdt), but for holes.
It governs the evolution of hole correlations, including:
- Single-particle evolution via Hhh (phase evolution, energy renormalization)
- Coupling to the interband polarization p via Heh
- Generation of correlations due to Coulomb interaction</p>
<p>Physical significance:
- Diagonal elements: rate of change of hole occupation n_h(k)
- Off-diagonal: buildup/decay of hole quantum coherence
- Couples to the p equation via Heh, forming a closed system with dpdt and dCdt</p>
<p>The three equations (dpdt, dCdt, dDdt) form the complete set of Semiconductor
Bloch Equations that must be solved self-consistently. Together they describe:
- Optical response (via p)
- Carrier dynamics (via diagonal C and D)
- Quantum correlations and many-body effects (via off-diagonal C and D)</p>
<p>The off-diagonal dephasing terms involving GamH are commented out in the
original Fortran code and not implemented here. If needed, they would add:
- iℏ·I_{k1≠k2}·(γ_h(k1) + γ_h(k2))·D_{k1,k2}
where I_{k1≠k2} is the anti-identity matrix.</p>
<p>Uses JIT compilation for performance with automatic fallback.</p>
<p class="rubric">References</p>
<p>V. M. Axt and T. Kuhn, “Femtosecond spectroscopy in semiconductors”,
Rep. Prog. Phys. 67, 433 (2004), Eqs. 2.15-2.19.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.dpdt" title="PSTD3D.dpdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dpdt</span></code></a></dt><dd><p>Time derivative of electron-hole coherence</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.dCdt" title="PSTD3D.dCdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dCdt</span></code></a></dt><dd><p>Time derivative of electron-electron coherence</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.write_statistics">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">write_statistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.write_statistics" title="Link to this definition"></a></dt>
<dd><p>Write statistical data to file.</p>
<p>Writes detailed carrier statistics including velocities, densities,
energies, temperatures, and currents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step</p></li>
<li><p><strong>ne2</strong> (<em>ndarray</em>) – Electron occupation numbers</p></li>
<li><p><strong>nh2</strong> (<em>ndarray</em>) – Hole occupation numbers</p></li>
<li><p><strong>Re</strong> (<em>ndarray</em>) – Electron charge density</p></li>
<li><p><strong>Rh</strong> (<em>ndarray</em>) – Hole charge density</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcMeh">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcMeh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Meh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcMeh" title="Link to this definition"></a></dt>
<dd><p>Calculate the dipole-field coupling matrix for electron-hole transitions.</p>
<p>Computes the matrix elements of the light-matter interaction Hamiltonian
M_{k_e,k_h}^{eh} which couples the electric field to the interband polarization.
This is the driving term in the optical Bloch equations that causes absorption
and emission of photons.</p>
<p>The matrix elements are calculated as:
M_{k_e,k_h}^{eh} = -η_{int} [X_{cv}(k_e,k_h)·E_x(q) + Y_{cv}(k_e,k_h)·E_y(q)·y_w(w)</p>
<blockquote>
<div><ul class="simple">
<li><p>Z_{cv}(k_e,k_h)·E_z(q)·(-1)^w]</p></li>
</ul>
</div></blockquote>
<p>where:
- η_{int} is the electron-hole spatial overlap integral
- X_{cv}, Y_{cv}, Z_{cv} are the momentum-dependent dipole matrix elements
- q = k_e - k_h is the momentum transfer (photon momentum)
- y_w(w) is a wire-dependent weighting factor
- (-1)^w alternates sign for different wires</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ex</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – X-component of electric field in momentum space (Fourier transformed).
Indexed by momentum q.</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Y-component of electric field in momentum space.
Multiplied by wire-dependent factor yw(w).</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Z-component of electric field in momentum space.
Multiplied by (-1)^w for wire parity.</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index. Used to determine y-polarization weight yw(w) and
z-polarization sign (-1)^w.</p></li>
<li><p><strong>Meh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Output matrix for dipole-field coupling (modified in-place).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Meh is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function is central to the optical response of the semiconductor.
The coupling matrix Meh appears in the SBE for the electron-hole coherence p:</p>
<p>iℏ dp/dt = … + M^{eh}_{k_e,k_h} + …</p>
<p>The momentum index q = k_e - k_h represents the photon momentum absorbed/emitted
in a transition. This is obtained via the index mapping array kkp(ke, kh).</p>
<p>The spatial overlap integral η_{int} (ehint) accounts for the finite size
of the quantum wire and reduces the coupling strength compared to the
bare dipole moment.</p>
<p>The factors yw(w) and (-1)^w allow for different polarization responses
in different wires, enabling modeling of wire arrays with varying orientations.</p>
<p>Important: The comment in the Fortran code notes that previously there was
confusion about whether to use FFT or IFFT for the fields, and that q should
be ke - kh. This has been corrected in the current implementation.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#id21" title="PSTD3D.Xcv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Xcv</span></code></a>, <a class="reference internal" href="#id22" title="PSTD3D.Ycv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ycv</span></code></a>, <a class="reference internal" href="#id23" title="PSTD3D.Zcv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Zcv</span></code></a></p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.dpdt" title="PSTD3D.dpdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dpdt</span></code></a></dt><dd><p>The SBE that uses this coupling matrix</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcWnn">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcWnn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wnn</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcWnn" title="Link to this definition"></a></dt>
<dd><p>Calculate the monopole-potential coupling matrix for carrier-carrier interactions.</p>
<p>Computes the matrix elements of the free-charge potential coupling
W_{k1,k2}^{nn} which represents the effect of long-range Coulomb potential
from free carriers on the carrier states. This contributes to the longitudinal
field effects in the SBEs.</p>
<p>The matrix elements are:
W_{k1,k2}^{nn} = q_0 · V_r(q)</p>
<p>where:
- q_0 is the charge of the carrier (+e for holes, -e for electrons)
- V_r(q) is the electric potential from free charge in momentum space
- q = k1 - k2 is the momentum transfer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q0</strong> (<em>float</em>) – Free charge of carrier species:
+e0 (positive) for holes
-e0 (negative) for electrons
where e0 is the elementary charge (C)</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Electric potential from free charge in momentum space (Fourier transformed).
This is the long-range Coulomb potential V(r) = ρ(r)/(4πε_0ε_r) in q-space.</p></li>
<li><p><strong>Wnn</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>, </em><em>Nk</em><em>)</em>) – Output monopole-potential coupling matrix (modified in-place).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Wnn is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function calculates the coupling between carriers and the self-consistent
mean-field potential arising from the carrier density distribution. It’s used
when the longitudinal field (_LF) is enabled to include plasmon effects and
long-range Coulomb interactions.</p>
<p>The coupling matrix Wnn would appear in the SBEs as additional diagonal terms:
- For electrons: H_{k1,k2}^{ee} += W_{k1,k2}^{ee} (with q0 = -e0)
- For holes: H_{k1,k2}^{hh} += W_{k1,k2}^{hh} (with q0 = +e0)</p>
<p>The momentum transfer q = k1 - k2 is obtained via the index mapping kkp(k1, k2).</p>
<p>Note: This function is currently not actively used in the CalcH function (it’s
commented out in the Fortran code), but is kept for potential future use or
for studying longitudinal field effects.</p>
<p>Important: As noted in the Fortran comments, there was previously confusion
about FFT vs IFFT conventions, which has been corrected. The q index now
properly represents q = k1 - k2.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.CalcMeh" title="PSTD3D.CalcMeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMeh</span></code></a></dt><dd><p>Dipole-field coupling matrix for optical transitions</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcH" title="PSTD3D.CalcH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcH</span></code></a></dt><dd><p>Hamiltonian calculation (where Wnn would be used)</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcXqw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcXqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">game</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcXqw" title="Link to this definition"></a></dt>
<dd><p>Calculate the linear optical susceptibility χ(q,ω) for a quantum wire.</p>
<p>Computes the frequency and momentum-dependent linear susceptibility using
the Lindhard formula generalized to include population inversion (fe, fh)
and dephasing rates (game, gamh). This describes the linear optical response
of the quantum wire system to an external electromagnetic field.</p>
<p>The susceptibility includes contributions from both absorption (fc &lt; fv) and
stimulated emission (fc &gt; fv) processes at each momentum state.</p>
<section id="physics">
<h4>Physics<a class="headerlink" href="#physics" title="Link to this heading"></a></h4>
<p>The linear susceptibility is calculated as:</p>
<dl>
<dt>χ(q,ω) = Σ_k [N·<a href="#id4"><span class="problematic" id="id5">|</span></a>d_cv|²/ε₀] × {</dt><dd><blockquote>
<div><p>(f_c(k) - f_v(k+q)) / [E_v(k+q) - E_c(k) - ℏω - iℏ(γ_h(k+q) + γ_e(k))]</p>
</div></blockquote>
<ul class="simple">
<li><p>(f_v(k) - f_c(k+q)) / [E_c(k+q) - E_v(k) - ℏω - iℏ(γ_e(k+q) + γ_h(k))]</p></li>
</ul>
</dd>
</dl>
<p>}</p>
<p>where:
- N = 2·Δk/(2π·A) is the density of states normalization
- d_cv is the interband dipole matrix element
- f_c, f_v are electron (conduction) and hole (valence) occupation numbers
- E_c, E_v are conduction and valence band energies
- γ_e, γ_h are electron and hole dephasing rates
- q is the photon momentum (momentum transfer)
- ω is the photon frequency</p>
<p>The first term represents transitions where an electron in state k absorbs
a photon with momentum q, while the second term represents the time-reversed
process (stimulated emission).</p>
<dl class="field-list simple">
<dt class="field-odd">param iq<span class="colon">:</span></dt>
<dd class="field-odd"><p>Momentum index for photon momentum q. Can be positive, negative, or zero.
The actual momentum is q = iq * (kr[1] - kr[0]).</p>
</dd>
<dt class="field-even">type iq<span class="colon">:</span></dt>
<dd class="field-even"><p>int</p>
</dd>
<dt class="field-odd">param w<span class="colon">:</span></dt>
<dd class="field-odd"><p>Angular frequency ω (rad/s) of the electromagnetic field.</p>
</dd>
<dt class="field-even">type w<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
<dt class="field-odd">param kr<span class="colon">:</span></dt>
<dd class="field-odd"><p>Momentum grid (rad/m) for carrier states.</p>
</dd>
<dt class="field-even">type kr<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param fe<span class="colon">:</span></dt>
<dd class="field-odd"><p>Electron occupation numbers f_e(k) at each momentum state.
Range: [0, 1] for physical occupation.</p>
</dd>
<dt class="field-even">type fe<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param fh<span class="colon">:</span></dt>
<dd class="field-odd"><p>Hole occupation numbers f_h(k) at each momentum state.
Range: [0, 1] for physical occupation.</p>
</dd>
<dt class="field-even">type fh<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param Ee<span class="colon">:</span></dt>
<dd class="field-odd"><p>Electron energies E_e(k) relative to conduction band edge (J).</p>
</dd>
<dt class="field-even">type Ee<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param Eh<span class="colon">:</span></dt>
<dd class="field-odd"><p>Hole energies E_h(k) relative to valence band edge (J).</p>
</dd>
<dt class="field-even">type Eh<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param gap<span class="colon">:</span></dt>
<dd class="field-odd"><p>Band gap energy E_g (J).</p>
</dd>
<dt class="field-even">type gap<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
<dt class="field-odd">param area<span class="colon">:</span></dt>
<dd class="field-odd"><p>Cross-sectional area A of the quantum wire (m²).</p>
</dd>
<dt class="field-even">type area<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
<dt class="field-odd">param game<span class="colon">:</span></dt>
<dd class="field-odd"><p>Electron dephasing rates γ_e(k) (1/s).</p>
</dd>
<dt class="field-even">type game<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param gamh<span class="colon">:</span></dt>
<dd class="field-odd"><p>Hole dephasing rates γ_h(k) (1/s).</p>
</dd>
<dt class="field-even">type gamh<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray (float), shape (Nk,)</p>
</dd>
<dt class="field-odd">param dcv<span class="colon">:</span></dt>
<dd class="field-odd"><p>Interband dipole matrix element d_cv (C·m).</p>
</dd>
<dt class="field-even">type dcv<span class="colon">:</span></dt>
<dd class="field-even"><p>complex</p>
</dd>
<dt class="field-odd">returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>Xqw</strong> – Linear optical susceptibility χ(q,ω) (dimensionless).
Real part: related to refractive index change Δn.
Imaginary part: related to absorption/gain coefficient α.</p>
</dd>
<dt class="field-even">rtype<span class="colon">:</span></dt>
<dd class="field-even"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The summation range is carefully chosen to avoid out-of-bounds array access:
- For iq ≥ 0: kmin = 0, kmax = Nk - 1 - iq (Python indexing)
- For iq &lt; 0: kmin = -iq, kmax = Nk - 1 (Python indexing)</p>
<p>This ensures that both k and k+iq remain within [0, Nk-1].</p>
<p>The minimum dephasing is set to 1e-4 eV to prevent numerical instabilities
from vanishing denominators.</p>
<p>The valence band occupations are f_v = 1 - f_h, as holes represent absence
of electrons in the valence band.</p>
<p>The imaginary part Im[χ(q,ω)] &gt; 0 indicates absorption, while Im[χ] &lt; 0
indicates gain (population inversion). The real part Re[χ(q,ω)] is related
to dispersion via the Kramers-Kronig relations.</p>
<p>Physical applications:
- Optical absorption/gain spectra
- Refractive index changes
- Electromagnetically induced transparency (EIT)
- Population inversion and lasing conditions
- Exciton resonances in quantum wires</p>
<p class="rubric">References</p>
<p>H. Haug and S. W. Koch, “Quantum Theory of the Optical and Electronic
Properties of Semiconductors”, 5th ed., World Scientific (2009), Ch. 13.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#id19" title="PSTD3D.QWChi1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWChi1</span></code></a></dt><dd><p>Related function for calculating χ from coulomb module</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.RecordXqw" title="PSTD3D.RecordXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RecordXqw</span></code></a></dt><dd><p>Function that records χ(q,ω) data to files</p>
</dd>
<dt><a class="reference internal" href="#id42" title="PSTD3D.GetChi1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetChi1Dqw</span></code></a></dt><dd><p>1D susceptibility calculation from coulomb module</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate susceptibility at q=0, near band edge</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iq</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">gap</span> <span class="o">/</span> <span class="n">hbar</span>  <span class="c1"># Frequency at band gap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chi</span> <span class="o">=</span> <span class="n">CalcXqw</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">kr</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="n">Ee</span><span class="p">,</span> <span class="n">Eh</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">gamh</span><span class="p">,</span> <span class="n">dcv</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">w</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>  <span class="c1"># Absorption coefficient</span>
</pre></div>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.RecordEpsLqw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">RecordEpsLqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ind</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.RecordEpsLqw" title="Link to this definition"></a></dt>
<dd><p>Record the longitudinal dielectric function ε_L(q,ω) and susceptibility χ_L(q,ω).</p>
<p>Calculates and saves to file the frequency and momentum-dependent longitudinal
dielectric function and linear susceptibility for a quantum wire. This provides
a complete characterization of the collective excitations (plasmons) and
optical response of the system.</p>
<p>The longitudinal dielectric function describes the screening of longitudinal
electric fields (parallel to the wire axis) and determines the dispersion
relation of plasmon modes via ε_L(q,ω) = 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Qr</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nq</em><em>,</em><em>)</em>) – Momentum grid (rad/m) for the output. Determines the q-resolution.</p></li>
<li><p><strong>fe</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron occupation numbers f_e(k).</p></li>
<li><p><strong>fh</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole occupation numbers f_h(k).</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron energies E_e(k) (J).</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole energies E_h(k) (J).</p></li>
<li><p><strong>gap</strong> (<em>float</em>) – Band gap energy E_g (J).</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Wire cross-sectional area A (m²).</p></li>
<li><p><strong>gamE</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron dephasing rates γ_e(k) (1/s).</p></li>
<li><p><strong>gamH</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole dephasing rates γ_h(k) (1/s).</p></li>
<li><p><strong>dcv</strong> (<em>complex</em>) – Interband dipole matrix element d_cv (C·m).</p></li>
<li><p><strong>ind</strong> (<em>int</em>) – File index for output filename generation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em> – Data is written to files in ‘dataQW/Wire/Xqw/’ directory.</p></li>
<li><p><em>Files Created</em></p></li>
<li><p><em>————-</em></p></li>
<li><p><strong>dataQW/Wire/Xqw/EpsL.{ind</strong> (<em>06d}.dat :</em>) – Contains Re[ε_L(q,ω) - 1] and Im[ε_L(q,ω)] in two columns.
Data is organized as nested loops: outer loop over ω, inner loop over q.
Total size: (nwmax+1) × (Nq+1) rows, 2 columns.</p></li>
<li><p><strong>dataQW/Wire/Xqw/ChiL.{ind</strong> (<em>06d}.dat :</em>) – Contains Re[χ_L(q,ω)] and Im[χ_L(q,ω)] in two columns.
Same structure as EpsL file.</p></li>
<li><p><em>dataQW/Wire/Xqw/EpsL.params</em> – Parameter file (written only once when _Xqwparams is True).
Contains grid information: Nq, Nw, Δω, Δq, frequency range, momentum range.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The frequency grid is automatically generated:
- ω_max = 2·E_g/ℏ (twice the band gap frequency)
- Δω = ω_max / 2000
- Number of points: 2001 (from ω=0 to ω_max)</p>
<p>The momentum grid uses the input kr spacing:
- Δq = kr[1] - kr[0]
- q ranges from 0 to Nk·Δq</p>
<p>The 1D carrier density is calculated as:
n_1D = Σ(f_e + f_h) / (2·L)
but is currently overridden to a fixed value n_1D = 1.5×10⁸ m⁻¹ for testing.</p>
<p>Two different methods are used:
1. GetEps1Dqw: Analytical RPA dielectric function (from coulomb module)
2. GetChi1Dqw: Numerical susceptibility from actual occupations (from coulomb module)</p>
<p>The longitudinal dielectric function is related to susceptibility by:
ε_L(q,ω) = 1 + V(q)·χ_L(q,ω)
where V(q) is the 1D Coulomb interaction.</p>
<p>Physical applications:
- Plasmon dispersion relations (zeros of ε_L)
- Collective oscillation frequencies
- Screening length determination
- Optical absorption with many-body effects
- Carrier density diagnostics</p>
<p>The data format allows easy plotting as 2D contour plots with:
- X-axis: momentum q
- Y-axis: frequency ω
- Color: Re[ε_L] or Im[ε_L]</p>
<p class="rubric">References</p>
<ol class="upperalpha simple" start="7">
<li><ol class="upperalpha simple" start="4">
<li><p>Mahan, “Many-Particle Physics”, 3rd ed., Springer (2000), Ch. 5.</p></li>
</ol>
</li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.CalcXqw" title="PSTD3D.CalcXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcXqw</span></code></a></dt><dd><p>Calculate linear susceptibility at single (q,ω) point</p>
</dd>
<dt><a class="reference internal" href="#id43" title="PSTD3D.GetEps1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetEps1Dqw</span></code></a></dt><dd><p>Analytical 1D dielectric function (coulomb module)</p>
</dd>
<dt><a class="reference internal" href="#id42" title="PSTD3D.GetChi1Dqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetChi1Dqw</span></code></a></dt><dd><p>Numerical 1D susceptibility (coulomb module)</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.RecordXqw" title="PSTD3D.RecordXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RecordXqw</span></code></a></dt><dd><p>Similar function for recording χ(q,ω) using CalcXqw</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Record dielectric function at time step 1000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RecordEpsLqw</span><span class="p">(</span><span class="n">kr</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="n">Ee</span><span class="p">,</span> <span class="n">Eh</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">gamE</span><span class="p">,</span> <span class="n">gamH</span><span class="p">,</span> <span class="n">dcv</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Files created: EpsL.001000.dat, ChiL.001000.dat</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.RecordXqw">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">RecordXqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">game</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ind</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.RecordXqw" title="Link to this definition"></a></dt>
<dd><p>Record the linear optical susceptibility χ(q,ω) using CalcXqw.</p>
<p>Calculates and saves to file the frequency and momentum-dependent linear
susceptibility χ(q,ω) for a quantum wire using the direct CalcXqw function.
This provides the complete optical response spectrum including absorption,
gain, and dispersion.</p>
<p>Unlike RecordEpsLqw which uses analytical RPA functions, this uses the
CalcXqw function that directly sums over carrier occupations, providing
a more accurate representation when populations deviate from equilibrium.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kr</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Momentum grid (rad/m) for carrier states.</p></li>
<li><p><strong>fe</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron occupation numbers f_e(k).</p></li>
<li><p><strong>fh</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole occupation numbers f_h(k).</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron energies E_e(k) (J).</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole energies E_h(k) (J).</p></li>
<li><p><strong>gap</strong> (<em>float</em>) – Band gap energy E_g (J).</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Wire cross-sectional area A (m²).</p></li>
<li><p><strong>game</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Electron dephasing rates γ_e(k) (1/s).</p></li>
<li><p><strong>gamh</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Hole dephasing rates γ_h(k) (1/s).</p></li>
<li><p><strong>dcv</strong> (<em>complex</em>) – Interband dipole matrix element d_cv (C·m).</p></li>
<li><p><strong>ind</strong> (<em>int</em>) – File index for output filename generation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>None</em> – Data is written to files in ‘dataQW/Wire/Xqw/’ directory.</p></li>
<li><p><em>Files Created</em></p></li>
<li><p><em>————-</em></p></li>
<li><p><strong>dataQW/Wire/Xqw/Xqw.{ind</strong> (<em>06d}.dat :</em>) – Contains three columns: ω (rad/s), Re[χ(q,ω)], Im[χ(q,ω)].
Data is organized as nested loops: outer loop over ω, inner loop over q.
Total size: (nwmax+1) × (Nk+1) rows, 3 columns.</p></li>
<li><p><em>dataQW/Wire/Xqw/Xqw.params</em> – Parameter file (written only once when _Xqwparams is True).
Contains grid information: Nq, Nw, Δω, Δq, frequency range, momentum range.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The frequency grid is automatically generated:
- ω_max = 2·E_g/ℏ (twice the band gap frequency)
- Δω = ω_max / 2000
- Number of points: 2001 (from ω=0 to ω_max)</p>
<p>The momentum grid uses indices iq from 0 to Nk:
- q ranges from 0 to Nk·Δkr
- Δkr = kr[1] - kr[0]</p>
<p>The output format with three columns (ω, Re[χ], Im[χ]) facilitates plotting
and analysis of the frequency-dependent response at each momentum.</p>
<p>Computation time scales as O(Nω × Nq × Nk), which can be substantial for
large grids. For Nω=2001, Nq=101, Nk=101, this requires ~20M function calls
to CalcXqw.</p>
<p>Physical applications:
- Optical absorption/gain spectra vs. carrier density
- Refractive index changes (via Kramers-Kronig)
- Identification of excitonic resonances
- Population inversion and lasing thresholds
- Non-equilibrium optical response</p>
<p>The inclusion of ω in the first column makes it easy to plot susceptibility
vs. frequency for any given q value.</p>
<p>Differences from RecordEpsLqw:
- Uses CalcXqw (direct sum over occupations) vs. GetChi1Dqw (equilibrium)
- Output format: 3 columns (ω, Re, Im) vs. 2 columns (Re, Im)
- Single file vs. separate files for ε and χ</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.CalcXqw" title="PSTD3D.CalcXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcXqw</span></code></a></dt><dd><p>Function used to calculate χ(q,ω)</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.RecordEpsLqw" title="PSTD3D.RecordEpsLqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RecordEpsLqw</span></code></a></dt><dd><p>Similar function using analytical RPA methods</p>
</dd>
<dt><a class="reference internal" href="#id19" title="PSTD3D.QWChi1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWChi1</span></code></a></dt><dd><p>Related susceptibility calculation from qwoptics module</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Record susceptibility after excitation at time step 1000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RecordXqw</span><span class="p">(</span><span class="n">kr</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="n">Ee</span><span class="p">,</span> <span class="n">Eh</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">gamh</span><span class="p">,</span> <span class="n">dcv</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># File created: Xqw.001000.dat</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetArrays">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetArrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetArrays" title="Link to this definition"></a></dt>
<dd><p>Initialize spatial and momentum arrays for the SBE solver.</p>
<p>Sets up the fundamental coordinate and momentum space grids used throughout
the semiconductor Bloch equation calculations. This includes:
- Real-space positions x for field propagation
- Momentum space qx for Fourier-transformed fields
- Carrier momentum grid kx (offset by half grid spacing)</p>
<p>The carrier momentum grid kx is offset by 0.5 grid spacing to avoid having
a state exactly at k=0, which simplifies boundary conditions and symmetry.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Real-space position array (m). Modified in-place.</p></li>
<li><p><strong>qx</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Momentum array for fields (rad/m). Modified in-place.</p></li>
<li><p><strong>kx</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nk</em><em>,</em><em>)</em>) – Carrier momentum array (rad/m). Modified in-place.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Arrays x, qx, kx are modified in-place.
Module-level variables _NK0 and _NQ0 are set.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The carrier momentum grid kx is centered at k=0 with the formula:
kx[k] = Δkr × (-dnk + k - 0.5)  for k = 0, 1, …, Nk-1</p>
<p>where dnk = (Nk-1)/2, so that:
- kx is antisymmetric about the origin
- The grid spacing is Δkr
- No state sits exactly at k=0 (offset by 0.5)</p>
<p>The field momentum array qx is obtained from GetKArray and then:
1. Shifted by cshift(qx, Nr/2) to center the zero-frequency component
2. The first element is negated: qx[0] = -qx[0]</p>
<p>Module-level variables set:
- _NK0: Index where kx ≈ 0 (central carrier momentum index)
- _NQ0: Index where qx = 0 (zero field momentum index)</p>
<p>These zero indices are crucial for the kkp mapping array and for properly
handling momentum conservation in scattering processes.</p>
<p>The real-space array x spans the domain [-L, L] (total length 2L).
The momentum array qx corresponds to this spatial grid via FFT convention.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.GetSpaceArray" title="PSTD3D.GetSpaceArray"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetSpaceArray</span></code></a></dt><dd><p>Generate real-space position array (from usefulsubs)</p>
</dd>
<dt><a class="reference internal" href="#id27" title="PSTD3D.GetKArray"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetKArray</span></code></a></dt><dd><p>Generate momentum array for FFT (from usefulsubs)</p>
</dd>
<dt><a class="reference internal" href="#id7" title="PSTD3D.GetArray0Index"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArray0Index</span></code></a></dt><dd><p>Find index where array value is closest to zero (from usefulsubs)</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.MakeKKP" title="PSTD3D.MakeKKP"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeKKP</span></code></a></dt><dd><p>Create momentum difference mapping using NQ0</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">GetArrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">kx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now x, qx, kx are initialized and _NK0, _NQ0 are set</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MakeKKP">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MakeKKP</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MakeKKP" title="Link to this definition"></a></dt>
<dd><p>Create the momentum difference mapping array kkp.</p>
<p>Constructs the index mapping array kkp[k, kp] that gives the field momentum
index for the momentum difference q = k - kp. This is essential for evaluating
matrix elements of Fourier-transformed fields in the semiconductor Bloch equations.</p>
<p>The array satisfies:
qx[kkp[k, kp]] ≈ kr[k] - kr[kp]</p>
<p>where qx is the field momentum array and kr is the carrier momentum array.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The module-level array _kkp is allocated and filled.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The mapping is calculated as:
kkp[k, kp] = round[(kr[k] - kr[kp]) / Δkr] + NQ0</p>
<p>where:
- kr[k] - kr[kp] is the momentum difference
- Division by Δkr converts to grid index units
- round() maps to nearest grid point
- NQ0 is added to shift from centered indexing to array indexing</p>
<p>This mapping is used extensively in the SBE Hamiltonian terms:
- Dipole-field coupling: M_{k_e,k_h} ∝ E(q) where q = k_e - k_h
- Coulomb interaction: V_{k1,k2} ∝ V(q) where q = k1 - k2
- Screening: ε(q) where q is momentum transfer</p>
<p>Physical interpretation:
When an electron scatters from state kp to state k, the momentum transfer
is q = k - kp. This momentum must be provided by (or absorbed into) a photon,
phonon, or other field mode. The kkp array provides the field mode index
corresponding to this momentum transfer.</p>
<p>Memory: For Nk=101, kkp requires ~10,000 integers (~40 KB).</p>
<p>The Fortran code includes commented-out bounds checking:
- if(kr[0] &lt;= q &lt;= kr[Nr]): only map if q is in range
- if(kkp &lt; 1 or kkp &gt; Nr): set kkp = 0 for out-of-range</p>
<p>These checks are omitted in the current implementation, assuming that the
momentum grids are compatible and all differences are in range.</p>
<section id="global-variables-modified">
<h4>Global Variables Modified<a class="headerlink" href="#global-variables-modified" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>_kkp<span class="classifier">ndarray (int), shape (Nk, Nk)</span></dt><dd><p>Momentum difference mapping array. Allocated and filled.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.GetArrays" title="PSTD3D.GetArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArrays</span></code></a></dt><dd><p>Must be called first to set _NQ0</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcMeh" title="PSTD3D.CalcMeh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcMeh</span></code></a></dt><dd><p>Uses kkp for dipole-field coupling</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.CalcWnn" title="PSTD3D.CalcWnn"><code class="xref py py-obj docutils literal notranslate"><span class="pre">CalcWnn</span></code></a></dt><dd><p>Uses kkp for potential coupling</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.kindex" title="PSTD3D.kindex"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kindex</span></code></a></dt><dd><p>Convert continuous momentum to grid index</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GetArrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">kx</span><span class="p">)</span>  <span class="c1"># Initialize arrays first</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MakeKKP</span><span class="p">()</span>  <span class="c1"># Now create mapping</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Access field at momentum difference k - kp:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q_idx</span> <span class="o">=</span> <span class="n">_kkp</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">kp</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">field_at_q</span> <span class="o">=</span> <span class="n">Ex</span><span class="p">[</span><span class="n">q_idx</span><span class="p">]</span>
</pre></div>
</div>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.kindex">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">kindex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.kindex" title="Link to this definition"></a></dt>
<dd><p>Convert a continuous momentum value to the nearest grid index.</p>
<p>Maps a continuous momentum k (in rad/m) to the corresponding index in the
carrier momentum array kr. Useful for finding which discrete momentum state
corresponds to a given continuous momentum value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>k</strong> (<em>float</em>) – Momentum value (rad/m).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>idx</strong> – Index in the kr array closest to the given momentum k.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The mapping formula is:
idx = round(k / Δkr) + NK0</p>
<p>where:
- k / Δkr converts momentum to grid index units
- round() finds nearest grid point
- NK0 is added to shift from centered indexing to array indexing</p>
<p>This function is the inverse of:
k ≈ (idx - NK0) × Δkr</p>
<p>Caution: No bounds checking is performed. If k is outside the range of the
kr array, the returned index may be out of bounds [0, Nk-1].</p>
<p>Physical applications:
- Finding initial state indices for given carrier momenta
- Mapping continuous momentum distributions to discrete grid
- Identifying states near a specific momentum (e.g., Fermi surface)</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.GetArrays" title="PSTD3D.GetArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArrays</span></code></a></dt><dd><p>Sets up kr array and NK0</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.MakeKKP" title="PSTD3D.MakeKKP"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeKKP</span></code></a></dt><dd><p>Creates momentum difference mapping</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Find index for momentum near Fermi momentum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k_fermi</span> <span class="o">=</span> <span class="mf">1e8</span>  <span class="c1"># rad/m</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">kindex</span><span class="p">(</span><span class="n">k_fermi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k_actual</span> <span class="o">=</span> <span class="n">_kr</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Actual momentum on grid</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.InitializeSBE">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeSBE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Emaxxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Nw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">QW</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.InitializeSBE" title="Link to this definition"></a></dt>
<dd><p>Initialize the SBE module for calculations.</p>
<p>This function allocates all module-level arrays, initializes them to zero,
calculates material constants, and sets up all subsystems required for
solving the Semiconductor Bloch Equations. It must be called before any
SBE calculations are performed.</p>
<p>The initialization process includes:
1. Reading physical parameters from parameter files
2. Calculating momentum and spatial grids
3. Allocating coherence matrices (YY, CC, DD) for all wires
4. Computing material constants (dipole moment, screening lengths, etc.)
5. Initializing subsystems (Coulomb, Phonons, DC field, Dephasing, Emission)
6. Setting up output files
7. Calculating initial carrier distributions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nq</em><em>,</em><em>)</em>) – Momentum array for fields (rad/m). Used for compatibility but not
directly modified in this function.</p></li>
<li><p><strong>rr</strong> (<em>ndarray</em><em> (</em><em>float</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr_prop</em><em>,</em><em>)</em>) – Spatial position array for propagation space (m). Used to determine
the quantum wire window within the propagation domain.</p></li>
<li><p><strong>r0</strong> (<em>float</em>) – Reference position offset (m). Used to locate the quantum wire
within the propagation spatial grid.</p></li>
<li><p><strong>Emaxxx</strong> (<em>float</em>) – Initial peak electric field magnitude (V/m). Used to determine
when to activate quantum wire calculations (via _wireoff flag).</p></li>
<li><p><strong>lam</strong> (<em>float</em>) – Laser wavelength (m). Used for calculating linear susceptibility
and initializing QW optics.</p></li>
<li><p><strong>Nw</strong> (<em>int</em>) – Number of quantum wires in the simulation. Each wire has its own
set of coherence matrices (YY, CC, DD).</p></li>
<li><p><strong>QW</strong> (<em>bool</em>) – Flag to enable quantum wire calculations. If False, only minimal
initialization is performed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All module-level arrays and variables are set.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function performs extensive setup:</p>
<p><strong>Grid Calculation:</strong>
- Maximum momentum: kmax = sqrt(1.2 * gap * 2 * me / hbar²)
- Momentum spacing: dkr = 2π / (2*L)
- Number of k-points: Nk = floor(kmax/dkr) * 2 + 1, then Nk = Nk - 1
- Number of r-points: Nr = Nk * 2</p>
<p><strong>Material Constants:</strong>
- Dipole moment: dcv = sqrt((e0*hbar)² / (6*me0*gap) * (me0/me - 1))
- Electron confinement: alphae = sqrt(me * HO) / hbar
- Hole confinement: alphah = sqrt(mh * HO) / hbar
- Overlap integral: ehint = sqrt(2 * alphae * alphah / (alphae² + alphah²))
- Critical momentum: qc = 2 * alphae * alphah / (alphae + alphah)
- Wire area: area = sqrt(2π) / sqrt(alphae² + alphah²) * Delta0</p>
<p><strong>Initial Carrier Distribution:</strong>
- Electrons and holes initialized to Fermi-Dirac distribution at</p>
<blockquote>
<div><p>energy E = gap/2 (half the band gap)</p>
</div></blockquote>
<ul class="simple">
<li><p>All off-diagonal coherence elements set to zero</p></li>
</ul>
<p><strong>Subsystem Initialization:</strong>
- InitializeQWOptics: Sets up optical coupling matrices
- InitializeCoulomb: Calculates screened Coulomb interactions
- InitializePhonons: Sets up phonon scattering rates
- InitializeDC: Prepares DC field transport calculations
- InitializeDephasing: Sets up dephasing rate calculations
- InitializeEmission: (if _Recomb=True) Sets up spontaneous emission</p>
<p><strong>Output Files:</strong>
For each wire w:
- dataQW/info.{w:02d}.t.dat - General information
- dataQW/EP.{w:02d}.t.dat - Energy and polarization data
- dataQW/XQ.{w:02d}.t.dat - Susceptibility data
- dataQW/Etr.dat - Transition energies
- dataQW/Wire/info/ETHz.t.dat - THz field data</p>
<p><strong>Special Modes:</strong>
If _OBE=True (Optical Bloch Equations only):
- Disables all many-body effects
- Only optical coupling remains active
- Useful for testing basic optical response</p>
<p><strong>File I/O:</strong>
- Reads parameters from ‘params/qw.params’ and ‘params/mb.params’
- Optionally reads DC field from ‘DC.txt’ if _ReadDC=True
- Writes initial arrays using WriteIt function</p>
<p>The function sets the module-level flag _start to indicate that
initialization is complete, allowing other functions to check if
the module has been properly initialized.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.ReadQWParams" title="PSTD3D.ReadQWParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadQWParams</span></code></a></dt><dd><p>Read quantum wire physical parameters</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.ReadMBParams" title="PSTD3D.ReadMBParams"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ReadMBParams</span></code></a></dt><dd><p>Read many-body physics flags</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.GetArrays" title="PSTD3D.GetArrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetArrays</span></code></a></dt><dd><p>Set up spatial and momentum grids</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.MakeKKP" title="PSTD3D.MakeKKP"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MakeKKP</span></code></a></dt><dd><p>Create momentum difference mapping</p>
</dd>
<dt><a class="reference internal" href="#id20" title="PSTD3D.InitializeQWOptics"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeQWOptics</span></code></a></dt><dd><p>Initialize optical coupling</p>
</dd>
<dt><a class="reference internal" href="#id40" title="PSTD3D.InitializeCoulomb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeCoulomb</span></code></a></dt><dd><p>Initialize Coulomb interactions</p>
</dd>
<dt><a class="reference internal" href="#id49" title="PSTD3D.InitializePhonons"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializePhonons</span></code></a></dt><dd><p>Initialize phonon scattering</p>
</dd>
<dt><a class="reference internal" href="#id28" title="PSTD3D.InitializeDC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeDC</span></code></a></dt><dd><p>Initialize DC field transport</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.InitializeDephasing" title="PSTD3D.InitializeDephasing"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeDephasing</span></code></a></dt><dd><p>Initialize dephasing rates</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.InitializeEmission" title="PSTD3D.InitializeEmission"><code class="xref py py-obj docutils literal notranslate"><span class="pre">InitializeEmission</span></code></a></dt><dd><p>Initialize spontaneous emission</p>
</dd>
<dt><a class="reference internal" href="#id19" title="PSTD3D.QWChi1"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWChi1</span></code></a></dt><dd><p>Calculate linear susceptibility</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.RecordXqw" title="PSTD3D.RecordXqw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RecordXqw</span></code></a></dt><dd><p>Record susceptibility data</p>
</dd>
</dl>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1e8</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">500e-9</span><span class="p">,</span> <span class="mf">500e-9</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">InitializeSBE</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rr</span><span class="p">,</span> <span class="n">r0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Emaxxx</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">800e-9</span><span class="p">,</span> <span class="n">Nw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">QW</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Module is now initialized and ready for SBE calculations</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.SBECalculator">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">SBECalculator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WriteFields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.SBECalculator" title="Link to this definition"></a></dt>
<dd><p>Solve the 1D Semiconductor Bloch Equations and calculate source terms.</p>
<p>This is the main function that solves the Semiconductor Bloch Equations
for the w’th quantum wire and calculates the source terms Px, Py, Pz, Re,
and Rh that are used in Maxwell’s equations for field propagation.</p>
<p>The function performs a leapfrog time integration of the SBEs, including:
- Electron-hole coherence (interband polarization) p
- Electron-electron coherence C
- Hole-hole coherence D
- Many-body effects (Coulomb, phonons, dephasing)
- DC transport effects
- Charge density calculations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ex</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – X-component electric field in QW momentum space (modified in-place).
The field is FFT’d to real space for calculations, then FFT’d back.</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Y-component electric field in QW momentum space (modified in-place).</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Z-component electric field in QW momentum space (modified in-place).</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Free charge potential (voltage) in QW momentum space (modified in-place).</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step (s).</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – X-component QW polarization field (output, modified in-place).</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Y-component QW polarization field (output, modified in-place).</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – Z-component QW polarization field (output, modified in-place).</p></li>
<li><p><strong>Re</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – QW electron charge density (output, modified in-place).</p></li>
<li><p><strong>Rh</strong> (<em>ndarray</em><em> (</em><em>complex</em><em>)</em><em>, </em><em>shape</em><em> (</em><em>Nr</em><em>,</em><em>)</em>) – QW hole charge density (output, modified in-place).</p></li>
<li><p><strong>WriteFields</strong> (<em>bool</em>) – Flag to record SBE solutions and write output files this time step.</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Quantum wire index (which wire to calculate for).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All output arrays (Px, Py, Pz, Re, Rh, Ex, Ey, Ez, Vr) are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function implements the following sequence:</p>
<ol class="arabic simple">
<li><p><strong>Initialize source terms</strong> to zero</p></li>
<li><p><strong>Checkout coherence matrices</strong> from module storage for wire w</p></li>
<li><p><strong>Prepare arrays</strong> (Hamiltonians, screening, dephasing) via Preparation()</p></li>
<li><p><strong>Calculate time derivatives</strong> dp/dt, dC/dt, dD/dt</p></li>
<li><p><strong>Time evolve</strong> using leapfrog scheme: X3 = X1 + dX/dt * 2*dt</p></li>
<li><p><strong>Apply relaxation</strong> (phonon/carrier-carrier scattering) if enabled</p></li>
<li><p><strong>Apply DC transport</strong> if enabled</p></li>
<li><p><strong>Normalize populations</strong> to ensure charge neutrality</p></li>
<li><p><strong>Reshuffle</strong> for stability (convert leapfrog to implicit Euler)</p></li>
<li><p><strong>Calculate polarization</strong> Px, Py, Pz from coherence p</p></li>
<li><p><strong>Calculate charge densities</strong> Re, Rh if longitudinal field enabled</p></li>
<li><p><strong>Write output files</strong> if WriteFields is True</p></li>
<li><p><strong>Checkin updated matrices</strong> to module storage</p></li>
</ol>
<p><strong>Time Integration Scheme:</strong>
The leapfrog scheme is:
- X3 = X1 + dX/dt * 2*dt  (2nd order accurate but potentially unstable)
- Then reshuffled to: X2 = (X1 + X3) / 2  (1st order accurate but stable)</p>
<p>This converts the 2nd-order accurate (but unstable) leapfrog scheme into
a 1st-order accurate (but stable) implicit Euler scheme.</p>
<p><strong>Charge Neutrality:</strong>
The populations are normalized so that:
- Total electrons = Total holes = (sum(ne) + sum(nh)) / 2
This ensures charge neutrality in the system.</p>
<p><strong>FFT Operations:</strong>
The electric fields and polarizations are FFT’d to real space for
calculations, then FFT’d back to momentum space. This is done because:
- Some calculations are easier in real space
- The output is written in real space (at center point Nr/2)</p>
<p><strong>Output Files:</strong>
If WriteFields is True:
- WriteSBESolns: Writes coherence matrices and populations
- WriteDephasing: Writes dephasing rates (if DiagDph enabled)
- File (uw+w): Writes statistics (velocities, densities, energies, etc.)
- File (2*uw+w): Writes fields and polarizations at center point</p>
<p><strong>Module Variables Used:</strong>
- _YY1, _YY2, _YY3: Electron-hole coherence matrices
- _CC1, _CC2, _CC3: Electron-electron coherence matrices
- _DD1, _DD2, _DD3: Hole-hole coherence matrices
- _Id, _Ia: Identity and anti-identity matrices
- _kr, _Ee, _Eh: Momentum and energy arrays
- _r, _Qr: Spatial and momentum arrays
- _I0: Drift current array
- _xxx, _jjj: Time step counters
- _gap, _me, _mh, _L, _area, _ehint: Material parameters
- _Optics, _EHs, _Phonon, _DCTrans, _LF, _DiagDph: Physics flags</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#PSTD3D.Preparation" title="PSTD3D.Preparation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Preparation</span></code></a></dt><dd><p>Prepare Hamiltonians and arrays for SBE time step</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.dpdt" title="PSTD3D.dpdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dpdt</span></code></a></dt><dd><p>Calculate time derivative of electron-hole coherence</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.dCdt" title="PSTD3D.dCdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dCdt</span></code></a></dt><dd><p>Calculate time derivative of electron-electron coherence</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.dDdt" title="PSTD3D.dDdt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dDdt</span></code></a></dt><dd><p>Calculate time derivative of hole-hole coherence</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.Relaxation" title="PSTD3D.Relaxation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Relaxation</span></code></a></dt><dd><p>Apply phonon and carrier-carrier scattering</p>
</dd>
<dt><a class="reference internal" href="#id34" title="PSTD3D.Transport"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Transport</span></code></a></dt><dd><p>Apply DC field transport effects</p>
</dd>
<dt><a class="reference internal" href="#id14" title="PSTD3D.QWPolarization3"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWPolarization3</span></code></a></dt><dd><p>Calculate polarization from coherence</p>
</dd>
<dt><a class="reference internal" href="#id18" title="PSTD3D.QWRho5"><code class="xref py py-obj docutils literal notranslate"><span class="pre">QWRho5</span></code></a></dt><dd><p>Calculate charge densities from coherence</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.Checkout" title="PSTD3D.Checkout"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkout</span></code></a></dt><dd><p>Retrieve coherence matrices from module storage</p>
</dd>
<dt><a class="reference internal" href="#PSTD3D.Checkin" title="PSTD3D.Checkin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Checkin</span></code></a></dt><dd><p>Store coherence matrices to module storage</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id0">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">FFTG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">F</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="Link to this definition"></a></dt>
<dd><p>FFT with Gaussian normalization.</p>
<p>Performs FFT and applies Gaussian normalization: F = -FFT(F) / Nf</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>F</strong> (<em>ndarray</em>) – Input function (complex), modified in-place, 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>F array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses pyfftw for FFT computation.
The function performs: FFTC(F) then F = -F / Nf</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id6">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">iFFTG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">F</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id6" title="Link to this definition"></a></dt>
<dd><p>IFFT with Gaussian normalization.</p>
<p>Performs IFFT and applies Gaussian normalization: F = -IFFT(F) * Nf</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>F</strong> (<em>ndarray</em>) – Input function (complex), modified in-place, 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>F array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses pyfftw for IFFT computation.
The function performs: iFFTC(F) then F = -F * Nf</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.printIT">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">printIT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.printIT" title="Link to this definition"></a></dt>
<dd><p>Print field to file with index number.</p>
<p>Writes a complex 1D field array to a file with index number in filename.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Dx</strong> (<em>ndarray</em>) – Field array (complex), 1D array</p></li>
<li><p><strong>z</strong> (<em>ndarray</em>) – Spatial coordinates (real), 1D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Index number for filename</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension and index)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The file is written to ‘dataQW/{file}{n:06d}.dat’.
Each line contains: z(i), real(Dx(i)), imag(Dx(i))</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.printIT2D">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">printIT2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.printIT2D" title="Link to this definition"></a></dt>
<dd><p>Print 2D complex field to file with index number.</p>
<p>Writes a 2D complex field array to a file with index number in filename.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Dx</strong> (<em>ndarray</em>) – Field array (complex), 2D array</p></li>
<li><p><strong>z</strong> (<em>ndarray</em>) – Spatial coordinates (real), 1D array (not used in output)</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Index number for filename</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension and index)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The file is written to ‘dataQW/{file}{n:07d}.dat’.
Each line contains: abs(Dx(i,j))
The z parameter is kept for interface compatibility but not used.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id7">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetArray0Index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id7" title="Link to this definition"></a></dt>
<dd><p>Get index of array element closest to zero.</p>
<p>Finds the index where the array value is closest to zero
by rounding and checking for zero.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>ndarray</em>) – Input array (real), 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Index (1-based in Fortran, 0-based in Python) where value is closest to zero</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function rounds array values and finds the first index
where the rounded value is zero. Returns error message if not found.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id8">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">twopi</span></span><a class="headerlink" href="#id8" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.c0">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">c0</span></span><a class="headerlink" href="#PSTD3D.c0" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id9">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">hbar</span></span><a class="headerlink" href="#id9" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id10">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">eps0</span></span><a class="headerlink" href="#id10" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id11">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ii</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1j</span></em><a class="headerlink" href="#id11" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id12">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Prop2QW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">RR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Exx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eyy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ezz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vrr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id12" title="Link to this definition"></a></dt>
<dd><p>Convert Maxwell electric fields from propagation space to QW space.</p>
<p>Converts the Maxwell electric fields (Exx, Eyy, Ezz, Vrr) in
the propagation space (RR) into the QW electric fields (Ex, Ey, Ez, Vr)
in the QW electric field space (R). After interpolating from the RR-space
to the R-space, the FFT from the R- to Qr-space is taken.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>RR</strong> (<em>ndarray</em>) – Maxwell RR spatial array, 1D array</p></li>
<li><p><strong>Exx</strong> (<em>ndarray</em>) – Maxwell X electric field, 1D array, complex</p></li>
<li><p><strong>Eyy</strong> (<em>ndarray</em>) – Maxwell Y electric field, 1D array, complex</p></li>
<li><p><strong>Ezz</strong> (<em>ndarray</em>) – Maxwell Z electric field, 1D array, complex</p></li>
<li><p><strong>Vrr</strong> (<em>ndarray</em>) – Maxwell free charge potential, 1D array, complex</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – QW spatial array (modified in-place, currently unused)</p></li>
<li><p><strong>R</strong> (<em>ndarray</em>) – QW spatial array, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – QW X electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – QW Y electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – QW Z electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – QW free charge potential (modified in-place), 1D array, complex</p></li>
<li><p><strong>t</strong> (<em>float</em>) – Current time (s)</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Ex, Ey, Ez, Vr, Edc are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _QWWindow for windowing.
Fields are made real before FFT.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id13">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QW2Prop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pyy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pzz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RhoE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RhoH</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">WriteFields</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Plasmonics</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id13" title="Link to this definition"></a></dt>
<dd><p>Convert QW fields and polarizations back to propagation space.</p>
<p>Converts QW electric fields, polarizations, and charge densities
from QW space (r, Qr) back to propagation space (RR).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> (<em>ndarray</em>) – QW Y-spaces, 1D array</p></li>
<li><p><strong>Qr</strong> (<em>ndarray</em>) – QW momentum space, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – QW X electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – QW Y electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – QW Z electric field (modified in-place), 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – QW free charge potential (modified in-place), 1D array, complex</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – QW X polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – QW Y polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – QW Z polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>re</strong> (<em>ndarray</em>) – QW electron charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>rh</strong> (<em>ndarray</em>) – QW hole charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>RR</strong> (<em>ndarray</em>) – Propagation Y-spaces, 1D array</p></li>
<li><p><strong>Pxx</strong> (<em>ndarray</em>) – Propagation X polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pyy</strong> (<em>ndarray</em>) – Propagation Y polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pzz</strong> (<em>ndarray</em>) – Propagation Z polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>RhoE</strong> (<em>ndarray</em>) – Propagation electron charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>RhoH</strong> (<em>ndarray</em>) – Propagation hole charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>WriteFields</strong> (<em>bool</em>) – Record fields?</p></li>
<li><p><strong>Plasmonics</strong> (<em>bool</em>) – Calculate charge densities?</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All input arrays are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _small for numerical stability.
Charge densities are normalized if Plasmonics is True.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id14">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWPolarization3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ehint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id14" title="Link to this definition"></a></dt>
<dd><p>Calculate QW polarization in 3D.</p>
<p>Computes the QW polarization components (Px, Py, Pz) from the
density matrix p using the dipole matrix elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinate array, 1D array</p></li>
<li><p><strong>p</strong> (<em>ndarray</em>) – Density matrix, shape (Nk, Nk), complex</p></li>
<li><p><strong>ehint</strong> (<em>float</em>) – Electron-hole space integral</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Area of wire (m^2)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – QW X polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – QW Y polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – QW Z polarization (modified in-place), 1D array, complex</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Px, Py, Pz are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variables _Xvc0, _Yvc0, _Zvc0, _Expikr, _Expikrc, _QWWindow.
Uses JIT compilation for performance-critical loops.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id15">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">yw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id15" title="Link to this definition"></a></dt>
<dd><p>Calculate wire-dependent sign factor.</p>
<p>Computes a sign factor based on the wire index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>w</strong> (<em>int</em>) – Wire index</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sign factor: (-1)**floor((w-1)/2)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Used for alternating sign patterns in multi-wire systems.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.printITReal2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">printITReal2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.printITReal2" title="Link to this definition"></a></dt>
<dd><p>Print real part of complex field to file.</p>
<p>Writes the real part of a complex field array to a file.
On the first call, writes both the field and coordinate values.
On subsequent calls, writes only the field values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Dx</strong> (<em>ndarray</em>) – Complex field array, 1D array</p></li>
<li><p><strong>z</strong> (<em>ndarray</em>) – Coordinate array, 1D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _firsttime to track first write.
Files are written to ‘dataQW/’ directory.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id16">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WriteSBESolns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id16" title="Link to this definition"></a></dt>
<dd><p>Write SBE (Semiconductor Bloch Equations) solutions to files.</p>
<p>Writes quantum wire electron/hole occupation numbers, coherence matrices,
and energies to output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – QW momentum array, 1D array</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – QW electron occupation numbers, 1D array, complex</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – QW hole occupation numbers, 1D array, complex</p></li>
<li><p><strong>C</strong> (<em>ndarray</em>) – QW electron/electron coherence matrix, 2D array, complex</p></li>
<li><p><strong>D</strong> (<em>ndarray</em>) – QW hole/hole coherence matrix, 2D array, complex</p></li>
<li><p><strong>P</strong> (<em>ndarray</em>) – QW electron/hole coherence matrix, 2D array, complex</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – QW electron energies, 1D array, complex</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – QW hole energies, 1D array, complex</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses printIT and printIT2D from usefulsubs to write data files.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WritePLSpectrum">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WritePLSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PLS</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WritePLSpectrum" title="Link to this definition"></a></dt>
<dd><p>Write photoluminescence spectrum to file.</p>
<p>Writes the photoluminescence spectrum as a function of photon energy
to an output file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hw</strong> (<em>ndarray</em>) – Photon energy array (J), 1D array</p></li>
<li><p><strong>PLS</strong> (<em>ndarray</em>) – Photoluminescence spectrum, 1D array</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Converts photon energy from Joules to eV (divides by e0).
Uses printIT from usefulsubs to write data file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.WriteQWFields">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WriteQWFields</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">QY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.WriteQWFields" title="Link to this definition"></a></dt>
<dd><p>Write QW field arrays to files.</p>
<p>Writes QW electric fields, polarizations, and charge densities
to output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>QY</strong> (<em>ndarray</em>) – QY momentum/y-space array, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – QW X electric field, 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – QW Y electric field, 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – QW Z electric field, 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – QW free charge potential, 1D array, complex</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – QW X polarization, 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – QW Y polarization, 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – QW Z polarization, 1D array, complex</p></li>
<li><p><strong>Re</strong> (<em>ndarray</em>) – QW electron charge density, 1D array, complex</p></li>
<li><p><strong>Rh</strong> (<em>ndarray</em>) – QW hole charge density, 1D array, complex</p></li>
<li><p><strong>sp</strong> (<em>str</em>) – Domain label (‘k’ or ‘r’) for file name</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses printIT from usefulsubs to write data files.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id17">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">WritePropFields</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ez</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Px</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Py</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id17" title="Link to this definition"></a></dt>
<dd><p>Write propagation field arrays to files.</p>
<p>Writes propagation electric fields, polarizations, and charge densities
to output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>Ex</strong> (<em>ndarray</em>) – Propagation X electric field, 1D array, complex</p></li>
<li><p><strong>Ey</strong> (<em>ndarray</em>) – Propagation Y electric field, 1D array, complex</p></li>
<li><p><strong>Ez</strong> (<em>ndarray</em>) – Propagation Z electric field, 1D array, complex</p></li>
<li><p><strong>Vr</strong> (<em>ndarray</em>) – Propagation free charge potential, 1D array, complex</p></li>
<li><p><strong>Px</strong> (<em>ndarray</em>) – Propagation X polarization, 1D array, complex</p></li>
<li><p><strong>Py</strong> (<em>ndarray</em>) – Propagation Y polarization, 1D array, complex</p></li>
<li><p><strong>Pz</strong> (<em>ndarray</em>) – Propagation Z polarization, 1D array, complex</p></li>
<li><p><strong>Re</strong> (<em>ndarray</em>) – Propagation electron charge density, 1D array, complex</p></li>
<li><p><strong>Rh</strong> (<em>ndarray</em>) – Propagation hole charge density, 1D array, complex</p></li>
<li><p><strong>sp</strong> (<em>str</em>) – Space label for file name</p></li>
<li><p><strong>w</strong> (<em>int</em>) – Wire index</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses printITReal2 to write real parts of complex fields.
Uses printIT for charge density difference.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id18">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWRho5</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kkp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">CC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">re</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xxx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jjj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id18" title="Link to this definition"></a></dt>
<dd><p>Calculate quantum wire charge densities.</p>
<p>Computes electron and hole charge densities in real space from
coherence matrices CC and DD using Fourier transforms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Qr</strong> (<em>ndarray</em>) – QW momentum array, 1D array</p></li>
<li><p><strong>kr</strong> (<em>ndarray</em>) – QW momentum array, 1D array</p></li>
<li><p><strong>R</strong> (<em>ndarray</em>) – QW spatial coordinate array, 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
<li><p><strong>kkp</strong> (<em>ndarray</em>) – Momentum difference index matrix, 2D array, integer</p></li>
<li><p><strong>p</strong> (<em>ndarray</em>) – Density matrix (unused, kept for interface compatibility), 2D array, complex</p></li>
<li><p><strong>CC</strong> (<em>ndarray</em>) – Electron/electron coherence matrix, 2D array, complex</p></li>
<li><p><strong>DD</strong> (<em>ndarray</em>) – Hole/hole coherence matrix, 2D array, complex</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers, 1D array, complex</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers, 1D array, complex</p></li>
<li><p><strong>re</strong> (<em>ndarray</em>) – Electron charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>rh</strong> (<em>ndarray</em>) – Hole charge density (modified in-place), 1D array, complex</p></li>
<li><p><strong>xxx</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>jjj</strong> (<em>int</em>) – Additional index (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>re and rh are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variables _Expikr, _Expikrc, _QWWindow, _small.
Normalizes charge densities to match total electron/hole numbers.
Removes boundary effects by subtracting average of first/last 10 points.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.printIT3D">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">printIT3D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.printIT3D" title="Link to this definition"></a></dt>
<dd><p>Print 3D complex array to file.</p>
<p>Writes a 3D complex array to a file, storing both real and imaginary parts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Dx</strong> (<em>ndarray</em>) – 3D complex array, shape (N1, N2, N3)</p></li>
<li><p><strong>z</strong> (<em>ndarray</em>) – Coordinate array (unused, kept for interface compatibility), 1D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Files are written to ‘dataQW/’ directory.
Each line contains real and imaginary parts of one array element.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.printITReal">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">printITReal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.printITReal" title="Link to this definition"></a></dt>
<dd><p>Print real part of complex field to file.</p>
<p>Writes the coordinate and real part of a complex field array to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Dx</strong> (<em>ndarray</em>) – Complex field array, 1D array</p></li>
<li><p><strong>z</strong> (<em>ndarray</em>) – Coordinate array, 1D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Time index</p></li>
<li><p><strong>file</strong> (<em>str</em>) – Base filename (without extension)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Files are written to ‘dataQW/’ directory.
Each line contains coordinate and real part of field.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id19">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">QWChi1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id19" title="Link to this definition"></a></dt>
<dd><p>Calculate quantum wire linear susceptibility.</p>
<p>Computes the frequency-dependent linear susceptibility of the quantum wire.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lam</strong> (<em>float</em>) – Wavelength (m)</p></li>
<li><p><strong>dky</strong> (<em>float</em>) – Momentum step (1/m)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies, 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies, 1D array</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Area of wire (m^2)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole dephasing rate (1/s)</p></li>
<li><p><strong>dcv</strong> (<em>complex</em>) – Carrier dipole moment (C m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Linear susceptibility chi^(1)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level constants twopi, c0, eps0, hbar, ii.
Formula: chi^(1) = 4 * dcv^2 / (eps0 * area) * dky / (2*pi) *</p>
<blockquote>
<div><p>sum((Ee+Eh) / ((Ee+Eh - i*hbar*geh - hbar*w) * (Ee+Eh + i*hbar*geh + hbar*w)))</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcQWWindow">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcQWWindow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">YY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcQWWindow" title="Link to this definition"></a></dt>
<dd><p>Calculate quantum wire window function.</p>
<p>Computes a window function that smoothly goes to zero outside
the wire length L/2, using an exponential decay.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>YY</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies module-level variable _QWWindow.
Window function: exp(-(YY/(L/2))^150)
Values outside <a href="#id53"><span class="problematic" id="id54">|YY|</span></a> &gt; L/2 are set to 0 before applying exponential.
Uses printIT to write envelope to file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id20">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeQWOptics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">RR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ehint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id20" title="Link to this definition"></a></dt>
<dd><p>Initialize quantum wire optics module.</p>
<p>Sets up all necessary arrays and parameters for quantum wire optics
calculations, including window functions, phase factors, and dipole
matrix elements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>RR</strong> (<em>ndarray</em>) – Spatial coordinate array, 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of wire (m)</p></li>
<li><p><strong>dcv</strong> (<em>complex</em>) – Carrier dipole moment (C m)</p></li>
<li><p><strong>kr</strong> (<em>ndarray</em>) – Momentum coordinate array, 1D array</p></li>
<li><p><strong>Qr</strong> (<em>ndarray</em>) – Momentum coordinate array (unused, kept for interface compatibility), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies, 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies, 1D array</p></li>
<li><p><strong>ehint</strong> (<em>float</em>) – Electron-hole space integral</p></li>
<li><p><strong>area</strong> (<em>float</em>) – Area of wire (m^2)</p></li>
<li><p><strong>gap</strong> (<em>float</em>) – Band gap (J) (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies module-level variables _QWWindow, _Expikr, _Expikrc, _dcv0, _Vol,
_Xcv0, _Ycv0, _Zcv0, _Xvc0, _Yvc0, _Zvc0.
Calculates dipole matrix elements Xcv0, Ycv0, Zcv0 and their conjugates.
Uses module-level constants twopi.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcExpikr">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcExpikr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcExpikr" title="Link to this definition"></a></dt>
<dd><p>Vectorized version (potentially faster than JIT for large arrays).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id21">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Xcv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id21" title="Link to this definition"></a></dt>
<dd><p>Get X dipole matrix element.</p>
<p>Returns the X component of the dipole matrix element at indices (k, kp).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (0-based in Python)</p></li>
<li><p><strong>kp</strong> (<em>int</em>) – Second index (0-based in Python)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>X dipole matrix element value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Xcv0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id22">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Ycv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id22" title="Link to this definition"></a></dt>
<dd><p>Get Y dipole matrix element.</p>
<p>Returns the Y component of the dipole matrix element at indices (k, kp).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (0-based in Python)</p></li>
<li><p><strong>kp</strong> (<em>int</em>) – Second index (0-based in Python)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Y dipole matrix element value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Ycv0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id23">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Zcv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id23" title="Link to this definition"></a></dt>
<dd><p>Get Z dipole matrix element.</p>
<p>Returns the Z component of the dipole matrix element at indices (k, kp).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (0-based in Python)</p></li>
<li><p><strong>kp</strong> (<em>int</em>) – Second index (0-based in Python)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Z dipole matrix element value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>complex</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Zcv0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetVn1n2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetVn1n2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hcc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Hcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vcc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vvv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vcv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vvc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetVn1n2" title="Link to this definition"></a></dt>
<dd><p>Calculate interaction matrices Vcc, Vvv, Vcv, Vvc.</p>
<p>Computes the interaction matrices from Hamiltonian matrices and
dipole moment arrays using the Heisenberg equation of motion.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kr</strong> (<em>ndarray</em>) – Momentum coordinate array, 1D array</p></li>
<li><p><strong>rcv</strong> (<em>ndarray</em>) – Conduction-valence dipole moment array, 1D array, complex</p></li>
<li><p><strong>Hcc</strong> (<em>ndarray</em>) – Conduction-conduction Hamiltonian matrix, 2D array, complex</p></li>
<li><p><strong>Hhh</strong> (<em>ndarray</em>) – Hole-hole Hamiltonian matrix, 2D array, complex</p></li>
<li><p><strong>Hcv</strong> (<em>ndarray</em>) – Conduction-valence Hamiltonian matrix, 2D array, complex</p></li>
<li><p><strong>Vcc</strong> (<em>ndarray</em>) – Conduction-conduction interaction matrix (modified in-place), 2D array, complex</p></li>
<li><p><strong>Vvv</strong> (<em>ndarray</em>) – Valence-valence interaction matrix (modified in-place), 2D array, complex</p></li>
<li><p><strong>Vcv</strong> (<em>ndarray</em>) – Conduction-valence interaction matrix (modified in-place), 2D array, complex</p></li>
<li><p><strong>Vvc</strong> (<em>ndarray</em>) – Valence-conduction interaction matrix (modified in-place), 2D array, complex</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vcc, Vvv, Vcv, Vvc are modified in-place</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level constants ii, hbar.
Formula: V = (-i/hbar) * [rcv * H - H * rcv]
Uses JIT compilation for performance-critical loops.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id24">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">pi</span></span><a class="headerlink" href="#id24" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id25">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">hbar</span></span><a class="headerlink" href="#id25" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id26">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ii</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1j</span></em><a class="headerlink" href="#id26" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id27">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetKArray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Nk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id27" title="Link to this definition"></a></dt>
<dd><p>(typespace.py should be there)
Generate k-space array for Fourier transforms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Nk</strong> (<em>int</em>) – Number of k-space points</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the spatial domain (m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array of k values (1/m), 1D array of length Nk</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id28">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeDC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id28" title="Link to this definition"></a></dt>
<dd><p>Initialize the DC field module.</p>
<p>Sets up all module-level arrays required for DC field calculations.
Allocates and initializes Y, xe, xh, qinv arrays and opens output files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All arrays are stored as module-level variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcDCE2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcDCE2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">DCTrans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcDCE2" title="Link to this definition"></a></dt>
<dd><p>Calculate DC field contribution for electrons (version 2).</p>
<p>Computes the DC field transport contribution to the electron distribution
evolution. This version uses a finite difference derivative instead of FFT.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>DCTrans</strong> (<em>bool</em>) – Whether to include DC transport terms</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Inverse electron lifetime (Hz)</p></li>
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Vee</strong> (<em>ndarray</em>) – Electron-electron interaction matrix (J), 2D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Time step index</p></li>
<li><p><strong>j</strong> (<em>int</em>) – Iteration index</p></li>
<li><p><strong>DC</strong> (<em>ndarray</em>) – Output DC field contribution (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DC array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcDCH2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcDCH2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">DCTrans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcDCH2" title="Link to this definition"></a></dt>
<dd><p>Calculate DC field contribution for holes (version 2).</p>
<p>Computes the DC field transport contribution to the hole distribution
evolution. This version uses a finite difference derivative instead of FFT.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>DCTrans</strong> (<em>bool</em>) – Whether to include DC transport terms</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Inverse hole lifetime (Hz)</p></li>
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>Vhh</strong> (<em>ndarray</em>) – Hole-hole interaction matrix (J), 2D array</p></li>
<li><p><strong>n</strong> (<em>int</em>) – Time step index</p></li>
<li><p><strong>j</strong> (<em>int</em>) – Iteration index</p></li>
<li><p><strong>DC</strong> (<em>ndarray</em>) – Output DC field contribution (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DC array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcDCE">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcDCE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">DCTrans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcDCE" title="Link to this definition"></a></dt>
<dd><p>Calculate DC field contribution for electrons (original version).</p>
<p>Computes the DC field transport contribution to the electron distribution
evolution. This version uses FFT-based derivative.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>DCTrans</strong> (<em>bool</em>) – Whether to include DC transport terms</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Inverse electron lifetime (Hz)</p></li>
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Vee</strong> (<em>ndarray</em>) – Electron-electron interaction matrix (J), 2D array</p></li>
<li><p><strong>DC</strong> (<em>ndarray</em>) – Output DC field contribution (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DC array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcDCH">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcDCH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">DCTrans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Vhh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcDCH" title="Link to this definition"></a></dt>
<dd><p>Calculate DC field contribution for holes (original version).</p>
<p>Computes the DC field transport contribution to the hole distribution
evolution. This version uses FFT-based derivative.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>DCTrans</strong> (<em>bool</em>) – Whether to include DC transport terms</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Inverse hole lifetime (Hz)</p></li>
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>Vhh</strong> (<em>ndarray</em>) – Hole-hole interaction matrix (J), 2D array</p></li>
<li><p><strong>DC</strong> (<em>ndarray</em>) – Output DC field contribution (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DC array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id29">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcI0n</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id29" title="Link to this definition"></a></dt>
<dd><p>Calculate electron current.</p>
<p>Computes the electron current from the electron distribution and momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Electron current (A)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id30">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcI0</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">I0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id30" title="Link to this definition"></a></dt>
<dd><p>Calculate total current from electron and hole distributions.</p>
<p>Computes the total current by calculating drift velocities for both
electrons and holes, then combining them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Interaction matrix (J), 3D array VC[:,:,2] for electrons, VC[:,:,3] for holes</p></li>
<li><p><strong>dk</strong> (<em>float</em>) – Momentum step size (1/m)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array (unused, kept for interface compatibility)</p></li>
<li><p><strong>I0</strong> (<em>float</em>) – Input value (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Total current (A)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.EkReNorm">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">EkReNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">En</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.EkReNorm" title="Link to this definition"></a></dt>
<dd><p>Renormalize energy with many-body corrections.</p>
<p>Computes the renormalized energy including Hartree-Fock corrections:
Ec(k) = En(k) + sum(n(:) * (V(k,k) - V(k,:))) / 2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers, 1D array</p></li>
<li><p><strong>En</strong> (<em>ndarray</em>) – Single-particle energies (J), 1D array</p></li>
<li><p><strong>V</strong> (<em>ndarray</em>) – Interaction matrix (J), 2D array V[k1, k2]</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Renormalized energies (J), 1D array</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.DriftVt">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">DriftVt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.DriftVt" title="Link to this definition"></a></dt>
<dd><p>Calculate drift velocity.</p>
<p>Computes the average drift velocity from the energy gradient and
carrier distribution: v = sum(dEcdk * n) / sum(n) / hbar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers, 1D array</p></li>
<li><p><strong>Ec</strong> (<em>ndarray</em>) – Renormalized energies (J), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Drift velocity (m/s)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses finite difference to compute dEcdk, with boundary extrapolation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Lrtz">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Lrtz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Lrtz" title="Link to this definition"></a></dt>
<dd><p>Lorentzian function.</p>
<p>Computes the Lorentzian line shape function: (b/pi) / (a^2 + b^2)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>float</em><em> or </em><em>ndarray</em>) – Frequency offset or energy difference</p></li>
<li><p><strong>b</strong> (<em>float</em><em> or </em><em>ndarray</em>) – Half-width at half-maximum (HWHM)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Lorentzian function value</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float or ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.theta">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">theta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.theta" title="Link to this definition"></a></dt>
<dd><p>Heaviside step function (theta function).</p>
<p>Computes the step function: (abs(x) + x) / 2 / (abs(x) + small)
Returns 1 for x &gt; 0, 0 for x &lt;= 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>float</em><em> or </em><em>ndarray</em>) – Input value</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Step function value (0 or 1, 0 at x=0)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float or ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.FDrift2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">FDrift2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.FDrift2" title="Link to this definition"></a></dt>
<dd><p>Calculate drift force from phonon interactions.</p>
<p>Computes the drift force due to phonon emission and absorption processes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>g</strong> (<em>float</em>) – Inverse lifetime (Hz)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers, 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>v</strong> (<em>float</em>) – Drift velocity (m/s)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>x</strong> (<em>ndarray</em>) – k-dependent delta-function coefficients, 1D array (unused, kept for interface compatibility)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Drift force (N), 1D array</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.FDrift">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">FDrift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dndk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.FDrift" title="Link to this definition"></a></dt>
<dd><p>Calculate drift force (alternative implementation).</p>
<p>Computes the drift force using a different approach with dndk derivative.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>q</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>dndk</strong> (<em>ndarray</em>) – Derivative of carrier occupation with respect to momentum, 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>v</strong> (<em>float</em>) – Drift velocity (m/s)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>x</strong> (<em>ndarray</em>) – k-dependent delta-function coefficients, 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Drift force (N)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ThetaEM">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ThetaEM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ThetaEM" title="Link to this definition"></a></dt>
<dd><p>Calculate emission matrix element.</p>
<p>Computes the emission rate matrix element for phonon-assisted transitions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>g</strong> (<em>float</em>) – Inverse lifetime (Hz)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers, 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>v</strong> (<em>float</em>) – Drift velocity (m/s)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>q</strong> (<em>int</em>) – Phonon momentum index (1-based, will be converted to 0-based)</p></li>
<li><p><strong>k</strong> (<em>int</em>) – Carrier momentum index (1-based, will be converted to 0-based)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Emission matrix element</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ThetaABS">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ThetaABS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ThetaABS" title="Link to this definition"></a></dt>
<dd><p>Calculate absorption matrix element.</p>
<p>Computes the absorption rate matrix element for phonon-assisted transitions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>g</strong> (<em>float</em>) – Inverse lifetime (Hz)</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers, 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>v</strong> (<em>float</em>) – Drift velocity (m/s)</p></li>
<li><p><strong>N0</strong> (<em>float</em>) – Phonon occupation number</p></li>
<li><p><strong>q</strong> (<em>int</em>) – Phonon momentum index (1-based, will be converted to 0-based)</p></li>
<li><p><strong>k</strong> (<em>int</em>) – Carrier momentum index (1-based, will be converted to 0-based)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Absorption matrix element</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcAvgCoeff">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcAvgCoeff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcAvgCoeff" title="Link to this definition"></a></dt>
<dd><p>Calculate average coefficients for interpolation.</p>
<p>Computes interpolation coefficients for bilinear interpolation in k-space.
The function extends the ky array with boundary points and calculates
coefficients based on the positions k1, k2 and indices i1, i2.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>dk</strong> (<em>float</em>) – Momentum step size (1/m)</p></li>
<li><p><strong>k1</strong> (<em>float</em>) – First momentum value for interpolation</p></li>
<li><p><strong>k2</strong> (<em>float</em>) – Second momentum value for interpolation</p></li>
<li><p><strong>i1</strong> (<em>int</em>) – First index (1-based, will be converted to 0-based)</p></li>
<li><p><strong>i2</strong> (<em>int</em>) – Second index (1-based, will be converted to 0-based)</p></li>
<li><p><strong>x1</strong> (<em>float</em>) – Output coefficient 1 (modified in-place, but Python can’t modify floats in-place)</p></li>
<li><p><strong>x2</strong> (<em>float</em>) – Output coefficient 2 (modified in-place, but Python can’t modify floats in-place)</p></li>
<li><p><strong>x3</strong> (<em>float</em>) – Output coefficient 3 (modified in-place, but Python can’t modify floats in-place)</p></li>
<li><p><strong>x4</strong> (<em>float</em>) – Output coefficient 4 (modified in-place, but Python can’t modify floats in-place)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple containing (x1, x2, x3, x4) coefficients</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id31">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcVD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id31" title="Link to this definition"></a></dt>
<dd><p>Calculate drift velocity from distribution.</p>
<p>Computes the average drift velocity from the carrier distribution
and momentum: v = sum(real(n) * hbar * ky / m) / sum(real(n) + small)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers (complex), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Drift velocity (m/s)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id32">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcPD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id32" title="Link to this definition"></a></dt>
<dd><p>Calculate momentum from distribution.</p>
<p>Computes the average momentum from the carrier distribution:
p = sum(abs(n) * hbar * ky) / sum(abs(n) + small)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg) (unused, kept for interface compatibility)</p></li>
<li><p><strong>n</strong> (<em>ndarray</em>) – Carrier occupation numbers (complex), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Average momentum (kg·m/s)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id33">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetEDrift</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id33" title="Link to this definition"></a></dt>
<dd><p>Get electron drift rate.</p>
<p>Returns the electron temperature damping rate.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Electron temperature damping rate (Hz)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetHDrift">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetHDrift</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetHDrift" title="Link to this definition"></a></dt>
<dd><p>Get hole drift rate.</p>
<p>Returns the hole temperature damping rate.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Hole temperature damping rate (Hz)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetVEDrift">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetVEDrift</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetVEDrift" title="Link to this definition"></a></dt>
<dd><p>Get electron drift velocity.</p>
<p>Returns the electron drift velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Electron drift velocity (m/s)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GetVHDrift">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetVHDrift</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GetVHDrift" title="Link to this definition"></a></dt>
<dd><p>Get hole drift velocity.</p>
<p>Returns the hole drift velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Hole drift velocity (m/s)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.dndEk">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">dndEk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dndq</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.dndEk" title="Link to this definition"></a></dt>
<dd><p>Calculate derivative of occupation with respect to energy.</p>
<p>Computes the derivative dndEk from the derivative dndq with respect to
momentum, using the relationship between energy and momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>q</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>dndq</strong> (<em>ndarray</em>) – Derivative of occupation with respect to momentum, 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Derivative of occupation with respect to energy, 1D array</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ThetaEMABS">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ThetaEMABS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ephn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dndk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cq2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ThetaEMABS" title="Link to this definition"></a></dt>
<dd><p>Calculate emission-absorption matrix element.</p>
<p>Computes the combined emission-absorption rate matrix element
for phonon-assisted transitions using the energy derivative.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Ephn</strong> (<em>float</em>) – Average phonon energy (J)</p></li>
<li><p><strong>m</strong> (<em>float</em>) – Carrier mass (kg)</p></li>
<li><p><strong>q</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>dndk</strong> (<em>ndarray</em>) – Derivative of occupation with respect to momentum, 1D array</p></li>
<li><p><strong>Cq2</strong> (<em>ndarray</em>) – Coupling constant squared, 1D array</p></li>
<li><p><strong>v</strong> (<em>float</em>) – Drift velocity (m/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Emission-absorption matrix element, 1D array</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.DC_Step_Scale">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">DC_Step_Scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.DC_Step_Scale" title="Link to this definition"></a></dt>
<dd><p>DC step using scaling method (legacy code).</p>
<p>Performs a DC field step by scaling the distribution functions.
Uses rescale_1D to interpolate the distributions to shifted momentum grids.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), modified in-place, 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), modified in-place, 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step (s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ne and nh arrays are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function shifts the momentum grid by -e0*Edc/hbar*dt for electrons
and +e0*Edc/hbar*dt for holes. This corresponds to the DC field accelerating
electrons in the negative direction and holes in the positive direction.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.DC_Step_FD">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">DC_Step_FD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nemid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nhmid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.DC_Step_FD" title="Link to this definition"></a></dt>
<dd><p>DC step using finite difference method (legacy code).</p>
<p>Performs a DC field step using finite difference derivatives.
Updates the electron and hole distributions based on the DC field
and momentum-dependent terms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron occupation numbers (complex), modified in-place, 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole occupation numbers (complex), modified in-place, 1D array</p></li>
<li><p><strong>nemid</strong> (<em>ndarray</em>) – Midpoint electron occupation numbers (complex), 1D array</p></li>
<li><p><strong>nhmid</strong> (<em>ndarray</em>) – Midpoint hole occupation numbers (complex), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step (s)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ne and nh arrays are modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ShiftN1D">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ShiftN1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dk</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ShiftN1D" title="Link to this definition"></a></dt>
<dd><p>Shift 1D distribution in momentum space (legacy code).</p>
<p>Shifts the distribution function in momentum space by dk using FFT.
This is equivalent to multiplying by exp(-ii * Y * dk) in Fourier space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Carrier occupation numbers (complex), modified in-place, 1D array</p></li>
<li><p><strong>dk</strong> (<em>float</em>) – Momentum shift (1/m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ne array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses pyfftw for FFT operations.
The function performs: FFT -&gt; multiply by exp(-ii*Y*dk) -&gt; IFFT</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.ShiftN2D">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ShiftN2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dk</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.ShiftN2D" title="Link to this definition"></a></dt>
<dd><p>Shift 2D distribution in momentum space (legacy code).</p>
<p>Shifts the 2D distribution function in momentum space by dk using FFT.
This is equivalent to multiplying by exp(-ii * (Y(k1) + Y2(k2)) * dk) in Fourier space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C</strong> (<em>ndarray</em>) – Distribution matrix (complex), modified in-place, 2D array</p></li>
<li><p><strong>dk</strong> (<em>float</em>) – Momentum shift (1/m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>C array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses pyfftw for FFT operations.
The function performs: FFT -&gt; multiply by exp(-ii*(Y+Y2)*dk) -&gt; IFFT</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id34">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Transport</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Edc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eac</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">DCTrans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k1nek2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id34" title="Link to this definition"></a></dt>
<dd><p>Transport step for distribution matrix (legacy code).</p>
<p>Performs a transport step on the distribution matrix C by shifting
in momentum space. Can operate on the full 2D matrix or just the diagonal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C</strong> (<em>ndarray</em>) – Distribution matrix (complex), modified in-place, 2D array</p></li>
<li><p><strong>Edc</strong> (<em>float</em>) – DC electric field (V/m)</p></li>
<li><p><strong>Eac</strong> (<em>float</em>) – AC electric field (V/m)</p></li>
<li><p><strong>dt</strong> (<em>float</em>) – Time step (s)</p></li>
<li><p><strong>DCTrans</strong> (<em>bool</em>) – Whether to include DC transport terms</p></li>
<li><p><strong>k1nek2</strong> (<em>bool</em>) – If True, shift the full 2D matrix; if False, shift only the diagonal</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>C array is modified in-place.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.K03">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">K03</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.K03" title="Link to this definition"></a></dt>
<dd><p>Modified Bessel function K0 for real argument.</p>
<p>Computes K0(x) using the complex Bessel function routine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>float</em>) – Real argument</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of K0(x), or 0.0 if x &gt; 100</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Returns 0.0 for large arguments (x &gt; 100) to avoid overflow.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id35">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">pi</span></span><a class="headerlink" href="#id35" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id36">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">twopi</span></span><a class="headerlink" href="#id36" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id37">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">hbar</span></span><a class="headerlink" href="#id37" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id38">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">eV</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1.602176634e-19</span></em><a class="headerlink" href="#id38" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id39">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ii</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1j</span></em><a class="headerlink" href="#id39" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id40">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializeCoulomb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">er</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kkp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">screened</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id40" title="Link to this definition"></a></dt>
<dd><p>Initialize the coulomb module and all of its needed quantities.</p>
<p>This is the main initialization function that sets up all module-level arrays
required for Coulomb interaction calculations. It calls the various setup functions
in the correct order, checking if arrays are already initialized to avoid
redundant calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Length coordinates of quantum wire (m), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Effective electron mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Effective hole mass (kg)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Inverse electron lifetime (Hz)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Inverse hole lifetime (Hz)</p></li>
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation between ground and 1st excited state for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation between ground and 1st excited state for holes (1/m)</p></li>
<li><p><strong>er</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>Qy</strong> (<em>ndarray</em>) – Momentum difference array (1/m), 1D array</p></li>
<li><p><strong>kkp</strong> (<em>ndarray</em>) – Index mapping array, 2D integer array. Maps (k,q) indices to Qy indices.</p></li>
<li><p><strong>screened</strong> (<em>bool</em>) – Whether to use screened interactions (not used in initialization, but passed through)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All arrays are stored as module-level variables (matching Fortran behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function initializes arrays in the following order:
1. UnDel - inverse delta function array
2. k3 - momentum conservation indexing array
3. qe, qh - momentum difference arrays
4. Ceh, Cee, Chh - many-body interaction arrays (requires k3 and UnDel)
5. Veh0, Vee0, Vhh0 - unscreened Coulomb arrays
6. Chi1De, Chi1Dh - susceptibility arrays (requires qe and qh)</p>
<p>Each array is only computed if it hasn’t been initialized yet, allowing
for incremental initialization or re-initialization with different parameters.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Vint">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Vint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Qyk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Vint" title="Link to this definition"></a></dt>
<dd><p>Calculate the interaction integral for Coulomb potential.</p>
<p>Computes the integral over spatial coordinates for the Coulomb interaction
between particles with level separations alphae and alphah. This is used to
calculate the unscreened Coulomb collision arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Qyk</strong> (<em>float</em>) – Momentum difference (1/m)</p></li>
<li><p><strong>y</strong> (<em>ndarray</em>) – Length coordinates of quantum wire (m), 1D array</p></li>
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation between ground and 1st excited state for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation between ground and 1st excited state for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Interaction integral value (dimensionless)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The integration is performed over a central region of the y array
(from Ny/4 to 3*Ny/4) to focus on the relevant quantum wire region.
Uses the modified Bessel function K0 to represent the Coulomb interaction.</p>
<p>Uses JIT compilation for performance with automatic fallback to pure Python.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Vehint">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Vehint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Vehint" title="Link to this definition"></a></dt>
<dd><p>Calculate electron-hole interaction integral.</p>
<p>Computes the interaction integral between an electron at momentum index k
and a hole at momentum index q. This is similar to Vint but uses the
momentum difference from the ky array directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – Electron momentum index. Note: Fortran uses 1-based indexing, so if
calling from Python with 0-based indices, pass k+1 and q+1, or adjust
the indices before calling.</p></li>
<li><p><strong>q</strong> (<em>int</em>) – Hole momentum index. Note: Fortran uses 1-based indexing, so if
calling from Python with 0-based indices, pass k+1 and q+1, or adjust
the indices before calling.</p></li>
<li><p><strong>y</strong> (<em>ndarray</em>) – Length coordinates of quantum wire (m), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation between ground and 1st excited state for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation between ground and 1st excited state for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Electron-hole interaction integral value (dimensionless)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function uses the momentum difference <a href="#id55"><span class="problematic" id="id56">|ky(k) - ky(q)|</span></a> to compute
the interaction. The integration is performed over a central region
of the y array (from Ny/4 to 3*Ny/4).</p>
<p>Note on indexing: The Fortran version uses 1-based indexing. If k and q
are passed as 1-based indices (matching Fortran), they will be converted
to 0-based for array access. If passed as 0-based, subtract 1 is not needed.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcCoulombArrays">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcCoulombArrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">er</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Qy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kkp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ReadArrays</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ScrewThis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcCoulombArrays" title="Link to this definition"></a></dt>
<dd><p>Construct the unscreened Coulomb collision arrays.</p>
<p>Calculates the electron-hole (Veh0), electron-electron (Vee0), and
hole-hole (Vhh0) unscreened Coulomb interaction matrices for a quantum wire.
These arrays are used in the Semiconductor Bloch Equations to compute
many-body interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>ndarray</em>) – Length coordinates of quantum wire (m), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>er</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation between ground and 1st excited state for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation between ground and 1st excited state for holes (1/m)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>Qy</strong> (<em>ndarray</em>) – Momentum difference array (1/m), 1D array</p></li>
<li><p><strong>kkp</strong> (<em>ndarray</em>) – Index mapping array, 2D integer array. Maps (k,q) indices to Qy indices.
Values &gt;= 0 indicate valid mappings, &lt; 0 indicate invalid.</p></li>
<li><p><strong>ReadArrays</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, read pre-calculated arrays from files (not implemented).
Default is False.</p></li>
<li><p><strong>ScrewThis</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, skip calculation and return zero arrays. Default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(Veh0, Vee0, Vhh0) where:
- Veh0: Electron-hole interaction matrix (J), shape (N, N)
- Vee0: Electron-electron interaction matrix (J), shape (N, N)
- Vhh0: Hole-hole interaction matrix (J), shape (N, N)
where N = len(ky)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the interaction integrals for each momentum difference
in Qy, then maps these to the (k,q) grid using the kkp index array.
The calculation uses the Vint function to compute the spatial integrals.</p>
<p>The interaction matrices are computed as:
- Veh0(k,q) = (e0^2 / (2π * ε0 * er * L)) * Vint(Qy[kkp(k,q)], y, alphae, alphah, Delta0)
- Vee0(k,q) = (e0^2 / (2π * ε0 * er * L)) * Vint(Qy[kkp(k,q)], y, alphae, alphae, Delta0)
- Vhh0(k,q) = (e0^2 / (2π * ε0 * er * L)) * Vint(Qy[kkp(k,q)], y, alphah, alphah, Delta0)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.GaussDelta">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GaussDelta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.GaussDelta" title="Link to this definition"></a></dt>
<dd><p>(Was commented out in the Fortran code and had implications on the CalcMBArrays function)
Gaussian delta function approximation.</p>
<p>Computes a Gaussian approximation to the delta function, used in
many-body interaction calculations when LorentzDelta is False.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>float</em>) – Energy difference argument (J)</p></li>
<li><p><strong>b</strong> (<em>float</em>) – Broadening parameter (J)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gaussian delta function value (1/J)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function implements: 1 / (sqrt(pi) * b) * exp(-(a/b)^2)
This is a smooth approximation to the delta function with width b.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MakeK3">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MakeK3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MakeK3" title="Link to this definition"></a></dt>
<dd><p>Construct the k3 indexing array for momentum conservation.</p>
<p>Creates a 3D array k3 where k3(k1, k2, k4) represents the index k3
that satisfies the momentum conservation relation: k1 + k2 = k3 + k4.
This is used in many-body interaction calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>3D integer array of shape (N, N, N) where N = len(ky).
Values are 1-based indices (matching Fortran) if valid,
or 0 if the momentum combination is invalid (out of bounds).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The array is computed as: k3i = k1 + k2 - k4
If k3i is outside the valid range [1, N], it is set to 0.
The returned array uses 1-based indexing to match Fortran behavior,
so valid indices are in the range [1, N], with 0 indicating invalid.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MakeQs">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MakeQs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ah</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MakeQs" title="Link to this definition"></a></dt>
<dd><p>Construct the qe and qh momentum difference arrays.</p>
<p>Creates arrays representing the momentum differences between states,
with minimum values set by the level separation parameters ae and ah.
These arrays are used in screening and interaction calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>ae</strong> (<em>float</em>) – Level separation parameter for electrons (1/m)</p></li>
<li><p><strong>ah</strong> (<em>float</em>) – Level separation parameter for holes (1/m)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(qe, qh) where:
- qe: Electron momentum difference array (1/m), shape (N, N)
- qh: Hole momentum difference array (1/m), shape (N, N)
where N = len(ky)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The arrays are computed as:
- qe(k1, k2) = max(<a href="#id57"><span class="problematic" id="id58">|ky(k2) - ky(k1)|</span></a>, ae/2)
- qh(k1, k2) = max(<a href="#id59"><span class="problematic" id="id60">|ky(k2) - ky(k1)|</span></a>, ah/2)
This ensures a minimum momentum difference to avoid singularities.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MakeUnDel">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MakeUnDel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MakeUnDel" title="Link to this definition"></a></dt>
<dd><p>Construct the UnDel (1 - delta) array.</p>
<p>Creates an array representing (1 - delta_ij) where delta_ij is the
Kronecker delta. This is used to exclude self-interaction terms
in many-body calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>2D array of shape (N+1, N+1) where N = len(ky).
Values are 1.0 except:
- Row 0 and column 0 are all 0.0
- Diagonal elements (i, i) for i=1..N are 0.0</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The array has an extra row and column (index 0) compared to the
momentum array size, matching the Fortran implementation which uses
0-based indexing for the first row/column.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id41">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">SetLorentzDelta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boolean</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id41" title="Link to this definition"></a></dt>
<dd><p>Set the LorentzDelta flag for many-body array calculations.</p>
<p>This function sets a module-level flag that determines whether to use
Lorentzian broadening (True) or Gaussian delta function (False) in
the CalcMBArrays function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>boolean</strong> (<em>bool</em>) – If True, use Lorentzian broadening. If False, use Gaussian delta function.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This matches the Fortran interface where SetLorentzDelta sets a module-level
variable. The flag affects the behavior of CalcMBArrays when called without
explicitly specifying the LorentzDelta parameter.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcMBArrays">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcMBArrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">UnDel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">LorentzDelta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcMBArrays" title="Link to this definition"></a></dt>
<dd><p>Calculate the many-body interaction arrays.</p>
<p>Computes the electron-hole (Ceh), electron-electron (Cee), and
hole-hole (Chh) many-body interaction arrays used in the Semiconductor
Bloch Equations. These arrays represent the collision integrals for
carrier-carrier interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Electron inverse lifetime (Hz)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Hole inverse lifetime (Hz)</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em>) – 3D indexing array from MakeK3, shape (N, N, N)</p></li>
<li><p><strong>UnDel</strong> (<em>ndarray</em>) – 2D array from MakeUnDel, shape (N+1, N+1)</p></li>
<li><p><strong>LorentzDelta</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use Lorentzian broadening. If False, use Gaussian delta function.
If None (default), uses the module-level value set by SetLorentzDelta.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(Ceh, Cee, Chh) where:
- Ceh: Electron-hole interaction array (1/J), shape (N+1, N+1, N+1)
- Cee: Electron-electron interaction array (1/J), shape (N+1, N+1, N+1)
- Chh: Hole-hole interaction array (1/J), shape (N+1, N+1, N+1)
where N = len(ky). The arrays use 0-based indexing for the first dimension
to match Fortran’s 0:N range.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes interaction rates using either:
- Lorentzian broadening: 2*gamma * UnDel / ((E_diff)^2 + (hbar*gamma)^2)
- Gaussian delta function: (2π/hbar) * UnDel * GaussDelta(E_diff, hbar*gamma)</p>
<p>The arrays are indexed with 0-based first index (0..N) to match Fortran’s
allocation of arrays with bounds (0:N, 0:N, 0:N).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id42">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetChi1Dqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">game</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id42" title="Link to this definition"></a></dt>
<dd><p>Calculate the 1D quantum wire susceptibility (chi) for a given momentum and frequency.</p>
<p>Computes the real and imaginary parts of the susceptibility chi(q, w) for a quantum wire,
which describes the response of the system to external perturbations. This is used in
screening calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation parameter for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation parameter for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>game</strong> (<em>ndarray</em>) – Electron inverse lifetime array (Hz), 1D array</p></li>
<li><p><strong>gamh</strong> (<em>ndarray</em>) – Hole inverse lifetime array (Hz), 1D array</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron population array, 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole population array, 1D array</p></li>
<li><p><strong>qq</strong> (<em>float</em>) – Momentum value (1/m)</p></li>
<li><p><strong>w</strong> (<em>float</em>) – Frequency (rad/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(chir, chii) where:
- chir: Real part of susceptibility (dimensionless)
- chii: Imaginary part of susceptibility (dimensionless)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the susceptibility by summing over momentum states,
taking into account the energy differences and broadening due to lifetimes.
The calculation uses the K03 Bessel function for the interaction kernel.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id43">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">GetEps1Dqw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id43" title="Link to this definition"></a></dt>
<dd><p>Calculate the 1D quantum wire dielectric function epsilon(q, w).</p>
<p>Computes the real and imaginary parts of the dielectric function for a quantum wire,
which describes how the system responds to electromagnetic fields. This is used in
screening calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation parameter for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation parameter for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Electron effective mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Hole effective mass (kg)</p></li>
<li><p><strong>n1D</strong> (<em>float</em>) – 1D carrier density (1/m)</p></li>
<li><p><strong>q</strong> (<em>float</em>) – Momentum (1/m)</p></li>
<li><p><strong>w</strong> (<em>float</em>) – Frequency (rad/s)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(epr, epi) where:
- epr: Real part of dielectric function (dimensionless)
- epi: Imaginary part of dielectric function (dimensionless)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the dielectric function using the Lindhard formula
for a 1D system, with contributions from both electrons and holes.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcChi1D">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcChi1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphae</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alphah</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Delta0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">me</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcChi1D" title="Link to this definition"></a></dt>
<dd><p>Calculate the 1D susceptibility arrays Chi1De and Chi1Dh.</p>
<p>Computes the electron and hole susceptibility matrices used in screening calculations.
These arrays are stored as module-level variables for use in other functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates of quantum wire (1/m), 1D array</p></li>
<li><p><strong>alphae</strong> (<em>float</em>) – Level separation parameter for electrons (1/m)</p></li>
<li><p><strong>alphah</strong> (<em>float</em>) – Level separation parameter for holes (1/m)</p></li>
<li><p><strong>Delta0</strong> (<em>float</em>) – Thickness of the quantum wire (m)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Background dielectric constant (dimensionless)</p></li>
<li><p><strong>me</strong> (<em>float</em>) – Electron effective mass (kg)</p></li>
<li><p><strong>mh</strong> (<em>float</em>) – Hole effective mass (kg)</p></li>
<li><p><strong>qe</strong> (<em>ndarray</em>) – Electron momentum difference array from MakeQs, shape (N, N)</p></li>
<li><p><strong>qh</strong> (<em>ndarray</em>) – Hole momentum difference array from MakeQs, shape (N, N)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(Chi1De, Chi1Dh) where:
- Chi1De: Electron susceptibility array, shape (N, N)
- Chi1Dh: Hole susceptibility array, shape (N, N)
where N = len(ky)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The arrays are also stored as module-level variables _Chi1De and _Chi1Dh
for compatibility with Fortran module behavior.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Eps1D">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Eps1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Nk</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Eps1D" title="Link to this definition"></a></dt>
<dd><p>Calculate the 1D dielectric function matrix.</p>
<p>Computes the dielectric function matrix Eps1D for a given 1D carrier density,
using the pre-computed module-level susceptibility arrays Chi1De and Chi1Dh.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n1D</strong> (<em>float</em>) – 1D carrier density (1/m)</p></li>
<li><p><strong>Nk</strong> (<em>int</em>) – Size of momentum grid (should match size of module-level arrays)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>2D array of shape (Nk, Nk) representing the dielectric function matrix.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes: Eps1D = 1 - Chi1De * 2*log(…) - Chi1Dh * 2*log(…)
where the logarithms involve momentum-dependent terms.
Uses module-level variables _Chi1De, _Chi1Dh, _qe, _qh (matching Fortran behavior).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id44">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcScreenedArrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">screened</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id44" title="Link to this definition"></a></dt>
<dd><p>Calculate screened Coulomb interaction arrays.</p>
<p>Computes the screened version of the Coulomb interaction matrices by dividing
by the dielectric function. If screening is disabled, returns the unscreened arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>screened</strong> (<em>bool</em>) – If True, apply screening. If False, return unscreened arrays.</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length of the quantum wire (m)</p></li>
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron population array, 1D array</p></li>
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole population array, 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Input/output array for interaction matrices, shape (N, N, 3).
On input: should contain unscreened arrays (or will be filled from module-level).
On output: contains screened arrays if screened=True, unscreened otherwise.</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – Input/output array for dielectric function, shape (N, N).
On input: can be any array (will be overwritten).
On output: contains dielectric function matrix if screened=True, ones otherwise.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Arrays are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function uses module-level variables _Veh0, _Vee0, _Vhh0, _qe, _qh
(matching Fortran module behavior). If screening is enabled, computes the
dielectric function and divides the interaction matrices by it.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.CalcMVeh">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">CalcMVeh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MVeh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">UnDel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.CalcMVeh" title="Link to this definition"></a></dt>
<dd><p>Calculate the MVeh array for Semiconductor Bloch Equations.</p>
<p>Computes the many-body electron-hole interaction term MVeh used in the
Semiconductor Bloch Equations. This represents the Coulomb interaction
contribution to the polarization dynamics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> (<em>ndarray</em>) – Polarization array, shape (N, N, Nf) where N is momentum grid size
and Nf is number of frequency/time points</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (N, N, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 1] = Vee (electron-electron)
VC[:, :, 2] = Vhh (hole-hole)</p></li>
<li><p><strong>MVeh</strong> (<em>ndarray</em>) – Output array for MVeh calculation, shape (N, N, Nf).
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 3D indexing array from MakeK3, shape (N, N, N).
If None, uses module-level _k3.</p></li>
<li><p><strong>UnDel</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 2D array from MakeUnDel, shape (N+1, N+1).
If None, uses module-level _UnDel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>MVeh is modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The calculation sums over momentum states q, using the momentum conservation
relation k3(kp, q, k) to find qp. The UnDel factors exclude self-interaction terms.
Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.undell">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">undell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.undell" title="Link to this definition"></a></dt>
<dd><p>Wrapper function for UnDel array access.</p>
<p>Provides a simple interface to access the UnDel (1 - delta) array.
This is a convenience function matching the Fortran interface.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>int</em>) – First index (1-based, matching Fortran)</p></li>
<li><p><strong>q</strong> (<em>int</em>) – Second index (1-based, matching Fortran)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of UnDel(k, q) from module-level array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function accesses the module-level _UnDel array. The indices
are expected to be 1-based to match Fortran behavior.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.BGRenorm">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">BGRenorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">BGR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">UnDel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.BGRenorm" title="Link to this definition"></a></dt>
<dd><p>Calculate band gap renormalization.</p>
<p>Computes the band gap renormalization BGR due to many-body Coulomb interactions.
This accounts for the shift in band gap energy due to carrier-carrier interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C</strong> (<em>ndarray</em>) – Electron density matrix, shape (N, N), complex</p></li>
<li><p><strong>D</strong> (<em>ndarray</em>) – Hole density matrix, shape (N, N), complex</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (N, N, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 1] = Vee (electron-electron)
VC[:, :, 2] = Vhh (hole-hole)</p></li>
<li><p><strong>BGR</strong> (<em>ndarray</em>) – Output array for band gap renormalization, shape (N, N), complex.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>UnDel</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 2D array from MakeUnDel, shape (N+1, N+1).
If None, uses module-level _UnDel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>BGR is modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function extracts diagonal elements from C and D to get carrier populations,
then computes the renormalization using hole-hole and electron-electron interactions.
The UnDel factors exclude self-interaction terms.
Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.EeRenorm">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">EeRenorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">BGR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">UnDel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.EeRenorm" title="Link to this definition"></a></dt>
<dd><p>Calculate electron energy renormalization.</p>
<p>Computes the electron energy renormalization due to many-body Coulomb interactions.
This accounts for the shift in electron energy levels due to electron-electron interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron population array, shape (N,), complex</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (N, N, 3)
VC[:, :, 1] = Vee (electron-electron) is used</p></li>
<li><p><strong>BGR</strong> (<em>ndarray</em>) – Output array for electron energy renormalization, shape (N, N), complex.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>UnDel</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 2D array from MakeUnDel, shape (N+1, N+1).
If None, uses module-level _UnDel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>BGR is modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the electron energy shift using electron-electron
interactions, with terms that include both direct and exchange contributions.
The UnDel factors exclude self-interaction terms.
Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.EhRenorm">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">EhRenorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">BGR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">UnDel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.EhRenorm" title="Link to this definition"></a></dt>
<dd><p>Calculate hole energy renormalization.</p>
<p>Computes the hole energy renormalization due to many-body Coulomb interactions.
This accounts for the shift in hole energy levels due to hole-hole interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole population array, shape (N,), complex</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (N, N, 3)
VC[:, :, 2] = Vhh (hole-hole) is used</p></li>
<li><p><strong>BGR</strong> (<em>ndarray</em>) – Output array for hole energy renormalization, shape (N, N), complex.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>UnDel</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 2D array from MakeUnDel, shape (N+1, N+1).
If None, uses module-level _UnDel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>BGR is modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The function computes the hole energy shift using hole-hole interactions,
with terms that include both direct and exchange contributions.
The UnDel factors exclude self-interaction terms.
Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.MBCE2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBCE2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ceh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cee</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.MBCE2" title="Link to this definition"></a></dt>
<dd><p>Calculate the Many-body Coulomb In/Out rates for electrons (version 2).</p>
<p>Computes the many-body relaxation rates Win and Wout for electrons due to
electron-hole and electron-electron Coulomb interactions. These represent
non-Hartree-Fock terms in the many-body dynamics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron population array, shape (Nk,), real</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole population array, shape (Nk,), real</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (Nk, Nk, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 1] = Vee (electron-electron)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Electron inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – Input/output array for in-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Input/output array for out-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 3D indexing array from MakeK3, shape (Nk, Nk, Nk).
If None, uses module-level _k3.</p></li>
<li><p><strong>Ceh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Ceh.</p></li>
<li><p><strong>Cee</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-electron many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Cee.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Win and Wout are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).
The function computes scattering rates due to electron-hole and electron-electron
interactions, accounting for Pauli blocking factors (1 - n) and occupation factors n.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id45">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBCE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ceh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cee</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id45" title="Link to this definition"></a></dt>
<dd><p>Calculate the Many-body Coulomb In/Out rates for electrons.</p>
<p>Computes the many-body relaxation rates Win and Wout for electrons due to
electron-hole and electron-electron Coulomb interactions. This is identical
to MBCE2 but kept as a separate function to match Fortran structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron population array, shape (Nk,), real</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole population array, shape (Nk,), real</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (Nk, Nk, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 1] = Vee (electron-electron)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>ge</strong> (<em>float</em>) – Electron inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – Input/output array for in-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Input/output array for out-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 3D indexing array from MakeK3, shape (Nk, Nk, Nk).
If None, uses module-level _k3.</p></li>
<li><p><strong>Ceh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Ceh.</p></li>
<li><p><strong>Cee</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-electron many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Cee.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Win and Wout are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).
This function is identical to MBCE2 but kept separate to match Fortran code structure.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id46">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBCH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nh0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">geh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ceh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Chh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id46" title="Link to this definition"></a></dt>
<dd><p>Calculate the Many-body Coulomb In/Out rates for holes.</p>
<p>Computes the many-body relaxation rates Win and Wout for holes due to
electron-hole and hole-hole Coulomb interactions. These represent
non-Hartree-Fock terms in the many-body dynamics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne0</strong> (<em>ndarray</em>) – Electron population array, shape (Nk,), real</p></li>
<li><p><strong>nh0</strong> (<em>ndarray</em>) – Hole population array, shape (Nk,), real</p></li>
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (not used in calculation but kept for interface compatibility)</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Screened Coulomb interaction matrices, shape (Nk, Nk, 3)
VC[:, :, 0] = Veh (electron-hole)
VC[:, :, 2] = Vhh (hole-hole)</p></li>
<li><p><strong>geh</strong> (<em>float</em>) – Electron-hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>gh</strong> (<em>float</em>) – Hole inverse lifetime (not used in calculation but kept for interface)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – Input/output array for in-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Input/output array for out-scattering rates, shape (Nk,), real.
Will be modified in-place (matching Fortran intent(inout)).</p></li>
<li><p><strong>k3</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – 3D indexing array from MakeK3, shape (Nk, Nk, Nk).
If None, uses module-level _k3.</p></li>
<li><p><strong>Ceh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Electron-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Ceh.</p></li>
<li><p><strong>Chh</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Hole-hole many-body interaction array, shape (Nk, Nk, Nk).
If None, uses module-level _Chh.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Win and Wout are modified in-place (matching Fortran intent(inout) behavior).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses JIT compilation with parallel execution (matching Fortran OpenMP behavior).
The function computes scattering rates due to electron-hole and hole-hole
interactions, accounting for Pauli blocking factors (1 - n) and occupation factors n.</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id47">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">hbar</span></span><a class="headerlink" href="#id47" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="PSTD3D.kB">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">kB</span></span><a class="headerlink" href="#PSTD3D.kB" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="id48">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">ii</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1j</span></em><a class="headerlink" href="#id48" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id49">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">InitializePhonons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ky</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ee</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Eh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gph</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Oph</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id49" title="Link to this definition"></a></dt>
<dd><p>Initialize phonon interaction matrices (Unecessary the jit version?).</p>
<p>Sets up the electron and hole phonon interaction matrices EP, HP
and their transposes EPT, HPT. Also calculates the scaling factor Vscale.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ky</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>Ee</strong> (<em>ndarray</em>) – Electron energies (J), 1D array</p></li>
<li><p><strong>Eh</strong> (<em>ndarray</em>) – Hole energies (J), 1D array</p></li>
<li><p><strong>L</strong> (<em>float</em>) – Length parameter (unused, kept for interface compatibility)</p></li>
<li><p><strong>epsr</strong> (<em>float</em>) – Dielectric constant</p></li>
<li><p><strong>Gph</strong> (<em>float</em>) – Phonon damping rate (Hz)</p></li>
<li><p><strong>Oph</strong> (<em>float</em>) – Phonon frequency (Hz)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Sets module-level variables:
- _NO: Bose distribution for phonons
- _idel: Identity exclusion matrix (1 where k != k1, 0 where k == k1)
- _EP, _EPT: Electron phonon interaction matrix and its transpose
- _HP, _HPT: Hole phonon interaction matrix and its transpose
- _Vscale: Scaling constant for Coulomb interactions</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id50">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBPE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ne</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id50" title="Link to this definition"></a></dt>
<dd><p>Many-body phonon-electron interaction.</p>
<p>Calculates the in-scattering and out-scattering rates for electrons
due to phonon interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ne</strong> (<em>ndarray</em>) – Electron carrier populations, 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Coulomb interaction array, shape (Nk, Nk, 3)
Uses VC[:, :, 1] for electron-electron interaction (Fortran uses VC(:,:,2) which is 1-based)</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – 1D energy array, shape (Nk, Nk)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – In-scattering rates (modified in-place), 1D array</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Out-scattering rates (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies Win and Wout in-place.
Uses module-level variables _EPT, _EP, _Vscale.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id51">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">MBPH</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Win</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Wout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id51" title="Link to this definition"></a></dt>
<dd><p>Many-body phonon-hole interaction.</p>
<p>Calculates the in-scattering and out-scattering rates for holes
due to phonon interactions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nh</strong> (<em>ndarray</em>) – Hole carrier populations, 1D array</p></li>
<li><p><strong>VC</strong> (<em>ndarray</em>) – Coulomb interaction array, shape (Nk, Nk, 3)
Uses VC[:, :, 2] for hole-hole interaction (Fortran uses VC(:,:,3) which is 1-based)</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – 1D energy array, shape (Nk, Nk)</p></li>
<li><p><strong>Win</strong> (<em>ndarray</em>) – In-scattering rates (modified in-place), 1D array</p></li>
<li><p><strong>Wout</strong> (<em>ndarray</em>) – Out-scattering rates (modified in-place), 1D array</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Modifies Win and Wout in-place.
Uses module-level variables _HPT, _HP, _Vscale.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.Cq2">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">Cq2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E1D</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.Cq2" title="Link to this definition"></a></dt>
<dd><p>Calculate Cq for use in the DC Field module.</p>
<p>Computes the phonon coupling constant Cq for a given momentum array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q</strong> (<em>ndarray</em>) – Momentum coordinates (1/m), 1D array</p></li>
<li><p><strong>V</strong> (<em>ndarray</em>) – Interaction potential array, shape (Nk, Nk)</p></li>
<li><p><strong>E1D</strong> (<em>ndarray</em>) – 1D energy array, shape (Nk, Nk)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Cq values, 1D array of same length as q</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Vscale for scaling.
The function maps q values to indices in V and E1D arrays.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id52">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">FermiDistr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">En</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id52" title="Link to this definition"></a></dt>
<dd><p>Calculate Fermi-Dirac distribution.</p>
<p>Computes the Fermi-Dirac distribution assuming host temperature
and Fermi Energy = 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>En</strong> (<em>float</em><em> or </em><em>ndarray</em>) – Energy (J)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fermi-Dirac distribution value: 1 / (exp(En / (kB * T)) + 1)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float or ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Temp for temperature.
Note: Fortran returns complex type, but the value is always real, so Python returns float.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.BoseDistr">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">BoseDistr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">En</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.BoseDistr" title="Link to this definition"></a></dt>
<dd><p>Calculate Bose-Einstein distribution.</p>
<p>Computes the Bose-Einstein distribution for phonons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>En</strong> (<em>float</em><em> or </em><em>ndarray</em>) – Energy (J)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Bose-Einstein distribution value: 1 / (exp(En / (kB * T)) - 1)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float or ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses module-level variable _Temp for temperature.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="PSTD3D.N00">
<span class="sig-prename descclassname"><span class="pre">PSTD3D.</span></span><span class="sig-name descname"><span class="pre">N00</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#PSTD3D.N00" title="Link to this definition"></a></dt>
<dd><p>Get the Bose distribution value for phonons.</p>
<p>Returns the module-level variable _NO which is the Bose function
for thermal equilibrium longitudinal-optical phonons in host.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Bose distribution value NO</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../core/typetpamedium/index.html" class="btn btn-neutral float-left" title="core.typetpamedium" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SBEs/index.html" class="btn btn-neutral float-right" title="PSTD3D.SBEs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, PulseSuite Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>